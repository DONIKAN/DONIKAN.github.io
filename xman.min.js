/*! XMan v0.3.6 - http://instreamatic.com */
window.initVoiceSDK=function(a){var b=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();define("src/common/Guid",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:3&c|8).toString(16)});return b};b.CreateGuid=c;var d=function(){return c().replace(new RegExp("-","g"),"").toUpperCase()};b.CreateNoDashGuid=d}),define("src/common/IDictionary",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/PlatformEvent",["require","exports","src/common/Guid"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.Debug=0]="Debug",a[a.Info=1]="Info",a[a.Warning=2]="Warning",a[a.Error=3]="Error"}(d=b.EventType||(b.EventType={}));var e=function(){function a(a,b){this.name=a,this.eventId=c.CreateNoDashGuid(),this.eventTime=(new Date).toISOString(),this.eventType=b,this.metadata={}}return Object.defineProperty(a.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"EventId",{get:function(){return this.eventId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"EventTime",{get:function(){return this.eventTime},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"EventType",{get:function(){return this.eventType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Metadata",{get:function(){return this.metadata},enumerable:!0,configurable:!0}),a}();b.PlatformEvent=e}),define("src/common/AudioSourceEvents",["require","exports","src/common/PlatformEvent"],function(a,c,d){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var e=function(a){function c(b,c,e){void 0===e&&(e=d.EventType.Info);var f=a.call(this,b,e)||this;return f.audioSourceId=c,f}return b(c,a),Object.defineProperty(c.prototype,"AudioSourceId",{get:function(){return this.audioSourceId},enumerable:!0,configurable:!0}),c}(d.PlatformEvent);c.AudioSourceEvent=e;var f=function(a){function c(b){return a.call(this,"AudioSourceInitializingEvent",b)||this}return b(c,a),c}(e);c.AudioSourceInitializingEvent=f;var g=function(a){function c(b){return a.call(this,"AudioSourceReadyEvent",b)||this}return b(c,a),c}(e);c.AudioSourceReadyEvent=g;var h=function(a){function c(b){return a.call(this,"AudioSourceOffEvent",b)||this}return b(c,a),c}(e);c.AudioSourceOffEvent=h;var i=function(a){function c(b,c){var e=a.call(this,"AudioSourceErrorEvent",b,d.EventType.Error)||this;return e.error=c,e}return b(c,a),Object.defineProperty(c.prototype,"Error",{get:function(){return this.error},enumerable:!0,configurable:!0}),c}(e);c.AudioSourceErrorEvent=i;var j=function(a){function c(b,c,d){var e=a.call(this,b,c)||this;return e.audioNodeId=d,e}return b(c,a),Object.defineProperty(c.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),c}(e);c.AudioStreamNodeEvent=j;var k=function(a){function c(b,c){return a.call(this,"AudioStreamNodeAttachingEvent",b,c)||this}return b(c,a),c}(j);c.AudioStreamNodeAttachingEvent=k;var l=function(a){function c(b,c){return a.call(this,"AudioStreamNodeAttachedEvent",b,c)||this}return b(c,a),c}(j);c.AudioStreamNodeAttachedEvent=l;var m=function(a){function c(b,c){return a.call(this,"AudioStreamNodeDetachedEvent",b,c)||this}return b(c,a),c}(j);c.AudioStreamNodeDetachedEvent=m;var n=function(a){function c(b,c,d){var e=a.call(this,"AudioStreamNodeErrorEvent",b,c)||this;return e.error=d,e}return b(c,a),Object.defineProperty(c.prototype,"Error",{get:function(){return this.error},enumerable:!0,configurable:!0}),c}(j);c.AudioStreamNodeErrorEvent=n}),define("src/common/Error",["require","exports"],function(a,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=function(a){function c(b){var c=a.call(this,b)||this;return c.name="ArgumentNull",c.message=b,c}return b(c,a),c}(Error);c.ArgumentNullError=d;var e=function(a){function c(b){var c=a.call(this,b)||this;return c.name="InvalidOperation",c.message=b,c}return b(c,a),c}(Error);c.InvalidOperationError=e;var f=function(a){function c(b,c){var d=a.call(this,c)||this;return d.name=b+"ObjectDisposed",d.message=c,d}return b(c,a),c}(Error);c.ObjectDisposedError=f}),define("src/common/ConnectionMessage",["require","exports","src/common/Error","src/common/Guid"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e;!function(a){a[a.Text=0]="Text",a[a.Binary=1]="Binary"}(e=b.MessageType||(b.MessageType={}));var f=function(){function a(a,b,f,g){if(this.body=null,a===e.Text&&b&&"string"!=typeof b)throw new c.InvalidOperationError("Payload must be a string");if(a===e.Binary&&b&&!(b instanceof ArrayBuffer))throw new c.InvalidOperationError("Payload must be ArrayBuffer");this.messageType=a,this.body=b,this.headers=f?f:{},this.id=g?g:d.CreateNoDashGuid()}return Object.defineProperty(a.prototype,"MessageType",{get:function(){return this.messageType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Headers",{get:function(){return this.headers},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Body",{get:function(){return this.body},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TextBody",{get:function(){if(this.messageType===e.Binary)throw new c.InvalidOperationError("Not supported for binary message");return this.body},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"BinaryBody",{get:function(){if(this.messageType===e.Text)throw new c.InvalidOperationError("Not supported for text message");return this.body},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),a}();b.ConnectionMessage=f}),define("src/common/ConnectionEvents",["require","exports","src/common/PlatformEvent"],function(a,c,d){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var e=function(a){function c(b,c,e){void 0===e&&(e=d.EventType.Info);var f=a.call(this,b,e)||this;return f.connectionId=c,f}return b(c,a),Object.defineProperty(c.prototype,"ConnectionId",{get:function(){return this.connectionId},enumerable:!0,configurable:!0}),c}(d.PlatformEvent);c.ConnectionEvent=e;var f=function(a){function c(b,c,d){var e=a.call(this,"ConnectionStartEvent",b)||this;return e.uri=c,e.headers=d,e}return b(c,a),Object.defineProperty(c.prototype,"Uri",{get:function(){return this.uri},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Headers",{get:function(){return this.headers},enumerable:!0,configurable:!0}),c}(e);c.ConnectionStartEvent=f;var g=function(a){function c(b,c){return a.call(this,"ConnectionEstablishedEvent",b)||this}return b(c,a),c}(e);c.ConnectionEstablishedEvent=g;var h=function(a){function c(b,c,e){var f=a.call(this,"ConnectionClosedEvent",b,d.EventType.Warning)||this;return f.reason=e,f.statusCode=c,f}return b(c,a),Object.defineProperty(c.prototype,"Reason",{get:function(){return this.reason},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"StatusCode",{get:function(){return this.statusCode},enumerable:!0,configurable:!0}),c}(e);c.ConnectionClosedEvent=h;var i=function(a){function c(b,c,e){var f=a.call(this,"ConnectionEstablishErrorEvent",b,d.EventType.Error)||this;return f.statusCode=c,f.reason=e,f}return b(c,a),Object.defineProperty(c.prototype,"Reason",{get:function(){return this.reason},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"StatusCode",{get:function(){return this.statusCode},enumerable:!0,configurable:!0}),c}(e);c.ConnectionEstablishErrorEvent=i;var j=function(a){function c(b,c,d){var e=a.call(this,"ConnectionMessageReceivedEvent",b)||this;return e.networkReceivedTime=c,e.message=d,e}return b(c,a),Object.defineProperty(c.prototype,"NetworkReceivedTime",{get:function(){return this.networkReceivedTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Message",{get:function(){return this.message},enumerable:!0,configurable:!0}),c}(e);c.ConnectionMessageReceivedEvent=j;var k=function(a){function c(b,c,d){var e=a.call(this,"ConnectionMessageSentEvent",b)||this;return e.networkSentTime=c,e.message=d,e}return b(c,a),Object.defineProperty(c.prototype,"NetworkSentTime",{get:function(){return this.networkSentTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Message",{get:function(){return this.message},enumerable:!0,configurable:!0}),c}(e);c.ConnectionMessageSentEvent=k}),define("src/common/ConnectionOpenResponse",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.statusCode=a,this.reason=b}return Object.defineProperty(a.prototype,"StatusCode",{get:function(){return this.statusCode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Reason",{get:function(){return this.reason},enumerable:!0,configurable:!0}),a}();b.ConnectionOpenResponse=c}),define("src/common/IDetachable",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/IDisposable",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/IEventSource",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/EventSource",["require","exports","src/common/Error","src/common/Guid"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a){var b=this;this.eventListeners={},this.isDisposed=!1,this.OnEvent=function(a){if(b.IsDisposed())throw new c.ObjectDisposedError("EventSource");if(b.Metadata)for(var d in b.Metadata)d&&a.Metadata&&(a.Metadata[d]||(a.Metadata[d]=b.Metadata[d]));for(var e in b.eventListeners)e&&b.eventListeners[e]&&b.eventListeners[e](a)},this.Attach=function(a){var c=d.CreateNoDashGuid();return b.eventListeners[c]=a,{Detach:function(){delete b.eventListeners[c]}}},this.AttachListener=function(a){return b.Attach(a.OnEvent)},this.IsDisposed=function(){return b.isDisposed},this.Dispose=function(){b.eventListeners=null,b.isDisposed=!0},this.metadata=a}return Object.defineProperty(a.prototype,"Metadata",{get:function(){return this.metadata},enumerable:!0,configurable:!0}),a}();b.EventSource=e}),define("src/common/Events",["require","exports","src/common/Error","src/common/EventSource"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){}return Object.defineProperty(a,"Instance",{get:function(){return a.instance},enumerable:!0,configurable:!0}),a}();e.instance=new d.EventSource,e.SetEventSource=function(a){if(!a)throw new c.ArgumentNullError("eventSource");e.instance=a},b.Events=e}),define("src/common/Promise",["require","exports","src/common/Error"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.None=0]="None",a[a.Resolved=1]="Resolved",a[a.Rejected=2]="Rejected"}(d=b.PromiseState||(b.PromiseState={}));var e=function(){function a(a){var b=this;this.ThrowIfError=function(){if(b.IsError)throw b.Error},a.On(function(a){b.isCompleted||(b.isCompleted=!0,b.isError=!1,b.result=a)},function(a){b.isCompleted||(b.isCompleted=!0,b.isError=!0,b.error=a)})}return Object.defineProperty(a.prototype,"IsCompleted",{get:function(){return this.isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsError",{get:function(){return this.isError},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Error",{get:function(){return this.error},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Result",{get:function(){return this.result},enumerable:!0,configurable:!0}),a}();b.PromiseResult=e;var f=function(){function a(){var a=this;this.SetResult=function(b){a.onSetResult(b)},this.SetError=function(b){a.onSetError(b)},this.On=function(b,c){a.onSetResult=b,a.onSetError=c}}return a}();b.PromiseResultEventSource=f;var g=function(){function a(){}return a}();g.WhenAll=function(a){if(!a||0===a.length)throw new c.ArgumentNullError("promises");for(var b=new i,d=[],e=0,f=function(){e++,e===a.length&&(0===d.length?b.Resolve(!0):b.Reject(d.join(", ")))},g=0,h=a;g<h.length;g++){var j=h[g];j.On(function(a){f()},function(a){d.push(a),f()})}return b.Promise()},g.FromResult=function(a){var b=new i;return b.Resolve(a),b.Promise()},g.FromError=function(a){var b=new i;return b.Reject(a),b.Promise()},b.PromiseHelper=g;var h=function(){function a(a){var b=this;this.Result=function(){return b.sink.Result},this.ContinueWith=function(a){if(!a)throw new c.ArgumentNullError("continuationCallback");var d=new i;return b.sink.on(function(c){try{var e=a(b.sink.Result);d.Resolve(e)}catch(f){d.Reject("'Unhandled callback error: "+f+"'")}},function(c){try{var e=a(b.sink.Result);d.Resolve(e)}catch(f){d.Reject("'Unhandled callback error: "+f+". InnerError: "+c+"'")}}),d.Promise()},this.OnSuccessContinueWith=function(a){if(!a)throw new c.ArgumentNullError("continuationCallback");var d=new i;return b.sink.on(function(b){try{var c=a(b);d.Resolve(c)}catch(e){d.Reject("'Unhandled callback error: "+e+"'")}},function(a){d.Reject("'Unhandled callback error: "+a+"'")}),d.Promise()},this.ContinueWithPromise=function(a){if(!a)throw new c.ArgumentNullError("continuationCallback");var d=new i;return b.sink.on(function(c){try{var e=a(b.sink.Result);if(!e)throw new Error("'Contuniation callback did not return promise'");e.On(function(a){d.Resolve(a)},function(a){d.Reject(a)})}catch(f){d.Reject("'Unhandled callback error: "+f+"'")}},function(c){try{var e=a(b.sink.Result);if(!e)throw new Error("Contuniation callback did not return promise");e.On(function(a){d.Resolve(a)},function(a){d.Reject(a)})}catch(f){d.Reject("'Unhandled callback error: "+f+". InnerError: "+c+"'")}}),d.Promise()},this.OnSuccessContinueWithPromise=function(a){if(!a)throw new c.ArgumentNullError("continuationCallback");var d=new i;return b.sink.on(function(b){try{var c=a(b);if(!c)throw new Error("Contuniation callback did not return promise");c.On(function(a){d.Resolve(a)},function(a){d.Reject(a)})}catch(e){d.Reject("'Unhandled callback error: "+e+"'")}},function(a){d.Reject("'Unhandled callback error: "+a+".'")}),d.Promise()},this.On=function(a,d){if(!a)throw new c.ArgumentNullError("successCallback");if(!d)throw new c.ArgumentNullError("errorCallback");return b.sink.on(a,d),b},this.Finally=function(a){if(!a)throw new c.ArgumentNullError("callback");var d=function(b){a()};return b.On(d,d)},this.sink=a}return a}();b.Promise=h;var i=function(){function a(){var a=this;this.State=function(){return a.sink.State},this.Promise=function(){return a.promise},this.Resolve=function(b){return a.sink.Resolve(b),a},this.Reject=function(b){return a.sink.Reject(b),a},this.sink=new j,this.promise=new h(this.sink)}return a}();b.Deferred=i;var j=function(){function a(){var a=this;this.state=d.None,this.promiseResult=null,this.promiseResultEvents=null,this.successHandlers=[],this.errorHandlers=[],this.Resolve=function(b){if(a.state!==d.None)throw new Error("'Cannot resolve a completed promise'");a.state=d.Resolved,a.promiseResultEvents.SetResult(b);for(var c=0;c<a.successHandlers.length;c++)a.ExecuteSuccessCallback(b,a.successHandlers[c],a.errorHandlers[c]);a.DetachHandlers()},this.Reject=function(b){if(a.state!==d.None)throw new Error("'Cannot reject a completed promise'");a.state=d.Rejected,a.promiseResultEvents.SetError(b);for(var c=0,e=a.errorHandlers;c<e.length;c++){var f=e[c];a.ExecuteErrorCallback(b,f)}a.DetachHandlers()},this.on=function(b,c){null==b&&(b=function(a){}),a.state===d.None?(a.successHandlers.push(b),a.errorHandlers.push(c)):(a.state===d.Resolved?a.ExecuteSuccessCallback(a.promiseResult.Result,b,c):a.state===d.Rejected&&a.ExecuteErrorCallback(a.promiseResult.Error,c),a.DetachHandlers())},this.ExecuteSuccessCallback=function(b,c,d){try{c(b)}catch(e){a.ExecuteErrorCallback("'Unhandled callback error: "+e+"'",d)}},this.ExecuteErrorCallback=function(a,b){if(!b)throw new Error("'Unhandled error: "+a+"'");try{b(a)}catch(c){throw new Error("'Unhandled callback error: "+c+". InnerError: "+a+"'")}},this.DetachHandlers=function(){a.errorHandlers=[],a.successHandlers=[]},this.promiseResultEvents=new f,this.promiseResult=new e(this.promiseResultEvents)}return Object.defineProperty(a.prototype,"State",{get:function(){return this.state},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Result",{get:function(){return this.promiseResult},enumerable:!0,configurable:!0}),a}();b.Sink=j}),define("src/common/List",["require","exports","src/common/Error"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(b){var d=this;if(this.subscriptionIdCounter=0,this.addSubscriptions={},this.removeSubscriptions={},this.disposedSubscriptions={},this.disposeReason=null,this.Get=function(a){return d.ThrowIfDisposed(),d.list[a]},this.First=function(){return d.Get(0)},this.Last=function(){return d.Get(d.Length()-1)},this.Add=function(a){d.ThrowIfDisposed(),d.InsertAt(d.list.length,a)},this.InsertAt=function(a,b){d.ThrowIfDisposed(),0===a?d.list.unshift(b):a===d.list.length?d.list.push(b):d.list.splice(a,0,b),d.TriggerSubscriptions(d.addSubscriptions)},this.RemoveFirst=function(){return d.ThrowIfDisposed(),d.RemoveAt(0)},this.RemoveLast=function(){return d.ThrowIfDisposed(),d.RemoveAt(d.Length()-1)},this.RemoveAt=function(a){return d.ThrowIfDisposed(),d.Remove(a,1)[0]},this.Remove=function(a,b){d.ThrowIfDisposed();var c=d.list.splice(a,b);return d.TriggerSubscriptions(d.removeSubscriptions),c},this.Clear=function(){d.ThrowIfDisposed(),d.Remove(0,d.Length())},this.Length=function(){return d.ThrowIfDisposed(),d.list.length},this.OnAdded=function(a){d.ThrowIfDisposed();var b=d.subscriptionIdCounter++;return d.addSubscriptions[b]=a,{Detach:function(){delete d.addSubscriptions[b]}}},this.OnRemoved=function(a){d.ThrowIfDisposed();var b=d.subscriptionIdCounter++;return d.removeSubscriptions[b]=a,{Detach:function(){delete d.removeSubscriptions[b]}}},this.OnDisposed=function(a){d.ThrowIfDisposed();var b=d.subscriptionIdCounter++;return d.disposedSubscriptions[b]=a,{Detach:function(){delete d.disposedSubscriptions[b]}}},this.Join=function(a){return d.ThrowIfDisposed(),d.list.join(a)},this.ToArray=function(){var a=Array();return d.list.forEach(function(b){a.push(b)}),a},this.Any=function(a){return d.ThrowIfDisposed(),a?d.Where(a).Length()>0:d.Length()>0},this.All=function(a){return d.ThrowIfDisposed(),d.Where(a).Length()===d.Length()},this.ForEach=function(a){d.ThrowIfDisposed();for(var b=0;b<d.Length();b++)a(d.list[b],b)},this.Select=function(b){d.ThrowIfDisposed();for(var c=[],e=0;e<d.list.length;e++)c.push(b(d.list[e],e));return new a(c)},this.Where=function(b){d.ThrowIfDisposed();for(var c=new a,e=0;e<d.list.length;e++)b(d.list[e],e)&&c.Add(d.list[e]);return c},this.OrderBy=function(b){d.ThrowIfDisposed();var c=d.ToArray(),e=c.sort(b);return new a(e)},this.OrderByDesc=function(a){return d.ThrowIfDisposed(),d.OrderBy(function(b,c){return a(c,b)})},this.Clone=function(){return d.ThrowIfDisposed(),new a(d.ToArray())},this.Concat=function(b){return d.ThrowIfDisposed(),new a(d.list.concat(b.ToArray()))},this.ConcatArray=function(b){return d.ThrowIfDisposed(),new a(d.list.concat(b))},this.IsDisposed=function(){return null==d.list},this.Dispose=function(a){d.IsDisposed()||(d.disposeReason=a,d.list=null,d.addSubscriptions=null,d.removeSubscriptions=null,d.TriggerSubscriptions(d.disposedSubscriptions))},this.ThrowIfDisposed=function(){if(d.IsDisposed())throw new c.ObjectDisposedError("List",d.disposeReason)},this.TriggerSubscriptions=function(a){if(a)for(var b in a)b&&a[b]()},this.list=[],b)for(var e=0,f=b;e<f.length;e++){var g=f[e];this.list.push(g)}}return a}();b.List=d}),define("src/common/Queue",["require","exports","src/common/Error","src/common/List","src/common/Promise"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f;!function(a){a[a.Dequeue=0]="Dequeue",a[a.Peek=1]="Peek"}(f||(f={}));var g=function(){function a(a){var b=this;this.promiseStore=new d.List,this.isDrainInProgress=!1,this.isDisposing=!1,this.disposeReason=null,this.Enqueue=function(a){b.ThrowIfDispose(),b.EnqueueFromPromise(e.PromiseHelper.FromResult(a))},this.EnqueueFromPromise=function(a){b.ThrowIfDispose(),b.promiseStore.Add(a),a.Finally(function(){for(;b.promiseStore.Length()>0&&b.promiseStore.First().Result().IsCompleted;){var a=b.promiseStore.RemoveFirst();a.Result().IsError||b.list.Add(a.Result().Result)}})},this.Dequeue=function(){b.ThrowIfDispose();var a=new e.Deferred;return b.subscribers.Add({deferral:a,type:f.Dequeue}),b.Drain(),a.Promise()},this.Peek=function(){b.ThrowIfDispose();var a=new e.Deferred;return b.subscribers.Add({deferral:a,type:f.Peek}),b.Drain(),a.Promise()},this.Length=function(){return b.ThrowIfDispose(),b.list.Length()},this.IsDisposed=function(){return null==b.subscribers},this.DrainAndDispose=function(a,c){if(!b.IsDisposed()&&!b.isDisposing){for(b.disposeReason=c,b.isDisposing=!0;b.subscribers.Length()>0;){var d=b.subscribers.RemoveFirst();d.deferral.Reject("Disposed")}for(var f=0,g=b.detachables;f<g.length;f++){var h=g[f];h.Detach()}if(b.promiseStore.Length()>0&&a)return e.PromiseHelper.WhenAll(b.promiseStore.ToArray()).ContinueWith(function(){return b.subscribers=null,b.list.ForEach(function(b,c){a(b)}),b.list=null,!0});b.subscribers=null,b.list=null}return e.PromiseHelper.FromResult(!0)},this.Dispose=function(a){b.DrainAndDispose(null,a)},this.Drain=function(){if(!b.isDrainInProgress&&!b.isDisposing){for(b.isDrainInProgress=!0;b.list.Length()>0&&b.subscribers.Length()>0&&!b.isDisposing;){var a=b.subscribers.RemoveFirst();if(a.type===f.Peek)a.deferral.Resolve(b.list.First());else{var c=b.list.RemoveFirst();a.deferral.Resolve(c)}}b.isDrainInProgress=!1}},this.ThrowIfDispose=function(){if(b.IsDisposed()){if(b.disposeReason)throw new c.InvalidOperationError(b.disposeReason);throw new c.ObjectDisposedError("Queue")}if(b.isDisposing)throw new c.InvalidOperationError("Queue disposing")},this.list=a?a:new d.List,this.detachables=[],this.subscribers=new d.List,this.detachables.push(this.list.OnAdded(this.Drain))}return a}();b.Queue=g}),define("src/common/Stream",["require","exports","src/common/Error","src/common/Guid","src/common/Queue"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a){var b=this;this.readerIdCounter=1,this.isEnded=!1,this.Write=function(a){b.ThrowIfClosed(),b.WriteStreamChunk({Buffer:a,IsEnd:!1})},this.GetReader=function(){var a=b.readerIdCounter;b.readerIdCounter++;var c=new e.Queue,d=b.streambuffer.length;b.readerQueues[a]=c;for(var f=0;f<d;f++)c.Enqueue(b.streambuffer[f]);return new g(b.id,c,function(){delete b.readerQueues[a]})},this.Close=function(){b.isEnded||(b.WriteStreamChunk({Buffer:null,IsEnd:!0}),b.isEnded=!0)},this.WriteStreamChunk=function(a){b.ThrowIfClosed(),b.streambuffer.push(a);for(var c in b.readerQueues)if(!b.readerQueues[c].IsDisposed())try{b.readerQueues[c].Enqueue(a)}catch(d){}},this.ThrowIfClosed=function(){if(b.isEnded)throw new c.InvalidOperationError("Stream closed")},this.id=a?a:d.CreateNoDashGuid(),this.streambuffer=[],this.readerQueues={}}return Object.defineProperty(a.prototype,"IsClosed",{get:function(){return this.isEnded},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),a}();b.Stream=f;var g=function(){function a(a,b,d){var e=this;this.isClosed=!1,this.Read=function(){if(e.IsClosed)throw new c.InvalidOperationError("StreamReader closed");return e.readerQueue.Dequeue().OnSuccessContinueWith(function(a){return a.IsEnd&&e.readerQueue.Dispose("End of stream reached"),a})},this.Close=function(){e.isClosed||(e.isClosed=!0,e.readerQueue.Dispose("StreamReader closed"),e.onClose())},this.readerQueue=b,this.onClose=d,this.streamId=a}return Object.defineProperty(a.prototype,"IsClosed",{get:function(){return this.isClosed},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"StreamId",{get:function(){return this.streamId},enumerable:!0,configurable:!0}),a}();b.StreamReader=g}),define("src/common/IAudioSource",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/IConnection",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.None=0]="None",a[a.Connected=1]="Connected",a[a.Connecting=2]="Connecting",a[a.Disconnected=3]="Disconnected"}(c=b.ConnectionState||(b.ConnectionState={}))}),define("src/common/IKeyValueStorage",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/InMemoryStorage",["require","exports","src/common/Error"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){var a=this;this.store={},this.Get=function(b){if(!b)throw new c.ArgumentNullError("key");return a.store[b]},this.GetOrAdd=function(b,d){if(!b)throw new c.ArgumentNullError("key");return void 0===a.store[b]&&(a.store[b]=d),a.store[b]},this.Set=function(b,d){if(!b)throw new c.ArgumentNullError("key");a.store[b]=d},this.Remove=function(b){if(!b)throw new c.ArgumentNullError("key");void 0!==a.store[b]&&delete a.store[b]}}return a}();b.InMemoryStorage=d}),define("src/common/ITimer",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/RawWebsocketMessage",["require","exports","src/common/ConnectionMessage","src/common/Error","src/common/Guid"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b,f){if(this.payload=null,!b)throw new d.ArgumentNullError("payload");if(a===c.MessageType.Binary&&!(b instanceof ArrayBuffer))throw new d.InvalidOperationError("Payload must be ArrayBuffer");if(a===c.MessageType.Text&&"string"!=typeof b)throw new d.InvalidOperationError("Payload must be a string");this.messageType=a,this.payload=b,this.id=f?f:e.CreateNoDashGuid()}return Object.defineProperty(a.prototype,"MessageType",{get:function(){return this.messageType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Payload",{get:function(){return this.payload},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TextContent",{get:function(){if(this.messageType===c.MessageType.Binary)throw new d.InvalidOperationError("Not supported for binary message");return this.payload},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"BinaryContent",{get:function(){if(this.messageType===c.MessageType.Text)throw new d.InvalidOperationError("Not supported for text message");return this.payload},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),a}();b.RawWebsocketMessage=f}),define("src/common/IWebsocketMessageFormatter",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common/RiffPcmEncoder",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){var c=this;this.channelCount=1,this.Encode=function(a,b){var d=c.DownSampleAudioFrame(b,c.actualSampleRate,c.desiredSampleRate),e=2*d.length;if(!a){var f=new ArrayBuffer(e),g=new DataView(f);return c.FloatTo16BitPCM(g,0,d),f}var h=new ArrayBuffer(44+e),i=16,j=i/8,k=0,l=new DataView(h);return c.SetString(l,0,"RIFF"),l.setUint32(4,k,!0),c.SetString(l,8,"WAVEfmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,c.channelCount,!0),l.setUint32(24,c.desiredSampleRate,!0),l.setUint32(28,c.desiredSampleRate*c.channelCount*j,!0),l.setUint16(32,c.channelCount*j,!0),l.setUint16(34,i,!0),c.SetString(l,36,"data"),l.setUint32(40,k,!0),c.FloatTo16BitPCM(l,44,d),h},this.SetString=function(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))},this.FloatTo16BitPCM=function(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,e<0?32768*e:32767*e,!0)}},this.DownSampleAudioFrame=function(a,b,c){if(c===b||c>b)return a;for(var d=b/c,e=Math.round(a.length/d),f=new Float32Array(e),g=0,h=0;g<f.length;){for(var i=Math.round((g+1)*d),j=0,k=0,l=h;l<i&&l<a.length;l++)j+=a[l],k++;f[g]=j/k,g++,h=i}return f},this.actualSampleRate=a,this.desiredSampleRate=b}return a}();b.RiffPcmEncoder=c}),define("src/common/Storage",["require","exports","src/common/Error","src/common/InMemoryStorage"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){}return Object.defineProperty(a,"Session",{get:function(){return a.sessionStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Local",{get:function(){return a.localStorage},enumerable:!0,configurable:!0}),a}();e.sessionStorage=new d.InMemoryStorage,e.localStorage=new d.InMemoryStorage,e.SetSessionStorage=function(a){if(!a)throw new c.ArgumentNullError("sessionStorage");e.sessionStorage=a},e.SetLocalStorage=function(a){if(!a)throw new c.ArgumentNullError("localStorage");e.localStorage=a},b.Storage=e}),define("src/common/Exports",["require","exports","src/common/AudioSourceEvents","src/common/ConnectionEvents","src/common/ConnectionMessage","src/common/ConnectionOpenResponse","src/common/Error","src/common/Events","src/common/EventSource","src/common/Guid","src/common/IConnection","src/common/InMemoryStorage","src/common/List","src/common/PlatformEvent","src/common/Promise","src/common/Queue","src/common/RawWebsocketMessage","src/common/RiffPcmEncoder","src/common/Storage","src/common/Stream"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),u(c),u(d),u(e),u(f),u(g),u(h),u(i),u(j),u(k),u(l),u(m),u(n),u(o),u(p),u(q),u(r),u(s),u(t)}),define("src/common.browser/ConsoleLoggingListener",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){void 0===a&&(a=c.EventType.Warning);var b=this;this.OnEvent=function(a){if(a.EventType>=b.logLevelFilter){var d=b.ToString(a);switch(a.EventType){case c.EventType.Debug:console.debug(d);break;case c.EventType.Info:console.info(d);break;case c.EventType.Warning:console.warn(d);break;case c.EventType.Error:console.error(d);break;default:console.log(d)}}},this.ToString=function(a){var b=[""+a.EventTime,""+a.Name];for(var c in a)if(c&&a.hasOwnProperty(c)&&"eventTime"!==c&&"eventType"!==c&&"eventId"!==c&&"name"!==c&&"constructor"!==c){var d=a[c],e="<NULL>";void 0!==d&&null!==d&&(e="number"==typeof d||"string"==typeof d?d.toString():JSON.stringify(d)),b.push(c+": "+e)}return b.join(" | ")},this.logLevelFilter=a}return a}();b.ConsoleLoggingListener=d}),define("src/common.browser/IRecorder",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/common.browser/LocalStorage",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.Get=function(a){if(!a)throw new c.ArgumentNullError("key");return localStorage.getItem(a)},this.GetOrAdd=function(a,b){if(!a)throw new c.ArgumentNullError("key");
var d=localStorage.getItem(a);return null!==d&&void 0!==d||localStorage.setItem(a,b),localStorage.getItem(a)},this.Set=function(a,b){if(!a)throw new c.ArgumentNullError("key");localStorage.setItem(a,b)},this.Remove=function(a){if(!a)throw new c.ArgumentNullError("key");localStorage.removeItem(a)}}return a}();b.LocalStorage=d}),define("src/common.browser/MicAudioSource",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){var d=this;this.streams={},this.TurnOn=function(){if(d.initializeDeferral)return d.initializeDeferral.Promise();d.initializeDeferral=new c.Deferred;window.navigator;if(window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia,window.navigator.getUserMedia)d.OnEvent(new c.AudioSourceInitializingEvent(d.id)),window.navigator.getUserMedia({audio:!0},function(a){d.mediaStream=a,d.OnEvent(new c.AudioSourceReadyEvent(d.id)),d.initializeDeferral.Resolve(!0)},function(a){var b="Error occured processing the user media stream. "+a;d.initializeDeferral.Reject(b),d.OnEvent(new c.AudioSourceErrorEvent(d.id,b))});else{var a="Browser doesnot support getUserMedia.";d.initializeDeferral.Reject(a),d.OnEvent(new c.AudioSourceErrorEvent(a,""))}return d.initializeDeferral.Promise()},this.Id=function(){return d.id},this.Attach=function(a){return d.OnEvent(new c.AudioStreamNodeAttachingEvent(d.id,a)),d.Listen(a).OnSuccessContinueWith(function(b){return d.OnEvent(new c.AudioStreamNodeAttachedEvent(d.id,a)),{Detach:function(){b.Close(),delete d.streams[a],d.OnEvent(new c.AudioStreamNodeDetachedEvent(d.id,a)),d.TurnOff()},Id:function(){return a},Read:function(){return b.Read()}}})},this.Detach=function(a){a&&d.streams[a]&&(d.streams[a].Close(),delete d.streams[a],d.OnEvent(new c.AudioStreamNodeDetachedEvent(d.id,a)))},this.TurnOff=function(){for(var a in d.streams)if(a){var b=d.streams[a];b&&b.Close()}return d.recorder.ReleaseMediaResources(),d.OnEvent(new c.AudioSourceOffEvent(d.id)),d.initializeDeferral=null,c.PromiseHelper.FromResult(!0)},this.Listen=function(a){return d.TurnOn().OnSuccessContinueWith(function(b){var e=new c.Stream(a);d.streams[a]=e;try{d.recorder.Record(d.mediaStream,e)}catch(f){var g="Error occured processing the user media stream. "+f;d.initializeDeferral.Reject(g),d.OnEvent(new c.AudioStreamNodeErrorEvent(d.id,a,f))}return e.GetReader()})},this.OnEvent=function(a){d.events.OnEvent(a),c.Events.Instance.OnEvent(a)},this.id=b?b:c.CreateNoDashGuid(),this.events=new c.EventSource,this.recorder=a}return Object.defineProperty(a.prototype,"Events",{get:function(){return this.events},enumerable:!0,configurable:!0}),a}();b.MicAudioSource=d}),define("src/common.browser/OpusRecorder",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a){var b=this;this.Record=function(a,c){var d=new MediaRecorder(a,b.mediaRecorderOptions),e=100;d.ondataavailable=function(a){if(c){var b=new FileReader;b.readAsArrayBuffer(a.data),b.onloadend=function(a){c.Write(b.result)}}},b.mediaResources={recorder:d,stream:a},d.start(e)},this.ReleaseMediaResources=function(){"inactive"!==b.mediaResources.recorder.state&&b.mediaResources.recorder.stop(),b.mediaResources.stream.getTracks().forEach(function(a){return a.stop()})},this.mediaRecorderOptions=a}return a}();b.OpusRecorder=c}),define("src/common.browser/PCMRecorder",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){var a=this;this.Record=function(b,d){var e=new AudioContext,f=e.createMediaStreamSource(b),g=16e3,h=2048,i=!1;4*g<=f.context.sampleRate?h=8192:2*g<=f.context.sampleRate&&(h=4096);var j=f.context.createScriptProcessor(h,1,1),k=new c.RiffPcmEncoder(f.context.sampleRate,g);j.onaudioprocess=function(a){var b,c,e=a.inputBuffer.getChannelData(0);d&&(i?(c||(c=k.Encode(!1,e)),d.Write(c)):(b||(b=k.Encode(!0,e)),d.Write(b),i=!0))},a.mediaResources={context:e,scriptProcessorNode:j,source:f,stream:b},f.connect(j),j.connect(f.context.destination)},this.ReleaseMediaResources=function(){a.mediaResources&&(a.mediaResources.scriptProcessorNode&&(a.mediaResources.scriptProcessorNode.disconnect(),a.mediaResources.scriptProcessorNode=null),a.mediaResources.source&&(a.mediaResources.source.disconnect(),a.mediaResources.stream.getTracks().forEach(function(a){return a.stop()}),a.mediaResources.source=null),a.mediaResources.context&&"closed"!==a.mediaResources.context.state&&a.mediaResources.context.close())}}return a}();b.PcmRecorder=d}),define("src/common.browser/SessionStorage",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.Get=function(a){if(!a)throw new c.ArgumentNullError("key");return sessionStorage.getItem(a)},this.GetOrAdd=function(a,b){if(!a)throw new c.ArgumentNullError("key");var d=sessionStorage.getItem(a);return null!==d&&void 0!==d||sessionStorage.setItem(a,b),sessionStorage.getItem(a)},this.Set=function(a,b){if(!a)throw new c.ArgumentNullError("key");sessionStorage.setItem(a,b)},this.Remove=function(a){if(!a)throw new c.ArgumentNullError("key");sessionStorage.removeItem(a)}}return a}();b.SessionStorage=d}),define("src/common.browser/Timer",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){var c=this;this.start=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.timerId&&c.stop(),c.timerId=setTimeout(c.successCallback,c.delayInMillisec,a)},this.stop=function(){clearTimeout(c.timerId)},this.delayInMillisec=a,this.successCallback=b}return a}();b.Timer=c}),define("src/common.browser/WebsocketMessageAdapter",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b,d){var e=this;if(this.Open=function(){return e.connectionState===c.ConnectionState.Disconnected?c.PromiseHelper.FromError("Cannot open a connection that is in "+e.connectionState+" state"):e.connectionEstablishDeferral?e.connectionEstablishDeferral.Promise():(e.connectionEstablishDeferral=new c.Deferred,e.connectionState=c.ConnectionState.Connecting,e.websocketClient=new WebSocket(e.uri),e.receivingMessageQueue=new c.Queue,e.disconnectDeferral=new c.Deferred,e.sendMessageQueue=new c.Queue,e.ProcessSendQueue(),e.OnEvent(new c.ConnectionStartEvent(e.connectionId,e.uri)),e.websocketClient.onopen=function(a){e.connectionState=c.ConnectionState.Connected,e.OnEvent(new c.ConnectionEstablishedEvent(e.connectionId)),e.connectionEstablishDeferral.Resolve(new c.ConnectionOpenResponse(200,""))},e.websocketClient.onerror=function(a){e.connectionState!==c.ConnectionState.Connecting},e.websocketClient.onclose=function(a){e.connectionState===c.ConnectionState.Connecting?(e.connectionState=c.ConnectionState.Disconnected,e.OnEvent(new c.ConnectionEstablishErrorEvent(e.connectionId,a.code,a.reason)),e.connectionEstablishDeferral.Resolve(new c.ConnectionOpenResponse(a.code,a.reason))):e.OnEvent(new c.ConnectionClosedEvent(e.connectionId,a.code,a.reason)),e.OnClose(a.code,a.reason)},e.websocketClient.onmessage=function(a){var b=(new Date).toISOString();if(e.connectionState===c.ConnectionState.Connected){var d=new c.Deferred;if(e.receivingMessageQueue.EnqueueFromPromise(d.Promise()),a.data instanceof Blob){var f=new FileReader;f.onload=function(a){var g=new c.RawWebsocketMessage(c.MessageType.Binary,f.result);e.messageFormatter.ToConnectionMessage(g).On(function(a){e.OnEvent(new c.ConnectionMessageReceivedEvent(e.connectionId,b,a)),d.Resolve(a)},function(a){d.Reject("Invalid binary message format. Error: "+a)})},f.onerror=function(a){d.Reject("Binary message parse error")},f.readAsArrayBuffer(a.data)}else{var g=new c.RawWebsocketMessage(c.MessageType.Text,a.data);e.messageFormatter.ToConnectionMessage(g).On(function(a){e.OnEvent(new c.ConnectionMessageReceivedEvent(e.connectionId,b,a)),d.Resolve(a)},function(a){d.Reject("Invalid text message format. Error: "+a)})}}},e.connectionEstablishDeferral.Promise())},this.Send=function(a){if(e.connectionState!==c.ConnectionState.Connected)return c.PromiseHelper.FromError("Cannot send on connection that is in "+e.connectionState+" state");var b=new c.Deferred,d=new c.Deferred;return e.sendMessageQueue.EnqueueFromPromise(d.Promise()),e.messageFormatter.FromConnectionMessage(a).On(function(c){d.Resolve({Message:a,RawWebsocketMessage:c,SendStatusDeferral:b})},function(a){d.Reject("Error formatting the message. "+a)}),b.Promise()},this.Read=function(){return e.connectionState!==c.ConnectionState.Connected?c.PromiseHelper.FromError("Cannot read on connection that is in "+e.connectionState+" state"):e.receivingMessageQueue.Dequeue()},this.Close=function(a){if(!e.websocketClient){var b=new c.Deferred;return b.Resolve(!0),b.Promise()}return e.connectionState!==c.ConnectionState.Connected&&e.websocketClient.close(1e3,a?a:"Normal closure by client"),e.disconnectDeferral.Promise()},this.SendRawMessage=function(a){try{return e.OnEvent(new c.ConnectionMessageSentEvent(e.connectionId,(new Date).toISOString(),a.Message)),e.websocketClient.send(a.RawWebsocketMessage.Payload),c.PromiseHelper.FromResult(!0)}catch(b){return c.PromiseHelper.FromError("websocket send error: "+b)}},this.OnClose=function(a,b){var d="Connection closed. "+a+": "+b;e.connectionState=c.ConnectionState.Disconnected,e.disconnectDeferral.Resolve(!0),e.receivingMessageQueue.Dispose(b),e.receivingMessageQueue.DrainAndDispose(function(a){},d),e.sendMessageQueue.DrainAndDispose(function(a){a.SendStatusDeferral.Reject(d)},d)},this.ProcessSendQueue=function(){e.sendMessageQueue.Dequeue().On(function(a){e.SendRawMessage(a).On(function(b){a.SendStatusDeferral.Resolve(b),e.ProcessSendQueue()},function(b){a.SendStatusDeferral.Reject(b),e.ProcessSendQueue()})},function(a){})},this.OnEvent=function(a){e.connectionEvents.OnEvent(a),c.Events.Instance.OnEvent(a)},!a)throw new c.ArgumentNullError("uri");if(!d)throw new c.ArgumentNullError("messageFormatter");this.connectionEvents=new c.EventSource,this.connectionId=b,this.messageFormatter=d,this.connectionState=c.ConnectionState.None,this.uri=a}return Object.defineProperty(a.prototype,"State",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Events",{get:function(){return this.connectionEvents},enumerable:!0,configurable:!0}),a}();b.WebsocketMessageAdapter=d}),define("src/common.browser/WebsocketConnection",["require","exports","src/common/Exports","src/common.browser/WebsocketMessageAdapter"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b,e,f,g){var h=this;if(this.isDisposed=!1,this.Dispose=function(){h.isDisposed=!0,h.connectionMessageAdapter&&h.connectionMessageAdapter.Close()},this.IsDisposed=function(){return h.isDisposed},this.State=function(){return h.connectionMessageAdapter.State},this.Open=function(){return h.connectionMessageAdapter.Open()},this.Send=function(a){return h.connectionMessageAdapter.Send(a)},this.Read=function(){return h.connectionMessageAdapter.Read()},!a)throw new c.ArgumentNullError("uri");if(!f)throw new c.ArgumentNullError("messageFormatter");this.messageFormatter=f;var i="",j=0;if(b)for(var k in b)if(k){i+=0===j?"?":"&";var l=encodeURIComponent(b[k]);i+=k+"="+l,j++}if(e)for(var m in e)if(m){i+=0===j?"?":"&";var l=encodeURIComponent(e[m]);i+=m+"="+l,j++}this.uri=a+i,this.id=g?g:c.CreateNoDashGuid(),this.connectionMessageAdapter=new d.WebsocketMessageAdapter(this.uri,this.Id,this.messageFormatter)}return Object.defineProperty(a.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Events",{get:function(){return this.connectionMessageAdapter.Events},enumerable:!0,configurable:!0}),a}();b.WebsocketConnection=e}),define("src/common.browser/Exports",["require","exports","src/common.browser/ConsoleLoggingListener","src/common.browser/LocalStorage","src/common.browser/MicAudioSource","src/common.browser/OpusRecorder","src/common.browser/PCMRecorder","src/common.browser/SessionStorage","src/common.browser/Timer","src/common.browser/WebsocketConnection","src/common.browser/WebsocketMessageAdapter"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),l(c),l(d),l(e),l(f),l(g),l(h),l(i),l(j),l(k)}),define("src/sdk/speech/IAuthentication",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.headerName=a,this.token=b}return Object.defineProperty(a.prototype,"HeaderName",{get:function(){return this.headerName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Token",{get:function(){return this.token},enumerable:!0,configurable:!0}),a}();b.AuthInfo=c}),define("src/sdk/speech/CognitiveSubscriptionKeyAuthentication",["require","exports","src/common/Exports","src/sdk/speech/IAuthentication"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e="Ocp-Apim-Subscription-Key",f=function(){function a(a){var b=this;if(this.Fetch=function(a){return c.PromiseHelper.FromResult(b.authInfo)},this.FetchOnExpiry=function(a){return c.PromiseHelper.FromResult(b.authInfo)},!a)throw new c.ArgumentNullError("subscriptionKey");this.authInfo=new d.AuthInfo(e,a)}return a}();b.CognitiveSubscriptionKeyAuthentication=f}),define("src/sdk/speech/CognitiveTokenAuthentication",["require","exports","src/common/Exports","src/sdk/speech/IAuthentication"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e="Authorization",f=function(){function a(a,b){var f=this;if(this.Fetch=function(a){return f.fetchCallback(a).OnSuccessContinueWith(function(a){return new d.AuthInfo(e,a)})},this.FetchOnExpiry=function(a){return f.fetchOnExpiryCallback(a).OnSuccessContinueWith(function(a){return new d.AuthInfo(e,a)})},!a)throw new c.ArgumentNullError("fetchCallback");if(!b)throw new c.ArgumentNullError("fetchOnExpiryCallback");this.fetchCallback=a,this.fetchOnExpiryCallback=b}return a}();b.CognitiveTokenAuthentication=f}),define("src/sdk/speech/RecognizerConfig",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Interactive=0]="Interactive",a[a.Conversation=1]="Conversation",a[a.Dictation=2]="Dictation"}(c=b.RecognitionMode||(b.RecognitionMode={}));var d;!function(a){a[a.Simple=0]="Simple",a[a.Detailed=1]="Detailed"}(d=b.SpeechResultFormat||(b.SpeechResultFormat={}));var e=function(){function a(a,b,e,h){void 0===b&&(b=c.Interactive),void 0===e&&(e="en-us"),void 0===h&&(h=d.Simple),this.recognitionMode=c.Interactive,this.speechConfig=a?a:new f(new g(null,null)),this.recognitionMode=b,this.language=e,this.format=h,this.recognitionActivityTimeout=b===c.Interactive?8e3:25e3}return Object.defineProperty(a.prototype,"RecognitionMode",{get:function(){return this.recognitionMode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Language",{get:function(){return this.language},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Format",{get:function(){return this.format},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"SpeechConfig",{get:function(){return this.speechConfig},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"RecognitionActivityTimeout",{get:function(){return this.recognitionActivityTimeout},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsContinuousRecognition",{get:function(){return this.recognitionMode!==c.Interactive},enumerable:!0,configurable:!0}),a}();b.RecognizerConfig=e;var f=function(){function a(a){var b=this;this.Serialize=function(){return JSON.stringify(b,function(a,b){if(b&&"object"==typeof b){var c={};for(var d in b)Object.hasOwnProperty.call(b,d)&&(c[d&&d.charAt(0).toLowerCase()+d.substring(1)]=b[d]);return c}return b})},this.context=a}return Object.defineProperty(a.prototype,"Context",{get:function(){return this.context},enumerable:!0,configurable:!0}),a}();b.SpeechConfig=f;var g=function(){function a(a,b){this.system=new h,this.os=a,this.device=b}return Object.defineProperty(a.prototype,"System",{get:function(){return this.system},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"OS",{get:function(){return this.os},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Device",{get:function(){return this.device},enumerable:!0,configurable:!0}),a}();b.Context=g;var h=function(){function a(){this.version="1.0.00000"}return Object.defineProperty(a.prototype,"Version",{get:function(){return this.version},enumerable:!0,configurable:!0}),a}();b.System=h;var i=function(){function a(a,b,c){this.platform=a,this.name=b,this.version=c}return Object.defineProperty(a.prototype,"Platform",{get:function(){return this.platform},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Version",{get:function(){return this.version},enumerable:!0,configurable:!0}),a}();b.OS=i;var j=function(){function a(a,b,c){this.manufacturer=a,this.model=b,this.version=c}return Object.defineProperty(a.prototype,"Manufacturer",{get:function(){return this.manufacturer},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Model",{get:function(){return this.model},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Version",{get:function(){return this.version},enumerable:!0,configurable:!0}),a}();b.Device=j}),define("src/sdk/speech/IConnectionFactory",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("src/sdk/speech/SpeechResults",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Success=0]="Success",a[a.NoMatch=1]="NoMatch",a[a.InitialSilenceTimeout=2]="InitialSilenceTimeout",a[a.BabbleTimeout=3]="BabbleTimeout",a[a.Error=4]="Error",a[a.EndOfDictation=5]="EndOfDictation"}(c=b.RecognitionStatus||(b.RecognitionStatus={}))}),define("src/sdk/speech/RecognitionEvents",["require","exports","src/common/Exports"],function(a,c,d){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var e=function(a){function c(b,c,e){void 0===e&&(e=d.EventType.Info);var f=a.call(this,b,e)||this;return f.requestId=c,f}return b(c,a),Object.defineProperty(c.prototype,"RequestId",{get:function(){return this.requestId},enumerable:!0,configurable:!0}),c}(d.PlatformEvent);c.SpeechRecognitionEvent=e;var f=function(a){function c(b,c,d){var e=a.call(this,b,c)||this;return e.result=d,e}return b(c,a),Object.defineProperty(c.prototype,"Result",{get:function(){return this.result},enumerable:!0,configurable:!0}),c}(e);c.SpeechRecognitionResultEvent=f;var g=function(a){function c(b,c,d){var e=a.call(this,"RecognitionTriggeredEvent",b)||this;return e.audioSourceId=c,e.audioNodeId=d,e}return b(c,a),Object.defineProperty(c.prototype,"AudioSourceId",{get:function(){return this.audioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),c}(e);c.RecognitionTriggeredEvent=g;var h=function(a){function c(b,c,d){var e=a.call(this,"ListeningStartedEvent",b)||this;return e.audioSourceId=c,e.audioNodeId=d,e}return b(c,a),Object.defineProperty(c.prototype,"AudioSourceId",{get:function(){return this.audioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),c}(e);c.ListeningStartedEvent=h;var i=function(a){function c(b,c,d){var e=a.call(this,"ConnectingToServiceEvent",b)||this;return e.authFetchEventid=c,e.connectionId=d,e}return b(c,a),Object.defineProperty(c.prototype,"AuthFetchEventid",{get:function(){return this.authFetchEventid},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ConnectionId",{get:function(){return this.connectionId},enumerable:!0,configurable:!0}),c}(e);c.ConnectingToServiceEvent=i;var j=function(a){function c(b,c,d,e,f){var g=a.call(this,"RecognitionStartedEvent",b)||this;return g.audioSourceId=c,g.audioNodeId=d,g.authFetchEventId=e,g.connectionId=f,g}return b(c,a),Object.defineProperty(c.prototype,"AudioSourceId",{get:function(){return this.audioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AuthFetchEventId",{get:function(){return this.authFetchEventId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ConnectionId",{get:function(){return this.connectionId},enumerable:!0,configurable:!0}),c}(e);c.RecognitionStartedEvent=j;var k=function(a){function c(b,c){return a.call(this,"SpeechStartDetectedEvent",b,c)||this}return b(c,a),c}(f);c.SpeechStartDetectedEvent=k;var l=function(a){function c(b,c){return a.call(this,"SpeechHypothesisEvent",b,c)||this}return b(c,a),c}(f);c.SpeechHypothesisEvent=l;var m=function(a){function c(b,c){return a.call(this,"SpeechEndDetectedEvent",b,c)||this}return b(c,a),c}(f);c.SpeechEndDetectedEvent=m;var n=function(a){function c(b,c){return a.call(this,"SpeechSimplePhraseEvent",b,c)||this}return b(c,a),c}(f);c.SpeechSimplePhraseEvent=n;var o=function(a){function c(b,c){return a.call(this,"SpeechDetailedPhraseEvent",b,c)||this}return b(c,a),c}(f);c.SpeechDetailedPhraseEvent=o;var p;!function(a){a[a.Success=0]="Success",a[a.AudioSourceError=1]="AudioSourceError",a[a.AudioSourceTimeout=2]="AudioSourceTimeout",a[a.AuthTokenFetchError=3]="AuthTokenFetchError",a[a.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",a[a.UnAuthorized=5]="UnAuthorized",a[a.ConnectTimeout=6]="ConnectTimeout",a[a.ConnectError=7]="ConnectError",a[a.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",a[a.UnknownError=9]="UnknownError"}(p=c.RecognitionCompletionStatus||(c.RecognitionCompletionStatus={}));var q=function(a){function c(b,c,e,f,g,h,i,j){var k=a.call(this,"RecognitionEndedEvent",b,i===p.Success?d.EventType.Info:d.EventType.Error)||this;return k.audioSourceId=c,k.audioNodeId=e,k.connectionId=g,k.authFetchEventId=f,k.serviceTag=h,k}return b(c,a),Object.defineProperty(c.prototype,"AudioSourceId",{get:function(){return this.audioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AuthFetchEventId",{get:function(){return this.authFetchEventId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ConnectionId",{get:function(){return this.connectionId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ServiceTag",{get:function(){return this.serviceTag},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Status",{get:function(){return this.status},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Error",{get:function(){return this.error},enumerable:!0,configurable:!0}),c}(e);c.RecognitionEndedEvent=q}),define("src/sdk/speech/ServiceTelemetryListener.Internal",["require","exports","src/common/Exports","src/sdk/speech/RecognitionEvents"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b,e){var f=this;this.isDisposed=!1,this.listeningTriggerMetric=null,this.micMetric=null,this.connectionEstablishMetric=null,this.OnEvent=function(a){f.isDisposed||(a instanceof d.RecognitionTriggeredEvent&&a.RequestId===f.requestId&&(f.listeningTriggerMetric={End:a.EventTime,Name:"ListeningTrigger",Start:a.EventTime}),a instanceof c.AudioStreamNodeAttachingEvent&&a.AudioSourceId===f.audioSourceId&&a.AudioNodeId===f.audioNodeId&&(f.micStartTime=a.EventTime),a instanceof c.AudioStreamNodeAttachedEvent&&a.AudioSourceId===f.audioSourceId&&a.AudioNodeId===f.audioNodeId&&(f.micStartTime=a.EventTime),a instanceof c.AudioSourceErrorEvent&&a.AudioSourceId===f.audioSourceId&&(f.micMetric||(f.micMetric={End:a.EventTime,Error:a.Error,Name:"Microphone",Start:f.micStartTime})),a instanceof c.AudioStreamNodeErrorEvent&&a.AudioSourceId===f.audioSourceId&&a.AudioNodeId===f.audioNodeId&&(f.micMetric||(f.micMetric={End:a.EventTime,Error:a.Error,Name:"Microphone",Start:f.micStartTime})),a instanceof c.AudioStreamNodeDetachedEvent&&a.AudioSourceId===f.audioSourceId&&a.AudioNodeId===f.audioNodeId&&(f.micMetric||(f.micMetric={End:a.EventTime,Name:"Microphone",Start:f.micStartTime})),a instanceof d.ConnectingToServiceEvent&&a.RequestId===f.requestId&&(f.connectionId=a.ConnectionId),a instanceof c.ConnectionStartEvent&&a.ConnectionId===f.connectionId&&(f.connectionStartTime=a.EventTime),a instanceof c.ConnectionEstablishedEvent&&a.ConnectionId===f.connectionId&&(f.connectionEstablishMetric||(f.connectionEstablishMetric={End:a.EventTime,Id:f.connectionId,Name:"Connection",Start:f.connectionStartTime})),a instanceof c.ConnectionEstablishErrorEvent&&a.ConnectionId===f.connectionId&&(f.connectionEstablishMetric||(f.connectionEstablishMetric={End:a.EventTime,Error:f.GetConnectionError(a.StatusCode),Id:f.connectionId,Name:"Connection",Start:f.connectionStartTime})),a instanceof c.ConnectionMessageReceivedEvent&&a.ConnectionId===f.connectionId&&a.Message&&a.Message.Headers&&a.Message.Headers.path&&(f.receivedMessages[a.Message.Headers.path]||(f.receivedMessages[a.Message.Headers.path]=new Array),f.receivedMessages[a.Message.Headers.path].push(a.NetworkReceivedTime)))},this.GetTelemetry=function(){var a=new Array;f.listeningTriggerMetric&&a.push(f.listeningTriggerMetric),f.micMetric&&a.push(f.micMetric),f.connectionEstablishMetric&&a.push(f.connectionEstablishMetric);var b={Metrics:a,ReceivedMessages:f.receivedMessages},c=JSON.stringify(b);return f.receivedMessages={},f.listeningTriggerMetric=null,f.micMetric=null,f.connectionEstablishMetric=null,c},this.Dispose=function(){f.isDisposed=!0},this.GetConnectionError=function(a){switch(a){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+a.toString()}},this.requestId=a,this.audioSourceId=b,this.audioNodeId=e,this.receivedMessages={}}return a}();b.ServiceTelemetryListener=e}),define("src/sdk/speech/SpeechConnectionMessage.Internal",["require","exports","src/common/Exports"],function(a,c,d){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var e="path",f="content-type",g="x-requestid",h="x-timestamp",i=function(a){function c(b,c,i,j,k,l,m){var n=this;if(!c)throw new d.ArgumentNullError("path");if(!i)throw new d.ArgumentNullError("requestId");var o={};if(o[e]=c,o[g]=i,o[h]=(new Date).toISOString(),j&&(o[f]=j),l)for(var p in l)p&&(o[p]=l[p]);return n=m?a.call(this,b,k,o,m)||this:a.call(this,b,k,o)||this,n.path=c,n.requestId=i,n.contentType=j,n.additionalHeaders=l,n}return b(c,a),Object.defineProperty(c.prototype,"Path",{get:function(){return this.path},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"RequestId",{get:function(){return this.requestId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ContentType",{get:function(){return this.contentType},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AdditionalHeaders",{get:function(){return this.additionalHeaders},enumerable:!0,configurable:!0}),c}(d.ConnectionMessage);i.FromConnectionMessage=function(a){var b=null,c=null,d=null,j=null,k={};if(a.Headers)for(var l in a.Headers)l&&(l.toLowerCase()===e.toLowerCase()?b=a.Headers[l]:l.toLowerCase()===g.toLowerCase()?c=a.Headers[l]:l.toLowerCase()===h.toLowerCase()?j=a.Headers[l]:l.toLowerCase()===f.toLowerCase()?d=a.Headers[l]:k[l]=a.Headers[l]);return new i(a.MessageType,b,c,d,a.Body,k,a.Id)},c.SpeechConnectionMessage=i}),define("src/sdk/speech/Recognizer",["require","exports","src/common/Exports","src/sdk/speech/RecognitionEvents","src/sdk/speech/RecognizerConfig","src/sdk/speech/ServiceTelemetryListener.Internal","src/sdk/speech/SpeechConnectionMessage.Internal"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b,d,f){var h=this;if(this.Recognize=function(a,b){var d=new i(h.audioSource.Id(),a);return d.ListenForServiceTelemetry(h.audioSource.Events),h.audioSource.Attach(d.AudioNodeId).ContinueWithPromise(function(a){if(a.IsError)throw d.OnAudioSourceAttachCompleted(null,!0,a.Error),new Error(a.Error);d.OnAudioSourceAttachCompleted(a.Result,!1);var e=a.Result;return h.FetchConnection(d).OnSuccessContinueWith(function(a){var f=h.ReceiveMessage(a,d),g=h.SendSpeechConfig(d.RequestId,a,h.recognizerConfig.SpeechConfig.Serialize()).OnSuccessContinueWithPromise(function(c){return h.SendSpeechContext(d.RequestId,a,b).OnSuccessContinueWithPromise(function(b){return h.SendAudio(d.RequestId,a,e,d)})}),i=c.PromiseHelper.WhenAll([f,g]);return i.On(function(b){d.Dispose(),h.SendTelemetryData(d.RequestId,a,d.GetTelemetry())},function(b){d.Dispose(b),h.SendTelemetryData(d.RequestId,a,d.GetTelemetry())}),i}),d.CompletionPromise})},this.FetchConnection=function(a,b){if(void 0===b&&(b=!1),h.connectionFetchPromise)return h.connectionFetchPromise.Result().IsError||h.connectionFetchPromise.Result().Result.State()===c.ConnectionState.Disconnected?(h.connectionId=null,h.connectionFetchPromise=null,h.FetchConnection(a)):(a.OnPreConnectionStart(h.authFetchEventId,h.connectionId),a.OnConnectionEstablishCompleted(200),a.ListenForServiceTelemetry(h.connectionFetchPromise.Result().Result.Events),h.connectionFetchPromise);h.authFetchEventId=c.CreateNoDashGuid(),h.connectionId=c.CreateNoDashGuid(),a.OnPreConnectionStart(h.authFetchEventId,h.connectionId);var d=b?h.authentication.FetchOnExpiry(h.authFetchEventId):h.authentication.Fetch(h.authFetchEventId);return h.connectionFetchPromise=d.ContinueWithPromise(function(d){if(d.IsError)throw a.OnAuthCompleted(!0,d.Error),new Error(d.Error);a.OnAuthCompleted(!1);var e=h.connectionFactory.Create(h.recognizerConfig,d.Result,h.connectionId);return a.ListenForServiceTelemetry(e.Events),e.Open().OnSuccessContinueWithPromise(function(d){return 200===d.StatusCode?(a.OnConnectionEstablishCompleted(d.StatusCode),c.PromiseHelper.FromResult(e)):403!==d.StatusCode||b?(a.OnConnectionEstablishCompleted(d.StatusCode,d.Reason),c.PromiseHelper.FromError("Unable to contact server. StatusCode: "+d.StatusCode+", Reason: "+d.Reason)):h.FetchConnection(a,!0)})}),h.connectionFetchPromise},this.ReceiveMessage=function(a,b){return a.Read().OnSuccessContinueWithPromise(function(d){var f=g.SpeechConnectionMessage.FromConnectionMessage(d);if(f.RequestId.toLowerCase()===b.RequestId.toLowerCase())switch(f.Path.toLowerCase()){case"turn.start":b.OnServiceTurnStartResponse(JSON.parse(f.TextBody));break;case"speech.startDetected":b.OnServiceSpeechStartDetectedResponse(JSON.parse(f.TextBody));break;case"speech.hypothesis":b.OnServiceSpeechHypothesisResponse(JSON.parse(f.TextBody));break;case"speech.enddetected":b.OnServiceSpeechEndDetectedResponse(JSON.parse(f.TextBody));break;case"speech.phrase":h.recognizerConfig.IsContinuousRecognition&&h.SendTelemetryData(b.RequestId,a,b.GetTelemetry()),h.recognizerConfig.Format===e.SpeechResultFormat.Simple?b.OnServiceSimpleSpeechPhraseResponse(JSON.parse(f.TextBody)):b.OnServiceDetailedSpeechPhraseResponse(JSON.parse(f.TextBody));break;case"turn.end":
return b.OnServiceTurnEndResponse(),c.PromiseHelper.FromResult(!0)}return h.ReceiveMessage(a,b)})},this.SendSpeechConfig=function(a,b,d){return d&&h.connectionId!==h.speechConfigConnectionId?(h.speechConfigConnectionId=h.connectionId,b.Send(new g.SpeechConnectionMessage(c.MessageType.Text,"speech.config",a,"application/json",d))):c.PromiseHelper.FromResult(!0)},this.SendSpeechContext=function(a,b,d){return d?b.Send(new g.SpeechConnectionMessage(c.MessageType.Text,"speech.context",a,"application/json",d)):c.PromiseHelper.FromResult(!0)},this.SendTelemetryData=function(a,b,d){return b.Send(new g.SpeechConnectionMessage(c.MessageType.Text,"telemetry",a,"application/json",d))},this.SendAudio=function(a,b,d,e){return d.Read().OnSuccessContinueWithPromise(function(f){return e.IsSpeechEnded?c.PromiseHelper.FromResult(!0):f.IsEnd?b.Send(new g.SpeechConnectionMessage(c.MessageType.Binary,"audio",a,null,null)):b.Send(new g.SpeechConnectionMessage(c.MessageType.Binary,"audio",a,null,f.Buffer)).OnSuccessContinueWithPromise(function(c){return h.SendAudio(a,b,d,e)})})},!a)throw new c.ArgumentNullError("authentication");if(!b)throw new c.ArgumentNullError("connectionFactory");if(!d)throw new c.ArgumentNullError("audioSource");if(!f)throw new c.ArgumentNullError("recognizerConfig");this.authentication=a,this.connectionFactory=b,this.audioSource=d,this.recognizerConfig=f}return Object.defineProperty(a.prototype,"AudioSource",{get:function(){return this.audioSource},enumerable:!0,configurable:!0}),a}();b.Recognizer=h;var i=function(){function a(a,b){var e=this;this.isDisposed=!1,this.detachables=new Array,this.isAudioNodeDetached=!1,this.isCompleted=!1,this.OnAudioSourceAttachCompleted=function(a,b,c){e.audioNode=a,b?e.OnComplete(d.RecognitionCompletionStatus.AudioSourceError,c):e.OnEvent(new d.ListeningStartedEvent(e.requestId,e.audioSourceId,e.audioNodeId))},this.OnPreConnectionStart=function(a,b){e.authFetchEventId=a,e.connectionId=b,e.OnEvent(new d.ConnectingToServiceEvent(e.requestId,e.authFetchEventId,e.connectionId))},this.OnAuthCompleted=function(a,b){a&&e.OnComplete(d.RecognitionCompletionStatus.AuthTokenFetchError,b)},this.OnConnectionEstablishCompleted=function(a,b){return 200===a?void e.OnEvent(new d.RecognitionStartedEvent(e.RequestId,e.audioSourceId,e.audioNodeId,e.authFetchEventId,e.connectionId)):void(403===a?e.OnComplete(d.RecognitionCompletionStatus.UnAuthorized,b):e.OnComplete(d.RecognitionCompletionStatus.ConnectError,b))},this.OnServiceTurnStartResponse=function(a){a&&a.context&&a.context.serviceTag&&(e.serviceTag=a.context.serviceTag)},this.OnServiceSpeechStartDetectedResponse=function(a){e.OnEvent(new d.SpeechStartDetectedEvent(e.RequestId,a))},this.OnServiceSpeechHypothesisResponse=function(a){e.OnEvent(new d.SpeechHypothesisEvent(e.RequestId,a))},this.OnServiceSpeechEndDetectedResponse=function(a){e.DetachAudioNode(),e.OnEvent(new d.SpeechEndDetectedEvent(e.RequestId,a))},this.OnServiceSimpleSpeechPhraseResponse=function(a){e.OnEvent(new d.SpeechSimplePhraseEvent(e.RequestId,a))},this.OnServiceDetailedSpeechPhraseResponse=function(a){e.OnEvent(new d.SpeechDetailedPhraseEvent(e.RequestId,a))},this.OnServiceTurnEndResponse=function(){e.OnComplete(d.RecognitionCompletionStatus.Success)},this.OnConnectionError=function(a){e.OnComplete(d.RecognitionCompletionStatus.UnknownError,a)},this.Dispose=function(a){if(!e.isDisposed){e.OnComplete(d.RecognitionCompletionStatus.UnknownError,a),e.isDisposed=!0;for(var b=0,c=e.detachables;b<c.length;b++){var f=c[b];f.Detach()}e.serviceTelemetryListener.Dispose()}},this.GetTelemetry=function(){return e.serviceTelemetryListener.GetTelemetry()},this.OnComplete=function(a,b){e.isCompleted||(e.isCompleted=!0,e.DetachAudioNode(),e.OnEvent(new d.RecognitionEndedEvent(e.RequestId,e.audioSourceId,e.audioNodeId,e.authFetchEventId,e.connectionId,e.serviceTag,a,b?b:"")))},this.DetachAudioNode=function(){e.isAudioNodeDetached||(e.isAudioNodeDetached=!0,e.audioNode&&e.audioNode.Detach())},this.OnEvent=function(a){e.serviceTelemetryListener.OnEvent(a),c.Events.Instance.OnEvent(a),e.onEventCallback&&e.onEventCallback(a)},this.audioSourceId=a,this.onEventCallback=b,this.requestId=c.CreateNoDashGuid(),this.audioNodeId=c.CreateNoDashGuid(),this.requestCompletionDeferral=new c.Deferred,this.serviceTelemetryListener=new f.ServiceTelemetryListener(this.requestId,this.audioSourceId,this.audioNodeId),this.OnEvent(new d.RecognitionTriggeredEvent(this.RequestId,this.audioSourceId,this.audioNodeId))}return Object.defineProperty(a.prototype,"RequestId",{get:function(){return this.requestId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AudioNodeId",{get:function(){return this.audioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"CompletionPromise",{get:function(){return this.requestCompletionDeferral.Promise()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsSpeechEnded",{get:function(){return this.isAudioNodeDetached},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsCompleted",{get:function(){return this.isCompleted},enumerable:!0,configurable:!0}),a.prototype.ListenForServiceTelemetry=function(a){this.detachables.push(a.AttachListener(this.serviceTelemetryListener))},a}()}),define("src/sdk/speech/WebsocketMessageFormatter",["require","exports","src/common/Exports"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d="\r\n",e=function(){function a(){var a=this;this.ToConnectionMessage=function(b){var d=new c.Deferred;try{if(b.MessageType===c.MessageType.Text){var e=b.TextContent,f={},g=null;if(e){var h=e.split("\r\n\r\n");h&&h.length>0&&(f=a.ParseHeaders(h[0]),h.length>1&&(g=h[1]))}d.Resolve(new c.ConnectionMessage(b.MessageType,g,f,b.Id))}else if(b.MessageType===c.MessageType.Binary){var i=b.BinaryContent,f={},g=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");var j=new DataView(i),k=j.getInt16(0);if(i.byteLength<k+2)throw new Error("Invalid binary message format. Header content missing.");for(var l="",m=0;m<k;m++)l+=String.fromCharCode(j.getInt8(m+2));f=a.ParseHeaders(l),i.byteLength>k+2&&(g=i.slice(2+k)),d.Resolve(new c.ConnectionMessage(b.MessageType,g,f,b.Id))}}catch(n){d.Reject("Error formatting the message. Error: "+n)}return d.Promise()},this.FromConnectionMessage=function(b){var e=new c.Deferred;try{if(b.MessageType===c.MessageType.Text){var f=""+a.MakeHeaders(b)+d+(b.TextBody?b.TextBody:"");e.Resolve(new c.RawWebsocketMessage(c.MessageType.Text,f,b.Id))}else if(b.MessageType===c.MessageType.Binary){var g=a.MakeHeaders(b),h=b.BinaryBody,i=new FileReader;i.onload=function(){var a=new Int8Array(i.result),d=new ArrayBuffer(2+a.byteLength+(h?h.byteLength:0)),f=new DataView(d);f.setInt16(0,a.length);for(var g=0;g<a.byteLength;g++)f.setInt8(2+g,a[g]);if(h)for(var j=new Int8Array(h),g=0;g<j.byteLength;g++)f.setInt8(2+a.byteLength+g,j[g]);e.Resolve(new c.RawWebsocketMessage(c.MessageType.Binary,d,b.Id))},i.onerror=function(){e.Reject("failed to load headers into file reader")},i.readAsArrayBuffer(new Blob([g]))}}catch(j){e.Reject("Error formatting the message. "+j)}return e.Promise()},this.MakeHeaders=function(a){var b="";if(a.Headers)for(var c in a.Headers)c&&(b+=c+": "+a.Headers[c]+d);return b},this.ParseHeaders=function(a){var b={};if(a){var c=a.match(/[^\r\n]+/g);if(b)for(var d=0,e=c;d<e.length;d++){var f=e[d];if(f){var g=f.indexOf(":"),h=g>0?f.substr(0,g).trim().toLowerCase():f,i=g>0&&f.length>g+1?f.substr(g+1).trim():"";b[h]=i}}}return b}}return a}();b.WebsocketMessageFormatter=e}),define("src/sdk/speech/Exports",["require","exports","src/sdk/speech/CognitiveSubscriptionKeyAuthentication","src/sdk/speech/CognitiveTokenAuthentication","src/sdk/speech/IAuthentication","src/sdk/speech/RecognitionEvents","src/sdk/speech/Recognizer","src/sdk/speech/RecognizerConfig","src/sdk/speech/SpeechResults","src/sdk/speech/WebsocketMessageFormatter"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),k(c),k(d),k(e),k(f),k(g),k(h),k(i),k(j)}),define("src/sdk/speech.browser/SpeechConnectionFactory",["require","exports","src/common.browser/Exports","src/common/Exports","src/sdk/speech/Exports"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f="testhooks",g="X-ConnectionId",h=function(){function a(){var a=this;this.Create=function(b,d,h){var i="";switch(b.RecognitionMode){case e.RecognitionMode.Conversation:i=a.Host+a.ConversationRelativeUri;break;case e.RecognitionMode.Dictation:i=a.Host+a.DictationRelativeUri;break;default:i=a.Host+a.InteractiveRelativeUri}var j={format:e.SpeechResultFormat[b.Format].toString().toLowerCase(),language:b.Language};a.IsDebugModeEnabled&&(j[f]="1");var k={};return k[d.HeaderName]=d.Token,k[g]=h,j={},k={},new c.WebsocketConnection(i,j,k,new e.WebsocketMessageFormatter,h)}}return Object.defineProperty(a.prototype,"Host",{get:function(){return d.Storage.Local.GetOrAdd("Host","wss://speech.platform.bing.com")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"InteractiveRelativeUri",{get:function(){return d.Storage.Local.GetOrAdd("InteractiveRelativeUri","/speech/recognition/interactive/cognitiveservices/v1")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ConversationRelativeUri",{get:function(){return d.Storage.Local.GetOrAdd("ConversationRelativeUri","/speech/recognition/conversation/cognitiveservices/v1")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"DictationRelativeUri",{get:function(){return d.Storage.Local.GetOrAdd("DictationRelativeUri","/speech/recognition/dictation/cognitiveservices/v1")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsDebugModeEnabled",{get:function(){var a=d.Storage.Local.GetOrAdd("IsDebugModeEnabled","false");return"true"===a.toLowerCase()},enumerable:!0,configurable:!0}),a}();b.SpeechConnectionFactory=h}),define("src/sdk/speech.browser/Recognizer",["require","exports","src/common.browser/Exports","src/sdk/speech/Exports","src/sdk/speech.browser/SpeechConnectionFactory"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(a,b){return g(a,b)};b.CreateRecognizer=f;var g=function(a,b){return h(a,b,new c.MicAudioSource(new c.PcmRecorder))};b.CreateRecognizerWithPcmRecorder=g;var h=function(a,b,c){return new d.Recognizer(b,new e.SpeechConnectionFactory,c,a)};b.CreateRecognizerWithCustomAudioSource=h}),define("src/sdk/speech.browser/Exports",["require","exports","src/sdk/speech.browser/Recognizer","src/sdk/speech.browser/SpeechConnectionFactory"],function(a,b,c,d){"use strict";function e(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),e(c),e(d)}),define("Speech.Browser.Sdk",["require","exports","src/common.browser/Exports","src/common/Exports","src/common/Exports","src/common.browser/Exports","src/sdk/speech/Exports","src/sdk/speech.browser/Exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),d.Events.Instance.AttachListener(new c.ConsoleLoggingListener),i(e),i(f),i(g),i(h)}),a&&a()},function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;a<b;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j="function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){j=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.DMVAST=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}return a}(),b.exports=d},{}],3:[function(a,b,c){var d,e,f;e=a("./parser"),f=a("./util"),d=function(){function a(){}return a.cappingFreeLunch=0,a.cappingMinimumTimeInterval=0,a.options={withCredentials:!1,timeout:0},a.get=function(a,b,d){var f,g,h,i;if(g=+new Date,f=c.extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},d||("function"==typeof b&&(d=b),h={}),h=f(this.options,b),this.totalCallsTimeout<g?(this.totalCalls=1,this.totalCallsTimeout=g+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls)return void d(null,new Error("VAST call canceled  FreeLunch capping not reached yet "+this.totalCalls+"/"+this.cappingFreeLunch));if(i=g-this.lastSuccessfullAd,i<0)this.lastSuccessfullAd=0;else if(i<this.cappingMinimumTimeInterval)return void d(null,new Error("VAST call canceled  ("+this.cappingMinimumTimeInterval+")ms minimum interval reached"));return e.parse(a,h,function(a){return function(a,b){return d(a,b)}}(this))},function(){var b,c;c=f.storage,b=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(d){b(a,d,{get:function(){return c.getItem(d)},set:function(a){return c.setItem(d,a)},configurable:!1,enumerable:!0})}),null==a.lastSuccessfullAd&&(a.lastSuccessfullAd=0),null==a.totalCalls&&(a.totalCalls=0),null==a.totalCallsTimeout&&(a.totalCallsTimeout=0)}(),a}(),b.exports=d},{"./parser":12,"./util":18}],4:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}}return a}(),b.exports=d},{}],5:[function(a,b,c){var d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;d=function(){function a(){this.trackingEvents={}}return a}(),f=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}return h(b,a),b}(d),g=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[]}return h(b,a),b}(d),e=function(a){function b(){this.type="companion",this.variations=[]}return h(b,a),b}(d),b.exports={VASTCreativeLinear:f,VASTCreativeNonLinear:g,VASTCreativeCompanion:e}},{}],6:[function(a,b,c){var d;d=function(){function a(){this.attributes={},this.children=[]}return a}(),b.exports=d},{}],7:[function(a,b,c){var d;d=function(){function a(){this.name=null,this.value=null,this.attributes={}}return a}(),b.exports=d},{}],8:[function(a,b,c){var d;d=function(){function a(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}return a}(),b.exports=d},{}],9:[function(a,b,c){b.exports={client:a("./client"),tracker:a("./tracker"),parser:a("./parser"),util:a("./util")}},{"./client":3,"./parser":12,"./tracker":14,"./util":18}],10:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}return a}(),b.exports=d},{}],11:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.width=0,this.height=0,this.minSuggestedDuration="00:00:00",this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null}return a}(),b.exports=d},{}],12:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=a("./urlhandler"),q=a("./response"),f=a("./ad"),g=a("./extension"),h=a("./extensionchild"),r=a("./util"),k=a("./creative").VASTCreativeLinear,j=a("./creative").VASTCreativeCompanion,l=a("./creative").VASTCreativeNonLinear,n=a("./mediafile"),m=a("./icon"),i=a("./companionad"),o=a("./nonlinear"),d=a("events").EventEmitter,p=function(){function a(){}var b;return b=[],a.addURLTemplateFilter=function(a){"function"==typeof a&&b.push(a)},a.removeURLTemplateFilter=function(){return b.pop()},a.countURLTemplateFilters=function(){return b.length},a.clearUrlTemplateFilters=function(){return b=[]},a.parse=function(a,b,c){return c||("function"==typeof b&&(c=b),b={}),this._parse(a,null,b,function(a,b){return c(b,a)})},a.vent=new d,a.track=function(a,b){return this.vent.emit("VAST-error",b),r.track(a,b)},a.on=function(a,b){return this.vent.on(a,b)},a.once=function(a,b){return this.vent.once(a,b)},a._parse=function(a,c,d,f){var g,h,i;for(f||("function"==typeof d&&(f=d),d={}),h=0,i=b.length;h<i;h++)g=b[h],a=g(a);return null==c&&(c=[]),c.push(a),e.get(a,d,function(b){return function(e,g){var h,i,j,k,l,m,n,o,p,r,t;if(null!=e)return f(e);if(t=new q,null==(null!=g?g.documentElement:void 0)||"VAST"!==g.documentElement.nodeName)return f(new Error("Invalid VAST XMLDocument"));for(p=g.documentElement.childNodes,j=0,l=p.length;j<l;j++)o=p[j],"Error"===o.nodeName&&t.errorURLTemplates.push(b.parseNodeText(o));for(r=g.documentElement.childNodes,k=0,m=r.length;k<m;k++)o=r[k],"Ad"===o.nodeName&&(h=b.parseAdElement(o),null!=h?t.ads.push(h):b.track(t.errorURLTemplates,{ERRORCODE:101}));for(i=function(a){var c,d,e,g;if(null==a&&(a=!1),t){for(e=!0,g=t.ads,c=0,d=g.length;c<d;c++){if(h=g[c],null!=h.nextWrapperURL)return;h.creatives.length>0&&(e=!1)}return e&&(a||b.track(t.errorURLTemplates,{ERRORCODE:303})),0===t.ads.length&&(t=null),f(null,t)}},n=t.ads.length;n--;)h=t.ads[n],null!=h.nextWrapperURL&&!function(e){var f,g,h;return c.length>=10||(h=e.nextWrapperURL,s.call(c,h)>=0)?(b.track(e.errorURLTemplates,{ERRORCODE:302}),t.ads.splice(t.ads.indexOf(e),1),void i()):(0===e.nextWrapperURL.indexOf("//")?(g=location.protocol,e.nextWrapperURL=""+g+e.nextWrapperURL):e.nextWrapperURL.indexOf("://")===-1&&(f=a.slice(0,a.lastIndexOf("/")),e.nextWrapperURL=f+"/"+e.nextWrapperURL),b._parse(e.nextWrapperURL,c,d,function(a,c){var d,f,g,h,j,k,l,m,n,o,p,q,r,s,u,v,w,x,y,z,A;if(g=!1,null!=a)b.track(e.errorURLTemplates,{ERRORCODE:301}),t.ads.splice(t.ads.indexOf(e),1),g=!0;else if(null==c)b.track(e.errorURLTemplates,{ERRORCODE:303}),t.ads.splice(t.ads.indexOf(e),1),g=!0;else for(t.errorURLTemplates=t.errorURLTemplates.concat(c.errorURLTemplates),j=t.ads.indexOf(e),t.ads.splice(j,1),v=c.ads,k=0,l=v.length;k<l;k++){if(A=v[k],A.errorURLTemplates=e.errorURLTemplates.concat(A.errorURLTemplates),A.impressionURLTemplates=e.impressionURLTemplates.concat(A.impressionURLTemplates),null!=e.trackingEvents)for(w=A.creatives,q=0,m=w.length;q<m;q++)if(f=w[q],"linear"===f.type||"nonlinear"===f.type)for(x=Object.keys(e.trackingEvents),r=0,n=x.length;r<n;r++)h=x[r],(d=f.trackingEvents)[h]||(d[h]=[]),f.trackingEvents[h]=f.trackingEvents[h].concat(e.trackingEvents[h]);if(null!=e.videoClickTrackingURLTemplates)for(y=A.creatives,s=0,o=y.length;s<o;s++)f=y[s],"linear"===f.type&&(f.videoClickTrackingURLTemplates=f.videoClickTrackingURLTemplates.concat(e.videoClickTrackingURLTemplates));if(null!=e.videoClickThroughURLTemplate)for(z=A.creatives,u=0,p=z.length;u<p;u++)f=z[u],"linear"===f.type&&null==f.videoClickThroughURLTemplate&&(f.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate);t.ads.splice(++j,0,A)}return delete e.nextWrapperURL,i(g)}))}(h);return i()}}(this))},a.childByName=function(a,b){var c,d,e,f;for(f=a.childNodes,d=0,e=f.length;d<e;d++)if(c=f[d],c.nodeName===b)return c},a.childsByName=function(a,b){var c,d,e,f,g;for(d=[],g=a.childNodes,e=0,f=g.length;e<f;e++)c=g[e],c.nodeName===b&&d.push(c);return d},a.parseAdElement=function(a){var b,c,d,e,f;for(e=a.childNodes,c=0,d=e.length;c<d;c++)if(b=e[c],"Wrapper"===(f=b.nodeName)||"InLine"===f){if(this.copyNodeAttribute("id",a,b),this.copyNodeAttribute("sequence",a,b),"Wrapper"===b.nodeName)return this.parseWrapperElement(b);if("InLine"===b.nodeName)return this.parseInLineElement(b)}},a.parseWrapperElement=function(a){var b,c,d,e,f,g,h;for(b=this.parseInLineElement(a),h=this.childByName(a,"VASTAdTagURI"),null!=h?b.nextWrapperURL=this.parseNodeText(h):(h=this.childByName(a,"VASTAdTagURL"),null!=h&&(b.nextWrapperURL=this.parseNodeText(this.childByName(h,"URL")))),f=b.creatives,d=0,e=f.length;d<e;d++)c=f[d],g=null,"linear"!==c.type&&"nonlinear"!==c.type||(g=c,null!=g&&(null!=g.trackingEvents&&(b.trackingEvents=g.trackingEvents),null!=g.videoClickTrackingURLTemplates&&(b.videoClickTrackingURLTemplates=g.videoClickTrackingURLTemplates),null!=g.videoClickThroughURLTemplate&&(b.videoClickThroughURLTemplate=g.videoClickThroughURLTemplate)));if(null!=b.nextWrapperURL)return b},a.parseInLineElement=function(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p;for(b=new f,b.id=a.getAttribute("id")||null,b.sequence=a.getAttribute("sequence")||null,n=a.childNodes,g=0,j=n.length;g<j;g++)switch(m=n[g],m.nodeName){case"Error":b.errorURLTemplates.push(this.parseNodeText(m));break;case"Impression":b.impressionURLTemplates.push(this.parseNodeText(m));break;case"Creatives":for(o=this.childsByName(m,"Creative"),h=0,k=o.length;h<k;h++)for(d=o[h],p=d.childNodes,i=0,l=p.length;i<l;i++)switch(e=p[i],e.nodeName){case"Linear":c=this.parseCreativeLinearElement(e),c&&b.creatives.push(c);break;case"NonLinearAds":c=this.parseNonLinear(e),c&&b.creatives.push(c);break;case"CompanionAds":c=this.parseCompanionAd(e),c&&b.creatives.push(c)}break;case"Extensions":this.parseExtension(b.extensions,this.childsByName(m,"Extension"));break;case"AdSystem":b.system={value:this.parseNodeText(m),version:m.getAttribute("version")||null};break;case"AdTitle":b.title=this.parseNodeText(m);break;case"Description":b.description=this.parseNodeText(m);break;case"Advertiser":b.advertiser=this.parseNodeText(m);break;case"Pricing":b.pricing={value:this.parseNodeText(m),model:m.getAttribute("model")||null,currency:m.getAttribute("currency")||null};break;case"Survey":b.survey=this.parseNodeText(m)}return b},a.parseExtension=function(a,b){var c,d,e,f,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(v=[],k=0,o=b.length;k<o;k++){if(i=b[k],d=new g,i.attributes)for(s=i.attributes,l=0,p=s.length;l<p;l++)j=s[l],d.attributes[j.nodeName]=j.nodeValue;for(t=i.childNodes,m=0,q=t.length;m<q;m++)if(c=t[m],"#text"!==c.nodeName)if("Responses"==c.nodeName){var w=[];c.childNodes.forEach(function(a){var b={attributes:{action:a.attributes.action.value,priority:a.attributes.priority.value},type:a.attributes.type.value},c=[];a.childNodes[0].childNodes.forEach(function(a){c.push({type:a.attributes.type.value,sequence:a.attributes.sequence.value,data:a.childNodes[0].data})}),b.value=c,w.push(b)}),d.children=w}else{if(e=new h,e.name=c.nodeName,e.value=this.parseNodeText(c),c.attributes)for(u=c.attributes,n=0,r=u.length;n<r;n++)f=u[n],e.attributes[f.nodeName]=f.nodeValue;d.children.push(e)}v.push(a.push(d))}return v},a.parseCreativeLinearElement=function(a){var b,c,d,e,f,g,h,i,j,l,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia;if(e=new k,e.duration=this.parseDuration(this.parseNodeText(this.childByName(a,"Duration"))),da=a.getAttribute("skipoffset"),null==da?e.skipDelay=null:"%"===da.charAt(da.length-1)?(P=parseInt(da,10),e.skipDelay=e.duration*(P/100)):e.skipDelay=this.parseDuration(da),ia=this.childByName(a,"VideoClicks"),null!=ia){for(e.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(ia,"ClickThrough")),S=this.childsByName(ia,"ClickTracking"),i=0,v=S.length;i<v;i++)d=S[i],e.videoClickTrackingURLTemplates.push(this.parseNodeText(d));for(T=this.childsByName(ia,"CustomClick"),s=0,w=T.length;s<w;s++)f=T[s],e.videoCustomClickURLTemplates.push(this.parseNodeText(f))}for(b=this.childByName(a,"AdParameters"),null!=b&&(e.adParameters=this.parseNodeText(b)),V=this.childsByName(a,"TrackingEvents"),t=0,y=V.length;t<y;t++)for(ga=V[t],W=this.childsByName(ga,"Tracking"),u=0,z=W.length;u<z;u++)if(fa=W[u],g=fa.getAttribute("event"),ha=this.parseNodeText(fa),null!=g&&null!=ha){if("progress"===g){if(N=fa.getAttribute("offset"),!N)continue;g="%"===N.charAt(N.length-1)?"progress-"+N:"progress-"+Math.round(this.parseDuration(N))}null==(c=e.trackingEvents)[g]&&(c[g]=[]),e.trackingEvents[g].push(ha)}for(X=this.childsByName(a,"MediaFiles"),G=0,A=X.length;G<A;G++)for(K=X[G],Y=this.childsByName(K,"MediaFile"),L=0,B=Y.length;L<B;L++)J=Y[L],I=new n,I.id=J.getAttribute("id"),I.fileURL=this.parseNodeText(J),I.deliveryType=J.getAttribute("delivery"),I.codec=J.getAttribute("codec"),I.mimeType=J.getAttribute("type"),I.apiFramework=J.getAttribute("apiFramework"),I.bitrate=parseInt(J.getAttribute("bitrate")||0),I.minBitrate=parseInt(J.getAttribute("minBitrate")||0),I.maxBitrate=parseInt(J.getAttribute("maxBitrate")||0),I.width=parseInt(J.getAttribute("width")||0),I.height=parseInt(J.getAttribute("height")||0),ca=J.getAttribute("scalable"),ca&&"string"==typeof ca&&(ca=ca.toLowerCase(),"true"===ca?I.scalable=!0:"false"===ca&&(I.scalable=!1)),H=J.getAttribute("maintainAspectRatio"),H&&"string"==typeof H&&(H=H.toLowerCase(),"true"===H?I.maintainAspectRatio=!0:"false"===H&&(I.maintainAspectRatio=!1)),e.mediaFiles.push(I);if(q=this.childByName(a,"Icons"),null!=q)for(Z=this.childsByName(q,"Icon"),M=0,C=Z.length;M<C;M++){for(p=Z[M],
j=new m,j.program=p.getAttribute("program"),j.height=parseInt(p.getAttribute("height")||0),j.width=parseInt(p.getAttribute("width")||0),j.xPosition=this.parseXPosition(p.getAttribute("xPosition")),j.yPosition=this.parseYPosition(p.getAttribute("yPosition")),j.apiFramework=p.getAttribute("apiFramework"),j.offset=this.parseDuration(p.getAttribute("offset")),j.duration=this.parseDuration(p.getAttribute("duration")),$=this.childsByName(p,"HTMLResource"),O=0,D=$.length;O<D;O++)h=$[O],j.type=h.getAttribute("creativeType")||"text/html",j.htmlResource=this.parseNodeText(h);for(_=this.childsByName(p,"IFrameResource"),Q=0,E=_.length;Q<E;Q++)r=_[Q],j.type=r.getAttribute("creativeType")||0,j.iframeResource=this.parseNodeText(r);for(aa=this.childsByName(p,"StaticResource"),R=0,F=aa.length;R<F;R++)ea=aa[R],j.type=ea.getAttribute("creativeType")||0,j.staticResource=this.parseNodeText(ea);if(o=this.childByName(p,"IconClicks"),null!=o)for(j.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(o,"IconClickThrough")),U=this.childsByName(o,"IconClickTracking"),ba=0,x=U.length;ba<x;ba++)l=U[ba],j.iconClickTrackingURLTemplates.push(this.parseNodeText(l));j.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(p,"IconViewTracking")),e.icons.push(j)}return e},a.parseNonLinear=function(a){var b,c,d,e,f,g,h,i,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(c=new l,w=this.childsByName(a,"TrackingEvents"),f=0,k=w.length;f<k;f++)for(E=w[f],x=this.childsByName(E,"Tracking"),h=0,m=x.length;h<m;h++)D=x[h],d=D.getAttribute("event"),F=this.parseNodeText(D),null!=d&&null!=F&&(null==(b=c.trackingEvents)[d]&&(b[d]=[]),c.trackingEvents[d].push(F));for(y=this.childsByName(a,"NonLinear"),i=0,n=y.length;i<n;i++){for(v=y[i],u=new o,u.id=v.getAttribute("id")||null,u.width=v.getAttribute("width"),u.height=v.getAttribute("height"),u.minSuggestedDuration=v.getAttribute("minSuggestedDuration"),u.apiFramework=v.getAttribute("apiFramework"),z=this.childsByName(v,"HTMLResource"),j=0,p=z.length;j<p;j++)e=z[j],u.type=e.getAttribute("creativeType")||"text/html",u.htmlResource=this.parseNodeText(e);for(A=this.childsByName(v,"IFrameResource"),s=0,q=A.length;s<q;s++)g=A[s],u.type=g.getAttribute("creativeType")||0,u.iframeResource=this.parseNodeText(g);for(B=this.childsByName(v,"StaticResource"),t=0,r=B.length;t<r;t++)C=B[t],u.type=C.getAttribute("creativeType")||0,u.staticResource=this.parseNodeText(C);u.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(v,"NonLinearClickThrough")),c.variations.push(u)}return c},a.parseCompanionAd=function(a){var b,c,d,e,f,g,h,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;for(f=new j,z=this.childsByName(a,"Companion"),k=0,p=z.length;k<p;k++){for(e=z[k],d=new i,d.id=e.getAttribute("id")||null,d.width=e.getAttribute("width"),d.height=e.getAttribute("height"),d.companionClickTrackingURLTemplates=[],A=this.childsByName(e,"HTMLResource"),m=0,q=A.length;m<q;m++)h=A[m],d.type=h.getAttribute("creativeType")||"text/html",d.htmlResource=this.parseNodeText(h);for(B=this.childsByName(e,"IFrameResource"),n=0,r=B.length;n<r;n++)l=B[n],d.type=l.getAttribute("creativeType")||0,d.iframeResource=this.parseNodeText(l);for(C=this.childsByName(e,"StaticResource"),o=0,s=C.length;o<s;o++)G=C[o],d.type=G.getAttribute("creativeType")||0,d.staticResource=this.parseNodeText(G);for(D=this.childsByName(e,"TrackingEvents"),w=0,t=D.length;w<t;w++)for(I=D[w],E=this.childsByName(I,"Tracking"),x=0,u=E.length;x<u;x++)H=E[x],g=H.getAttribute("event"),J=this.parseNodeText(H),null!=g&&null!=J&&(null==(b=d.trackingEvents)[g]&&(b[g]=[]),d.trackingEvents[g].push(J));for(F=this.childsByName(e,"CompanionClickTracking"),y=0,v=F.length;y<v;y++)c=F[y],d.companionClickTrackingURLTemplates.push(this.parseNodeText(c));d.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(e,"CompanionClickThrough")),d.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(e,"CompanionClickTracking")),f.variations.push(d)}return f},a.parseDuration=function(a){var b,c,d,e,f;return null==a?-1:(b=a.split(":"),3!==b.length?-1:(f=b[2].split("."),e=parseInt(f[0]),2===f.length&&(e+=parseFloat("0."+f[1])),d=parseInt(60*b[1]),c=parseInt(60*b[0]*60),isNaN(c||isNaN(d||isNaN(e||d>3600||e>60)))?-1:c+d+e))},a.parseXPosition=function(a){return"left"===a||"right"===a?a:parseInt(a||0)},a.parseYPosition=function(a){return"top"===a||"bottom"===a?a:parseInt(a||0)},a.parseNodeText=function(a){return a&&(a.textContent||a.text||"").trim()},a.copyNodeAttribute=function(a,b,c){var d;if(d=b.getAttribute(a))return c.setAttribute(a,d)},a}(),b.exports=p},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./icon":8,"./mediafile":10,"./nonlinear":11,"./response":13,"./urlhandler":15,"./util":18,events:1}],13:[function(a,b,c){var d;d=function(){function a(){this.ads=[],this.errorURLTemplates=[]}return a}(),b.exports=d},{}],14:[function(a,b,c){var d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;e=a("./client"),h=a("./util"),f=a("./creative").VASTCreativeLinear,d=a("events").EventEmitter,g=function(a){function b(a,b){var c,d,g;this.ad=a,this.creative=b,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],g=this.creative.trackingEvents;for(c in g)d=g[c],this.trackingEvents[c]=d.slice(0);this.creative instanceof f?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){e.lastSuccessfullAd=+new Date})}return i(b,a),b.prototype.setDuration=function(a){return this.assetDuration=a,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},b.prototype.setProgress=function(a){var b,c,d,e,f,g,h,i,j;if(i=null===this.skipDelay?this.skipDelayDefault:this.skipDelay,i===-1||this.skipable||(i>a?this.emit("skip-countdown",i-a):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(c=[],a>0){c.push("start"),f=Math.round(a/this.assetDuration*100),c.push("progress-"+f+"%"),c.push("progress-"+Math.round(a)),h=this.quartiles;for(g in h)j=h[g],j<=a&&a<=j+1&&c.push(g)}for(d=0,e=c.length;d<e;d++)b=c[d],this.track(b,!0);a<this.progress&&this.track("rewind")}return this.progress=a},b.prototype.setMuted=function(a){return this.muted!==a&&this.track(a?"mute":"unmute"),this.muted=a},b.prototype.setPaused=function(a){return this.paused!==a&&this.track(a?"pause":"resume"),this.paused=a},b.prototype.setFullscreen=function(a){return this.fullscreen!==a&&this.track(a?"fullscreen":"exitFullscreen"),this.fullscreen=a},b.prototype.setSkipDelay=function(a){if("number"==typeof a)return this.skipDelay=a},b.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},b.prototype.errorWithCode=function(a){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:a})},b.prototype.complete=function(){return this.track("complete")},b.prototype.close=function(){return this.track(this.linear?"closeLinear":"close")},b.prototype.stop=function(){},b.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},b.prototype.click=function(){var a,b,c;if((null!=(b=this.clickTrackingURLTemplates)?b.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(c={CONTENTPLAYHEAD:this.progressFormated()}),a=h.resolveURLTemplates([this.clickThroughURLTemplate],c)[0],this.emit("clickthrough",a)},b.prototype.track=function(a,b){var c,d;null==b&&(b=!1),"closeLinear"===a&&null==this.trackingEvents[a]&&null!=this.trackingEvents.close&&(a="close"),d=this.trackingEvents[a],c=this.emitAlwaysEvents.indexOf(a),null!=d?(this.emit(a,""),this.trackURLs(d)):c!==-1&&this.emit(a,""),b===!0&&(delete this.trackingEvents[a],c>-1&&this.emitAlwaysEvents.splice(c,1))},b.prototype.trackURLs=function(a,b){return null==b&&(b={}),this.linear&&(b.CONTENTPLAYHEAD=this.progressFormated()),h.track(a,b)},b.prototype.progressFormated=function(){var a,b,c,d,e;return e=parseInt(this.progress),a=e/3600,a.length<2&&(a="0"+a),b=e/60%60,b.length<2&&(b="0"+b),d=e%60,d.length<2&&(d="0"+b),c=parseInt(100*(this.progress-e)),a+":"+b+":"+d+"."+c},b}(d),b.exports=g},{"./client":3,"./creative":5,"./util":18,events:1}],15:[function(a,b,c){var d,e,f;f=a("./urlhandlers/xmlhttprequest"),e=a("./urlhandlers/flash"),d=function(){function b(){}return b.get=function(b,c,d){var g,h;return d||("function"==typeof c&&(d=c),c={}),null!=c.response?(h=c.response,delete c.response,d(null,h)):(null!=(g=c.urlhandler)?g.supported():void 0)?c.urlhandler.get(b,c,d):"undefined"==typeof window||null===window?a("./urlhandlers/node").get(b,c,d):f.supported()?f.get(b,c,d):e.supported()?e.get(b,c,d):d(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))},b}(),b.exports=d},{"./urlhandlers/flash":16,"./urlhandlers/xmlhttprequest":17}],16:[function(a,b,c){var d;d=function(){function a(){}return a.xdr=function(){var a;return window.XDomainRequest&&(a=new XDomainRequest),a},a.supported=function(){return!!this.xdr()},a.get=function(a,b,c){var d,e;return(e="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(e.async=!1,d=this.xdr(),d.open("GET",a,!0),d.timeout=b.timeout||0,d.withCredentials=b.withCredentials||!1,d.send(),d.onprogress=function(){},d.onload=function(){return e.loadXML(d.responseText),c(null,e)}):c(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"))},a}(),b.exports=d},{}],17:[function(a,b,c){var d;d=function(){function a(){}return a.xhr=function(){var a;if(a=new window.XMLHttpRequest,"withCredentials"in a)return a},a.supported=function(){return!!this.xhr()},a.get=function(a,b,c){var d;if("https:"===window.location.protocol&&0===a.indexOf("http://"))return c(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{return d=this.xhr(),d.open("GET",a,!0),d.timeout=b.timeout||0,d.withCredentials=b.withCredentials||!1,d.overrideMimeType&&d.overrideMimeType("text/xml"),d.onreadystatechange=function(){if(4===d.readyState)return 200===d.status?c(null,d.responseXML):c(new Error("XHRURLHandler: "+d.statusText))},d.send()}catch(e){return c(new Error("XHRURLHandler: Unexpected error"))}},a}(),b.exports=d},{}],18:[function(a,b,c){var d;d=function(){function a(){}return a.track=function(a,b){var c,d,e,f,g,h;for(d=this.resolveURLTemplates(a,b),h=[],f=0,g=d.length;f<g;f++)c=d[f],"undefined"!=typeof window&&null!==window&&(e=new Image,h.push(e.src=c));return h},a.resolveURLTemplates=function(a,b){var c,d,e,f,g,h,i,j,k;d=[],null==b&&(b={}),"CACHEBUSTING"in b||(b.CACHEBUSTING=Math.round(1e10*Math.random())),b.random=b.CACHEBUSTING;for(e=0,g=a.length;e<g;e++)if(c=a[e],j=c){for(f in b)k=b[f],h="["+f+"]",i="%%"+f+"%%",j=j.replace(h,k),j=j.replace(i,k);d.push(j)}return d},a.storage=function(){var a,b,c,d;try{c="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){d=e,c=null}return b=function(a){var b,c;try{if(c="__VASTUtil__",a.setItem(c,c),a.getItem(c)!==c)return!0}catch(d){return b=d,!0}return!1},(null==c||b(c))&&(a={},c={length:0,getItem:function(b){return a[b]},setItem:function(b,c){a[b]=c,this.length=Object.keys(a).length},removeItem:function(b){delete a[b],this.length=Object.keys(a).length},clear:function(){a={},this.length=0}}),c}(),a}(),b.exports=d},{}]},{},[9])(9)}),function(a){"use strict";var b,c=a.Base64,d="2.1.9";if("undefined"!=typeof module&&module.exports)try{b=require("buffer").Buffer}catch(e){}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a.charAt(c)]=c;return b}(f),h=String.fromCharCode,i=function(a){if(a.length<2){var b=a.charCodeAt(0);return b<128?a:b<2048?h(192|b>>>6)+h(128|63&b):h(224|b>>>12&15)+h(128|b>>>6&63)+h(128|63&b)}var b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return h(240|b>>>18&7)+h(128|b>>>12&63)+h(128|b>>>6&63)+h(128|63&b)},j=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,k=function(a){return a.replace(j,i)},l=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[f.charAt(c>>>18),f.charAt(c>>>12&63),b>=2?"=":f.charAt(c>>>6&63),b>=1?"=":f.charAt(63&c)];return d.join("")},m=a.btoa?function(b){return a.btoa(b)}:function(a){return a.replace(/[\s\S]{1,3}/g,l)},n=b?function(a){return(a.constructor===b.constructor?a:new b(a)).toString("base64")}:function(a){return m(k(a))},o=function(a,b){return b?n(String(a)).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):n(String(a))},p=function(a){return o(a,!0)},q=new RegExp(["[-][-]","[ -][-]{2}","[-][-]{3}"].join("|"),"g"),r=function(a){switch(a.length){case 4:var b=(7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3),c=b-65536;return h((c>>>10)+55296)+h((1023&c)+56320);case 3:return h((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return h((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},s=function(a){return a.replace(q,r)},t=function(a){var b=a.length,c=b%4,d=(b>0?g[a.charAt(0)]<<18:0)|(b>1?g[a.charAt(1)]<<12:0)|(b>2?g[a.charAt(2)]<<6:0)|(b>3?g[a.charAt(3)]:0),e=[h(d>>>16),h(d>>>8&255),h(255&d)];return e.length-=[0,0,2,1][c],e.join("")},u=a.atob?function(b){return a.atob(b)}:function(a){return a.replace(/[\s\S]{1,4}/g,t)},v=b?function(a){return(a.constructor===b.constructor?a:new b(a,"base64")).toString()}:function(a){return s(u(a))},w=function(a){return v(String(a).replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},x=function(){var b=a.Base64;return a.Base64=c,b};if(a.Base64={VERSION:d,atob:u,btoa:m,fromBase64:w,toBase64:o,utob:k,encode:o,encodeURI:p,btou:s,decode:w,noConflict:x},"function"==typeof Object.defineProperty){var y=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",y(function(){return w(this)})),Object.defineProperty(String.prototype,"toBase64",y(function(a){return o(this,a)})),Object.defineProperty(String.prototype,"toBase64URI",y(function(){return o(this,!0)}))}}a.Meteor&&(Base64=a.Base64)}(this),function(a){var b=/iPhone/i,c=/iPod/i,d=/iPad/i,e=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,f=/Android/i,g=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,h=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,i=/Windows Phone/i,j=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,k=/BlackBerry/i,l=/BB10/i,m=/Opera Mini/i,n=/(CriOS|Chrome)(?=.*\bMobile\b)/i,o=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,p=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),q=function(a,b){return a.test(b)},r=function(a){var r=a||navigator.userAgent,s=r.split("[FBAN");if("undefined"!=typeof s[1]&&(r=s[0]),s=r.split("Twitter"),"undefined"!=typeof s[1]&&(r=s[0]),this.apple={phone:q(b,r),ipod:q(c,r),tablet:!q(b,r)&&q(d,r),device:q(b,r)||q(c,r)||q(d,r)},this.amazon={phone:q(g,r),tablet:!q(g,r)&&q(h,r),device:q(g,r)||q(h,r)},this.android={phone:q(g,r)||q(e,r),tablet:!q(g,r)&&!q(e,r)&&(q(h,r)||q(f,r)),device:q(g,r)||q(h,r)||q(e,r)||q(f,r)},this.windows={phone:q(i,r),tablet:q(j,r),device:q(i,r)||q(j,r)},this.other={blackberry:q(k,r),blackberry10:q(l,r),opera:q(m,r),firefox:q(o,r),chrome:q(n,r),device:q(k,r)||q(l,r)||q(m,r)||q(o,r)||q(n,r)},this.seven_inch=q(p,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},s=function(){var a=new r;return a.Class=r,a};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=r:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=s():"function"==typeof define&&define.amd?define("isMobile",[],a.isMobile=s()):a.isMobile=s()}(this),function(a){var b={init:function(b){var c={loop:-1,scrolldelay:0,scrollamount:50,circular:!0,runshort:!0};return b&&a.extend(c,b),this.each(function(){var b=c.loop,d=a(this).addClass("str_wrap").data({scrollamount:c.scrollamount}),e=d.attr("style");if(e)for(var f=e.split(";"),g=!1,h=0;h<f.length;h++){var i=a.trim(f[h]),j=i.search(/^height/g);j!=-1&&(g=parseFloat(d.css("height")))}var k=function(){a(".str_move",d).length||d.wrapInner(a("<div>").addClass("str_move"));var e=a(".str_move",d).addClass("str_origin"),f=e.clone().removeClass("str_origin").addClass("str_move_clone"),g=0;d.addClass("noStop");var h=function(){f.clone().css({left:"100%",right:"auto",width:e.width()}).appendTo(e),f.css({right:"100%",left:"auto",width:e.width()}).appendTo(e)};if(d.height(e.outerHeight()),e.width()>d.width()){var i=-e.width();c.circular&&(h(),i=-(e.width()+(e.width()-d.width()))),e.css({left:d.width()+e.width()});var j=function(){var a=Math.abs(i),b=a/d.data("scrollamount")*1e3;return 0!=parseFloat(e.css("left"))&&(a+=d.width(),b=(a-(d.width()-parseFloat(e.css("left"))))/d.data("scrollamount")*1e3),b},k=!1,l=function(){0!=b&&e.stop(!0).animate({left:i},j(),"linear",function(){a(this).css({left:d.width()}),b==-1?k=setTimeout(l,c.scrolldelay):(b--,k=setTimeout(l,c.scrolldelay))})};d.data({moveId:k,moveF:l}),l()}else if(c.runshort){e.css({left:d.width()});var m=function(){return g=(e.width()+e.position().left)/d.data("scrollamount")*1e3},n=function(){var f=-e.width();e.animate({left:f},m(),"linear",function(){a(this).css({left:d.width()}),b==-1?setTimeout(n,c.scrolldelay):(b--,setTimeout(n,c.scrolldelay))})};d.data({moveF:n}),n()}else d.addClass("str_static")};k(),d.data({ini:k,startheight:g})})},update:function(){var b=a(this),c=a(".str_origin",b),d=a(".str_move_clone",b);c.stop(!0),d.remove(),b.data("ini")()},destroy:function(){var b=a(this),c=a(".str_move",b),d=b.data("startheight");a(".str_move_clone",b).remove(),b.removeClass("noStop").removeClass("str_vertical").removeClass("str_active").removeClass("no_drag").removeClass("str_static").removeClass("str_right").removeClass("str_down");var e=b.attr("style");if(e){for(var f=e.split(";"),g=0;g<f.length;g++){var h=a.trim(f[g]),i=h.search(/^height/g);i!=-1&&(f[g]="")}var j=f.join(";"),k=j.replace(/;+/g,";");";"==k?b.removeAttr("style"):b.attr("style",k),d&&b.css({height:d})}if(c.stop(!0),c.length){var l=c.html();c.remove(),b.html(l)}},pause:function(){var b=a(this),c=a(".str_move",b);c.stop(!0)},play:function(){var b=a(this),c=b.data("moveF");c&&c()}};a.fn.liMarquee2=function(a){return b[a]?b[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void 0:b.init.apply(this,arguments)}}(jQuery),function(){var AdMan,DOMAIN,TWEEN_STEP,debug,e,error1,getInternetExplorerVersion,getScriptPath,getSearch,ieVersion,local,path,search,tnsCounter;DOMAIN="instreamatic.com",getInternetExplorerVersion=function(){var a,b,c;return b=-1,"Microsoft Internet Explorer"===navigator.appName&&(c=navigator.userAgent,a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=a.exec(c)&&(b=parseFloat(RegExp.$1))),b},ieVersion=getInternetExplorerVersion(),getScriptPath=function(){var a,b,c;return a=document.getElementsByTagName("script"),c=a[a.length-1],b=c.src,b.substr(0,b.lastIndexOf("/")+1)},getSearch=function(){var a,b,c,d,e,f;for(a=window.location.search.split("?").pop().split("&"),f=[],c=d=0,e=a.length-1;0<=e?d<=e:d>=e;c=0<=e?++d:--d)b=a[c].split("="),f[b[0]]=b[1];return f},search=getSearch(),debug=!!(search.hasOwnProperty("preview")||search.hasOwnProperty("debug")||search.hasOwnProperty("dev")),path=getScriptPath(),local=/^http:\/\/un.local/.test(path),Math.sign=Math.sign||function(a){var b;return a=+a,0===a||isNaN(a)?a:null!=(b=a>0)?b:{1:-1}},AdMan=window.AdMan={version:null,debug:debug,isOldIE:ieVersion>-1&&ieVersion<11,requestTimeout:4e3,$:window.jQuery,path:path,local:!1,domain:{stat:"xs."+DOMAIN,ad:"x."+DOMAIN,dtmf:"dtmf."+DOMAIN},log:null,MIN_VOLUME:.3,FADE_TIME:2e3,FADE_STEP:100},AdMan.VoiceOption={languageOptions:"ru-RU",sourceOptions:"auto",SDK:null,recognizer:null,defaultTitle:"recognizing..."},AdMan.Test={debug:debug,social:debug?search.social:null,preview:search.preview||debug&&1},AdMan.PlayerDisableMode={NONE:0,MUTE:1,PAUSE:2},AdMan.PlayerDisableMode.ALL=AdMan.PlayerDisableMode.MUTE|AdMan.PlayerDisableMode.PAUSE,AdMan.version="0.3.6";try{module.exports=AdMan}catch(error1){e=error1}AdMan.getplatform=function(){return isMobile.any?"mobile":"desktop"},AdMan.getHostname=function(a){var b;return b=a.split("//")[1],b.split("/")[0]},AdMan.setDomain=function(a){switch(a){case"RUSSIA":return AdMan.domain.stat="xs."+DOMAIN,AdMan.domain.ad="x."+DOMAIN;case"GLOBAL":return AdMan.domain.stat="xs3."+DOMAIN,AdMan.domain.ad="x3."+DOMAIN;case"LOCAL":return AdMan.domain.stat="xs.un.local",AdMan.domain.ad="x.un.local"}},AdMan.random=function(){return Math.round(1e9*Math.random()).toString()},AdMan.Log=function(){function a(a,b){this.tag=a||"",this.enabled=null!=b?b:AdMan.debug}return a.prototype.call=function(a,b){if(this.enabled&&null!=window.console&&(Array.prototype.unshift.call(b,"AdMan[%s]:",this.tag),console[a]&&console[a].apply))return console[a].apply(console,b)},a.prototype.d=function(){return this.call("log",arguments)},a.prototype.i=function(){return this.call("info",arguments)},a.prototype.w=function(){return this.call("warn",arguments)},a.prototype.e=function(){return this.call("error",arguments)},a}(),TWEEN_STEP=100,AdMan.tween=function(a,b,c,d,e,f){var g,h;return h=(new Date).getTime(),g=setInterval(function(){var i,j;return i=(new Date).getTime(),i>=h+e?(clearInterval(g),a[b](d),AdMan.$.isFunction(f)?f():void 0):(j=c+(d-c)*(i-h)/e,a[b](j))},TWEEN_STEP)},AdMan.Dispatcher=function(){function a(){}return a.prototype.addListener=function(a){if(a)return this.listeners=this.listeners||[],this.listeners.push(a)},a.prototype.removeListener=function(a){var b;return!!(this.listeners&&a&&(b=this.listeners.indexOf(a),b>-1))&&(this.listeners.splice(b,1),!0)},a.prototype.dispatch=function(a,b){var c;if(this.listeners)return c=[].slice.call(arguments,1),AdMan.$.each(this.listeners,function(b,d){if(AdMan.$.isFunction(d["on_"+a]))return d["on_"+a].apply(d,c)})},a}(),AdMan.Dispatcher.extend=function(a){return a.prototype=AdMan.$.extend(!0,a.prototype,AdMan.Dispatcher.prototype)},AdMan.request=function(url,withCredentials,mailruSpike,xml){return new Promise(function(resolve,reject){var req;return null!=xml?DMVAST.client.get(url,{withCredentials:!!withCredentials,timeout:AdMan.requestTimeout},function(a){var b;return b=AdMan.Ad.newFromVAST(a),resolve(b)}):req=new AdMan.$.ajax({method:"GET",url:url,timeout:AdMan.requestTimeout,xhrFields:{withCredentials:!!withCredentials},success:function(response,status,xhr){var contentType,data,error,error2;contentType=xhr.getResponseHeader("Content-Type").split(";").shift(),data=xhr.responseText;try{("application/json"===contentType||mailruSpike)&&(data=JSON.parse(data)),"text/xml"===contentType&&(data=AdMan.Ad.newFromVAST(xhr.responseXML),null==data&&(data=xhr.responseXML)),"text/javascript"===contentType&&(data=eval(data))}catch(error2){error=error2,reject(error)}return resolve(data)},error:function(a,b,c){return reject(c)}})})},AdMan.requestp=function(a,b,c){return new Promise(function(d,f){var g;return g=AdMan.$.ajax({url:a,dataType:"jsonp",jsonp:"callback",timeout:AdMan.requestTimeout,success:function(a){var g;if(!c)return d(a);try{return a=a[0].html,null!=b&&(a=JSON.parse(a)),d(a)}catch(g){return e=g,f(e)}},error:function(a,b,c){return f(c)}})})},AdMan.initMobileAudio=function(){if(null==AdMan.audio)return AdMan.audio=new Audio,AdMan.audio.autoplay=!0,AdMan.audio.volume=1,AdMan.audio.play(),AdMan.audio.pause(),AdMan.log.i("initMobileAudio")},AdMan.initMobile=function(){var a;return a=document.getElementById("unisound-audio-tag"),a.play()},AdMan.Util={},AdMan.Util.toHHMMSS=function(a){var b,c,d;return null==a?"--:--:--":(a=Math.floor(a),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c,b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b+":"+c+":"+d)},AdMan.Util.toMMSS=function(a){var b,c;return null==a?"--:--":(a=Math.floor(a),b=Math.floor(a/60),c=a-60*b,b<10&&(b="0"+b),c<10&&(c="0"+c),b+":"+c)},AdMan.log=new AdMan.Log,AdMan.log.i(AdMan.version),AdMan.log.i("path: "+AdMan.path),AdMan.log.i("IsOldIE: "+AdMan.isOldIE),tnsCounter=new Image(1,1),tnsCounter.src="https://www.tns-counter.ru/V13a****unisound_net/ru/UTF-8/tmsec=unisound_total/"+AdMan.random(),tnsCounter.style.position="absolute",tnsCounter.style.width="0px",tnsCounter.style.height="0px",document.documentElement.appendChild(tnsCounter),AdMan.SetupVoiceScript=function(a){var b;return void 0===window.require?(b=document.createElement("script"),b.src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.3/require.min.js",document.head.appendChild(b),b.onload=function(){return window.initVoiceSDK(a)}):window.initVoiceSDK(a)},AdMan.activatedMicro=function(){return new Promise(function(a){return function(a,b){var c;try{return a(navigator.mediaDevices.getUserMedia({audio:!0}))}catch(c){return e=c,b(e)}}}(this))}}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=window.AdMan,a.Swf=function(e){function f(c,d,e){this.onSwfEvent=b(this.onSwfEvent,this),this.id="adman"+a.Swf.i++,this.addListener(d),this.embed(null,c,e||{}),a.Swf.CALLBACKS[this.id]=this.onSwfEvent}return c(f,e),f.i=0,f.CALLBACKS={},f.prototype.onSwfEvent=function(a,b,c){var d,e;try{return this.dispatch(a,b,c)}catch(e){return d=e,console.error(d.stack)}},f.prototype.embed=function(b,c,d){var e;return d.callback="AdMan.Swf.CALLBACKS."+this.id,e={params:{id:this.id,quality:"high",allowScriptAccess:"always",allowFullScreen:!0,wMode:"opaque",base:null,swLiveConnect:!0},properties:{name:this.id,width:"10",height:"10"},vars:d},this.swf=a.Swf.buildFlashElement(c,e),this.swf.style.position="absolute",this.swf.style.left="-10px",this.swf.style.top=0,null!=b?a.$(b).after(this.swf):a.$("body").append(this.swf)},f.toFlashVars=function(b,c){var e,f,g,h,i;g=[];for(e in b)if(d.call(b,e)){switch(i=b[e],c&&(e=c+":"+e),a.$.type(i)){case"object":h=this.toFlashVars(i,e);break;case"array":f={},i.each(function(a,b){return f[b]=a}),h=this.toFlashVars(f,e);break;default:h=e+"="+encodeURIComponent(i)}null!=i&&g.push(h)}return g.join("&")},f.buildFlashElement=function(a,b){var c,e,f,g,h,i,j,k,l;h=b.params,l=b.vars,i=b.properties,h.flashVars=this.toFlashVars(l),f=!1,f?(i.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",h.movie=a):i.type="application/x-shockwave-flash",i.data=a,c='<object id="'+h.id+'"';for(j in i)d.call(i,j)&&(k=i[j],c+=" "+j+'="'+k+'"');c+=">";for(g in h)d.call(h,g)&&(k=h[g],k&&(c+='<param name="'+g+'" value="'+k+'" />'));return c+="</object>",e=document.createElement("div"),e.innerHTML=c,e.firstChild},f.prototype.dispose=function(){if(null!=this.swf)return this.swf.dispose(),this.swf.parentNode.removeChild(this.swf)},f}(a.Dispatcher),a.Flash={version:0,build:0,refresh:function(){var a,b;return a=function(){var a,b,c;for(b=0,c=arguments.length;b<c;b++){a=arguments[b];try{return a()}catch(d){}}return null},b=a(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")},function(){return"0 r0"}).match(/\d+/g),this.version=Number(b[0]||"0."+b[1])||0,this.build=Number(b[2])||0}},a.Flash.refresh()}.call(this),function(){var a;a=window.AdMan,a.StatType={IMPRESSION:"impression",READY:"ready",ERROR:"error",CREATIVE_VIEW:"creativeView",START:"start",FIRST_QUARTILE:"firstQuartile",MIDPOINT:"midpoint",THIRD_QUARTILE:"thirdQuartile",COMPLETE:"complete",PROGRESS:"progress",PAUSE:"pause",RESUME:"resume",REWIND:"rewind",SKIP:"skip",MUTE:"mute",UNMUTE:"unmute",CLOSE:"close",CLICK:"click",LOAD:"load",REQUEST:"request",REQUEST_ERROR:"request_error",FETCHED:"fetched",CAN_SHOW:"can_show"},a.Stat=function(){function b(b,c,d,e){this.data=(null!=b?b:[]).slice(),this.log=null!=c?c:a.log,this.point=null!=d?d:"stat",this.protocol=null!=e?e:"//"}return b.prototype.get=function(a){var b;return b=document.createElement("img"),b.src=a},b.prototype.randomize=function(a){return a.replace("{random}",Math.round(1e9*Math.random()).toString())},b.prototype.send=function(a,b){var c,d,e,f,g,h,i,j,k;if(null!=this.data){for(c=[],h=this.data,d=0,f=h.length;d<f;d++)j=h[d],k=!1,j.type===a&&(null!=b?j.offset===b&&(this.log.i("Stat",a+(b?":"+b:""),j.url),this.get(this.randomize(j.url)),k=!0):(this.log.i("Stat",a+(b?":"+b:""),j.url),this.get(this.randomize(j.url)),k=!0)),k&&j.once&&c.push(j);for(i=[],e=0,g=c.length;e<g;e++)j=c[e],i.push(this.data.splice(this.data.indexOf(j),1));return i}},b.prototype.append=function(b,c,d,e,f,g){var h,i;return e=null!=e?e:{},h={},null!=d.slotId&&(h.t=d.slotId),null!=d.siteId&&(h.s=d.siteId),null!=d.playerId&&(h.p=d.playerId),null!=d.campaignId&&(h.c=d.campaignId),null!=d.bannerId&&(h.b=d.bannerId),null!=f&&(h.v=f),i={v:Base64.encode(JSON.stringify(h))},this.data.push({type:b,value:f,url:""+this.protocol+a.domain.stat+"/"+this.point+"/"+c+".gif?"+a.$.param(i)+"&r={random}",once:g})},b.prototype.appendTns=function(a,b){},b.prototype.appendValues=function(b,c,d,e){var f;return f={v:Base64.encode(JSON.stringify(d))},this.data.push({type:b,url:""+this.protocol+a.domain.stat+"/"+this.point+"/"+c+".gif?"+a.$.param(f)+"&r={random}",once:e})},b.prototype.sendValues=function(b,c){var d,e,f;return d={},null!=c.slotId&&(d.t=c.slotId),null!=c.siteId&&(d.s=c.siteId),null!=c.playerId&&(d.p=c.playerId),null!=c.campaignId&&(d.c=c.campaignId),null!=c.bannerId&&(d.b=c.bannerId),null!=c.formatId&&(d.f=c.formatId),null!=c.microphone&&(d.m=1),f={v:Base64.encode(JSON.stringify(d))},e=""+this.protocol+a.domain.stat+"/"+this.point+"/"+b+".gif?"+a.$.param(f)+"&r={random}",this.log.i("Stat",b,e),this.get(this.randomize(e))},b.buildSite=function(b){var c,d;return d={t:b.type,s:b.admanId.siteId,p:b.admanId.playerId},c=new a.Stat(null,b.log,"site",b.protocol),c.appendValues(a.StatType.LOAD,"load",d),c.appendValues(a.StatType.ERROR,"error",d),c},b}()}.call(this),function(){var a,b;a=window.AdMan,a.Type={AUDIO:"audio",FULLSCREEN:"image_640x640",VOICE:"voice",ANY:"any"},a.Slot={DEFAULT:null,PREROLL:"preroll",MIDROLL:"midroll"},a.InstreamaticSource=function(){function b(a){this.point="v2/vast",this.protocol=null!=a?a:"//"}return b.prototype.ID="instreamatic",b.prototype.load=function(b,c,d){var e,f,g;return g=""+this.protocol+a.domain.ad+"/"+this.point,null!=d.siteId&&(g+="/"+d.siteId),null!=d.playerId&&(g+="/"+d.playerId),e={},b!==a.Type.AUDIO&&(e.microphone="1"),e.type=b,c&&(e.slot=c),null!=d.zoneId&&(e.zone_id=d.zoneId),null!=d.userId&&(e.user_id=d.userId),null!=d.campaign_id&&(e.campaign_id=d.campaign_id),d.preview&&(e.preview=d.preview),d.language&&(e.lang=d.language),a.version&&(e.version=a.version),e.platform=a.getplatform(),e.r=a.random(),e=a.$.param(e),e.length>0&&(g+="?"+e),this.url=g,f=a.request(this.url,!0,void 0,!0),f.then(this.prepare)},b.prepare=function(a){return!a||a.empty?null:a},b.prototype.toString=function(){return"InstreamaticSource"},b}(),a.Marker=function(){function b(a){this.protocol=null!=a?a:"//";
}return b.prototype.mark=function(b){var c,d,e,f;return e=document.createElement("script"),e.src=""+this.protocol+a.domain.ad+"/mark/idsync.js?site_id="+b.siteId,document.documentElement.appendChild(e),c={},c.stationId=170713,null!=b.gdpr?c.gdpr=b.gdpr:c.gdpr="0",b.gdpr_consent&&(c.gdpr_consent=b.gdpr_consent),b.us_privacy&&(c.us_privacy=b.us_privacy),d=a.$.param(c),d.length>0&&(d="?"+d),f=document.createElement("script"),f.src=this.protocol+"playerservices.live.streamtheworld.com/api/idsync.js"+d,document.documentElement.appendChild(f)},b}(),b=function(){var a,b,c,d,e,f,g,h,i;if(h=window.navigator,a=["language","browserLanguage","systemLanguage","userLanguage"],Array.isArray(h.languages))for(i=h.languages,b=0,f=i.length;b<f;b++)if(e=i[b],e&&e.length)return e;for(c=0,g=a.length;c<g;c++)if(d=a[c],e=h[d],e&&e.length)return e},a.Data=function(){function c(b,c,d,e){this.type=e.type,this.log=null!=c?c:a.log,this.protocol=null!=d?d:"//",this.sources=[new a.InstreamaticSource(this.protocol)],this.marker=new a.Marker(this.protocol),this.setAdmanId(b)}return c.prototype.setUserId=function(a){return this.admanId.userId=a},c.prototype.setAdmanId=function(b){switch(a.$.type(b)){case"array":b={siteId:b[1],playerId:b[2]};break;case"object":null==b.desktop||isMobile.any?null!=b.mobile&&isMobile.any?b=b.mobile:null!=b.android&&isMobile.android.device?b=b.android:null!=b.apple&&isMobile.apple.device&&(b=b.apple):b=b.desktop}return this.parseAdmanId(b),this.log.i("Data","AdmanId",JSON.stringify(this.admanId))},c.prototype.parseAdmanId=function(c){switch(a.$.type(c)){case"number":this.admanId={siteId:c};break;case"object":this.admanId=c}if(!this.admanId.language)return this.admanId.language=b()},c.prototype.mark=function(b){var c;return c=a.$.extend({preview:a.Test.preview},this.admanId,b||{}),this.log.i("Data","mark",JSON.stringify(c)),this.marker.mark(c)},c.prototype.load=function(b,c,d){var e;return this.busy=!0,e=a.$.extend({preview:a.Test.preview},this.admanId,null!=d?d:{}),this.log.i("Data","load",JSON.stringify(e)),this._loadNext(0,b,c,e)},c.prototype._loadNext=function(b,c,d,e){return new Promise(function(f){return function(g,h){var i,j,k;return j=f.sources[b],j?(k=function(a){var h;return a?(f.log.i("Data",j,"success"),f.busy=!1,h=f.createStat(a.stats,c,e,a),g({section:a,stat:h})):(f.log.i("Data",j,"empty"),g(f._loadNext(b+1,c,d,e)))},i=function(h){return a.Error(h,self.admanId),f.log.i("Data",j,"failed",h),g(f._loadNext(b+1,c,d,e))},j.load(c,d,e).then(k,i),f.log.i("Data",j,"load",j.url)):(f.busy=!1,h("None"))}}(this))},c.prototype.createStat=function(b,c,d,e){var f;return f=new a.Stat(b,this.log),c===a.Type.AUDIO&&f.appendTns(a.StatType.PLAYBACK_STARTED,"adstart"),c===a.Type.FULLSCREEN&&f.appendTns(a.StatType.PLAYBACK_STARTED,"fsstart"),f},c}(),a.DataProvider=function(){function b(b,c){null==c&&(c=a.Slot.DEFAULT),this.data=b,this.log=this.data.log,this.type=this.data.type,this.slot=c}return b.prototype.get=function(){return this.data.load(this.type,this.slot)},b.prototype.cancel=function(){},b.prototype.preload=function(){},b}(),a.PreloadedDataProvider=function(){function b(b,c){null==c&&(c=a.Slot.DEFAULT),this.data=b,this.log=this.data.log,this.type=this.data.type,this.slot=c,this.ad=null,this.adNone=!1}return b.prototype.TAG="Preload",b.prototype.cancel=function(){return null!=this._preloadTimeout&&this.log.d(this.TAG,"cancel"),null!=this._preloadTimeout&&clearTimeout(this._preloadTimeout),this._preloadTimeout=null},b.prototype._preload=function(){if(this.cancel(),null==this.ad&&!this.adNone)return this.log.d(this.TAG,"preload"),this.data.load(this.type,this.slot).then(function(a){return function(b){return a.ad=b}}(this),function(a){return function(){return a.adNone=!0}}(this))},b.prototype.preload=function(a,b){var c;if(this.cancel(),null==this.ad&&!this.adNone)return c=Math.floor(Math.random()*(b-a)+a),this.log.d(this.TAG,"preload after: "+c),this._preloadTimeout=setTimeout(function(a){return function(){return a._preload()}}(this),1e3*c)},b.prototype.get=function(){var a,b;return this.log.d(this.TAG,"get"),this.cancel(),null!=this.ad?(b=[this.ad,null],a=b[0],this.ad=b[1],Promise.resolve(a)):this.adNone?(this.adNone=!1,Promise.reject(null)):this.data.load(this.type,this.slot)},b}(),a.Provider=function(){function b(b){this[a.Slot.DEFAULT]=new a.DataProvider(b,a.Slot.DEFAULT),this[a.Slot.PREROLL]=new a.DataProvider(b,a.Slot.PREROLL),this[a.Slot.MIDROLL]=new a.PreloadedDataProvider(b,a.Slot.MIDROLL)}return b}()}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=window.AdMan,a.Html5Audio=function(d){function e(c,d,e,f){this.voiceEnd=b(this.voiceEnd,this),this.onEvent=b(this.onEvent,this),this.onPlay=b(this.onPlay,this),this.audio=a.audio||document.createElement("audio"),this.audio.src=c,this.playing=!1,this.audio.id="unisound-audio-tag",this.audio.voice=f||null,d&&(this.audio.autoplay=!0),f?(this.audio.addEventListener("ended",this.voiceEnd),this.addListener(e)):(this.audio.addEventListener("pause",this.onEvent),this.audio.addEventListener("play",this.onPlay),this.audio.addEventListener("timeupdate",this.onEvent),this.audio.addEventListener("ended",this.onEvent),this.audio.addEventListener("error",this.onEvent),this.audio.addEventListener("canplay",this.onEvent),this.addListener(e)),document.body.appendChild(this.audio)}return c(e,d),e.prototype.onPlay=function(){return this.dispatch(this.playing?"play":"playing"),this.playing=!0},e.prototype.onEvent=function(a){return this.dispatch(a.type,a)},e.prototype.voiceEnd=function(a){return this.dispatch("voiceend",a)},e.prototype.play=function(){return this.audio.play()},e.prototype.pause=function(){return this.audio.pause()},e.prototype.setMuted=function(a){return this.audio.muted=a},e.prototype.setVolume=function(a){return this.audio.volume=a},e.prototype.getVolume=function(){return this.audio.volume},e.prototype.dispose=function(){if(null!=this.audio)return this.audio.removeEventListener("pause",this.onEvent),this.audio.removeEventListener("play",this.onPlay),this.audio.removeEventListener("ended",this.onEvent),this.audio.removeEventListener("timeupdate",this.onEvent),this.audio.removeEventListener("error",this.onEvent),this.audio.removeEventListener("canplay",this.onEvent),null!=this.audio.parentNode&&this.audio.parentNode.removeChild(this.audio),this.audio=null},e.prototype.setSrc=function(a){return this.playing=!1,this.audio.src=a},e.prototype.seek=function(a){return this.audio.currentTime=a},e.prototype.toString=function(){return"Html5Audio"},e.a=document.createElement("audio"),e.isSupported=function(){return!(!this.a.canPlayType||!this.a.canPlayType("audio/mpeg;"))},e}(a.Dispatcher),a.Html5Video=function(d){function e(c,d,e){this.onEvent=b(this.onEvent,this),this.onPlay=b(this.onPlay,this),this.video=a.video||document.createElement("video"),this.video.getElementsByTagName("source")[0]?(this.source.src=c,this.source.type="video/mp4"):(this.source=document.createElement("source"),this.source.src=c,this.source.type="video/mp4",this.video.appendChild(this.source)),this.video.id="unisound-audio-tag",this.video.style.maxWidth="100%",this.playing=!1,d&&(this.video.autoplay=!0),this.video.addEventListener("pause",this.onEvent),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("ended",this.onEvent),this.video.addEventListener("timeupdate",this.onEvent),this.video.addEventListener("error",this.onEvent),this.video.addEventListener("canplay",this.onEvent),this.addListener(e)}return c(e,d),e.prototype.onPlay=function(){return this.dispatch(this.playing?"play":"playing"),this.playing=!0},e.prototype.onEvent=function(a){return this.dispatch(a.type,a)},e.prototype.play=function(){return this.video.play()},e.prototype.pause=function(){return this.video.pause()},e.prototype.setMuted=function(a){return this.video.muted=a},e.prototype.setVolume=function(a){return this.video.volume=a},e.prototype.getVolume=function(){return this.video.volume},e.prototype.show_video=function(a){return a.append(this.video)},e.prototype.dispose=function(){if(null!=this.video)return this.video.removeEventListener("pause",this.onEvent),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("ended",this.onEvent),this.video.removeEventListener("timeupdate",this.onEvent),this.video.removeEventListener("error",this.onEvent),this.video.removeEventListener("canplay",this.onEvent),null!=this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.video=null},e.prototype.setSrc=function(a){return this.playing=!1,this.source.src=a},e.prototype.seek=function(a){return this.video.currentTime=a},e.prototype.toString=function(){return"Html5Video"},e.v=document.createElement("video"),e.isSupported=function(){return!(!this.v.canPlayType||!this.v.canPlayType("video/mp4;"))},e}(a.Dispatcher),a.SwfAudio=function(b){function d(b,c,d,e){var f;f=c||a.path+"xman.swf",this.audio=new a.Swf(f,e,{src:b,autoplay:d})}return c(d,b),d.prototype.play=function(){return this.audio.swf.playerPlay()},d.prototype.pause=function(){return this.audio.swf.playerPause()},d.prototype.setMuted=function(a){return this.audio.swf.setMuted(a)},d.prototype.setVolume=function(a){if(null!=this.audio.swf.setVolume)return this.audio.swf.setVolume(a)},d.prototype.getVolume=function(){return this.audio.swf.getVolume()},d.prototype.dispose=function(){return null!=this.audio&&this.audio.dispose(),this.audio=null},d.prototype.setSrc=function(a){return this.audio.swf.playerOpen(a)},d.prototype.seek=function(a){return this.audio.swf.seek(a)},d.prototype.toString=function(){return"SwfAudio"},d.isSupported=function(){return a.Flash&&a.Flash.version>=9},d}(a.Dispatcher),a.Engine=function(b){function d(b,c,d,e,f){switch(this.solution=b||["html5","flash"],this.admanSwf=c,this.log=f||a.log,a.$.type(d)){case"string":this.jingle_in=d,this.jingle_out=d;break;case"object":this.jingle_in=d["in"],this.jingle_out=d.out}this.addListener(e),this.playing=!1,this.item=null,this.audio=null,this.volume=.8,this.muted=!1,this.error=!1,this.voice=null}return c(d,b),d.prototype.start=function(b,c,d,e){var f;return this.muted=!1,this.error=!1,this.item=b.items.filter(function(a){return"audio"===a.type})[0],null==this.item?void setTimeout(function(a){return function(){return a.dispatch("adError","no AudioItem in section")}}(this),100):(this.volume=isNaN(d)?.7:Math.max(a.MIN_VOLUME,d),this.stat=c,this.src=null,null!=this.jingle_in?(this.log.i("Engine","play","jingle_in"),f=this.jingle_in,this.mode="jingle_in"):(this.log.i("Engine","play",this.item.src),f=this.item.src,this.mode="ad"),this.audio=this._play(f,this.item,e),null!=this.audio?(this.log.d("Engine","solution",this.audio),this.run_timeout(),this.audio.setVolume(this.volume),this.playing=!0,this.percent=0,this.current=0,this.total=0):setTimeout(function(a){return function(){return a.dispatch("adError","Playing engine not supported")}}(this),100))},d.prototype._play=function(a,b,c,d){var e,f,g,h,i;for(h=this.solution,f=0,g=h.length;f<g;f++)if(i=h[f],e=this._playWithSolution(a,i,b,c,d),null!=e)return e;return null},d.prototype._playWithSolution=function(b,c,d,e,f){var g,h;return g=null,h=!0,"flash"===c&&a.SwfAudio.isSupported()?g=new a.SwfAudio(b,this.admanSwf,h,this):"html5"===c&&(e?"video/mp4"===d.mime?a.Html5Video.isSupported()&&(g=new a.Html5Video(b,h,this)):a.Html5Audio.isSupported()&&(g=new a.Html5Audio(b,h,this)):a.Html5Audio.isSupported()&&(g=new a.Html5Audio(b,h,this,f))),g},d.prototype.run_timeout=function(){return this.cancel_timeout(),this.timeout=setTimeout(function(a){return function(){return a.log.e("Engine","timeout"),a.on_error("TimeoutPlayingError")}}(this),1e4)},d.prototype.cancel_timeout=function(){return null!=this.timeout&&clearTimeout(this.timeout),this.timeout=null},d.prototype.mobileStart=function(b,c,d,e){var f;return this.muted=!1,this.error=!1,this.item=b.items.filter(function(a){return"audio"===a.type})[0],null==this.item?void setTimeout(function(a){return function(){return a.dispatch("adError","no AudioItem in section")}}(this),100):(this.volume=isNaN(d)?.7:Math.max(a.MIN_VOLUME,d),this.stat=c,this.src=null,null!=this.jingle_in?(this.log.i("Engine","play","jingle_in"),f=this.jingle_in,this.mode="jingle_in"):(this.log.i("Engine","play",this.item.src),f=this.item.src,this.mode="ad"),this.audio=this._play(f,this.item,e),null!=this.audio?(this.log.d("Engine","solution",this.audio),this.audio.setVolume(this.volume),this.playing=!0,this.percent=0,this.current=0,this.total=0):setTimeout(function(a){return function(){return a.dispatch("adError","Playing engine not supported")}}(this),100))},d.prototype.startVoice=function(a){var b;if(this.log.i("Engine","play a voice response",a),this.audio=this._play(a,!1,!1,b=!0),null!=this.audio)return this.log.d("Engine","solution",this.audio),this.audio.setVolume(.5),this.playing=!0,this.audio.play()},d.prototype.play=function(){if(this.playing)return this.audio.play()},d.prototype.pause=function(){if(this.playing)return this.audio.pause()},d.prototype.restart=function(){if(this.stat.send(a.StatType.REWIND),this.playing)return this.audio.seek(0)},d.prototype.mute=function(){return this.stat.send(a.StatType.MUTE),this.playing&&this.audio.setMuted(!0),this.dispatch("adMuted")},d.prototype.unmute=function(){return this.stat.send(a.StatType.UNMUTE),this.playing&&this.audio.setMuted(!1),this.dispatch("adUnMuted")},d.prototype.getVolume=function(){return this.playing?this.audio.getVolume():NaN},d.prototype.setVolume=function(b){return this.volume=Math.max(this.muted?0:b,a.MIN_VOLUME),this.playing&&this.audio.setVolume(this.volume),this.dispatch("adVolumeChange",this.volume)},d.prototype.skip=function(){if(this.playing)return this.stat.send(a.StatType.SKIP),this.playing=!1,this.item=null,this.statistics=null,this.dispatch("adCompleted"),this.dispose()},d.prototype.dispose=function(){return null!=this.audio&&this.audio.dispose(),this.audio=null},d.prototype.setVoiceFlag=function(){return this.voice=!0},d.prototype.on_ready=function(){return this.audio.setVolume(this.volume)},d.prototype.on_canplay=function(){return this.stat.send(a.StatType.READY)},d.prototype.on_playing=function(){if(this.cancel_timeout(),"ad"===this.mode)return this.playing=!0,this.stat.send(a.StatType.START),this.stat.send(a.StatType.IMPRESSION),this.stat.send(a.StatType.CREATIVE_VIEW),this.dispatch("adStarted")},d.prototype.on_error=function(a){return this.cancel_timeout(),"ad"===this.mode?(this.error=!0,this.dispatch("adError",a)):"jingle_in"===this.mode?this.on_ended():void 0},d.prototype.on_play=function(){if("ad"===this.mode)return this.stat.send(a.StatType.RESUME),this.dispatch("adResumed")},d.prototype.on_pause=function(b){if("ad"===this.mode&&(null==b||!b.target.ended))return this.stat.send(a.StatType.PAUSE),this.dispatch("adPaused")},d.prototype.on_ended=function(){return"jingle_in"===this.mode?(this.log.i("Engine","play",this.item.src),this.mode="ad",this.audio.setSrc(this.item.src),this.run_timeout()):null!=this.jingle_out&&"ad"===this.mode?(this.log.i("Engine","play","jingle_out"),this.mode="jingle_out",this.audio.setSrc(this.jingle_out),this.run_timeout()):(this.on_timeupdate(this.total,this.total),this.playing=!1,this.item=null,this.statistics=null,this.dispose(),this.error||this.stat.send(a.StatType.COMPLETE),this.voice?this.dispatch("voiceRecording"):this.dispatch("adCompleted"))},d.prototype.on_voiceend=function(){return this.dispose(),this.playing=!1,this.dispatch("preCheck")},d.prototype.on_timeupdate=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if("ad"===this.mode){if(1===arguments.length?(c=b.target.currentTime,o=b.target.duration):2===arguments.length&&(c=arguments[0],o=arguments[1]),o>0){if(this.total=o,i=Math.ceil(100*c/o),i>this.percent){for(f=g=j=this.percent+1,k=i+1;g<k;f=g+=1)this.stat.send(a.StatType.PROGRESS,f+"%"),25===f&&this.stat.send(a.StatType.FIRST_QUARTILE),50===f&&this.stat.send(a.StatType.MIDPOINT),75===f&&this.stat.send(a.StatType.THIRD_QUARTILE);this.percent=i}if(n=Math.round(c),n>this.current){for(f=h=l=c+1,m=n+1;h<m;f=h+=1)e=a.Util.toHHMMSS(f),this.stat.send(a.StatType.PROGRESS,e),this.stat.send(a.StatType.PROGRESS,e+".000");this.current=n}}return d=this.audio.audio?Math.ceil(this.audio.audio.duration):this.audio.video?Math.ceil(this.audio.video.duration):this.item.duration,this.dispatch("adTimeLeft",d-c,d)}},d}(a.Dispatcher)}.call(this),function(){var a;a=window.AdMan,a.Banner=function(){function b(b,c,d){this.target=b,this.log=null!=d?d:a.log,this.element=a.$("<div></div>").css({display:"block","background-position":"center","background-size":"contain","background-repeat":"no-repeat"}),this.a=a.$("<a></a>").attr("target","_blank").append(this.element),a.$(b).append(this.a),null!=c&&a.$(b).addClass(c)}return b.prototype.setSection=function(a){var b;return this.section=a,b=/b(\d+)x(\d+)/.exec(this.target.className),null!=b?this.refresh(b[1],b[2]):this.refresh(this.target.offsetWidth,this.target.offsetHeight)},b.prototype.refresh=function(b,c){return this.width=b,this.height=c,this.isNotBannerSize=a.Banner.wrongBanner(this.section.items,b,c),this.item=a.Banner.selectAd(this.isNotBannerSize[0],this.isNotBannerSize[1],this.isNotBannerSize[2]),b=this.isNotBannerSize[1],c=this.isNotBannerSize[2],null!=this.item?(this.element.css({width:null!=b?b:b+{px:"100%"},height:null!=c?c:c+{px:"100%"},"max-width":"100%","max-height":"100%","background-image":'url("'+this.item.src+'")'}),this.a.attr("href",this.section.link)):a.$(this.target).hide()},b.prototype.destroy=function(){return this.target=null,this.item=null,null!=this.a&&this.a.remove(),this.a=null},b.diff=function(a,b){var c,d,e;return c=null!=a.width&&null!=a.height&&a.height>0?a.width/a.height:0,d=null!=b.width&&null!=b.height&&b.height>0?b.width/b.height:0,e=(null!=a.width&&null!=b.width?Math.abs(a.width-b.width):0)+(null!=a.height&&null!=b.height?Math.abs(a.height-b.height):0),[Math.abs(c-d),e]},b.wrongBanner=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(e=[],m=[400,640,90,250,60,128,300,160],n=[240,640,728,300,468,128,200,160],f=h=0,k=a.length;0<=k?h<k:h>k;f=0<=k?++h:--h)if("image"===a[f].type){if(a[f].width===parseInt(b)&&a[f].height===parseInt(c))return[a,parseInt(b),parseInt(c)];d=e.push(a[f])}for(f=i=0;i<7;f=++i)for(g=j=0,l=e.length;0<=l?j<l:j>l;g=0<=l?++j:--j)if(e[g].width===n[f]&&e[g].height===m[f])return[e,n[f],m[f]];return[a,b,c]},b.selectAd=function(a,b,c){var d,e,f,g,h,i,j;if(d=null,a=a?a.filter(function(a){return"image"===a.type}):[],a.length>0)for(j={width:b,height:c},d=a[0],e=this.diff(j,d),g=0,h=a.length;g<h;g++)f=a[g],i=this.diff(j,f),(i[0]<e[0]||i[0]===e[0]&&i[1]<e[1])&&(e=i,d=f);return d},b.createStat=function(b,c){return new a.Stat(b.stats,c)},b}()}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=window.AdMan,a.Overlay=function(c){function d(b,c,d){var e,f,g,h;this.params=b,this.id=b.id,this.targetSelector=b.target,this.addListener(c),this.log=null!=d?d:a.log,this.showOn=null!=(e=b.showOn)?e:["adStarted"],this.showIf=null!=(f=b.showIf)?f:[],this.closeOn=null!=(g=b.closeOn)?g:[],this.animate=b.animate,this.src=b.src,this.content=b.content,this.displayed=!1,this.banners=[],this.hidden=[],this.wrapped=[],this.mode=null!=(h=b.mode)?h:a.Overlay.Mode.APPEND,this.bannerClass=b.bannerClass,this.values=b.values,this.type=b.type,this.voice=b.voice,this.left=null,this.total=null,this.paused=!1,this.volume=.7,this.content?this.data=this.content:this.src&&("#"===this.src.charAt(0)?this.data=this.src:a.request(this.src).then(function(a){return function(b){if(a.data=b,a.showAfterLoad)return a.show()}}(this),function(a){return function(){return a.log.e("Overlay","Error(overlay content not loaded: '"+a.src+"')")}}(this)))}return b(d,c),d.prototype.fillValues=function(b){return null!=this.values&&a.$.each(this.values,function(a,c){return b=b.split("${"+a+"}").join(c)}),b},d.prototype.getContainer=function(){var b;return a.$(null!=(b="function"==typeof this.targetSelector?this.targetSelector():void 0)?b:this.targetSelector)},d.prototype._onVolumeDown=function(b){var c,d,e,f,g,h,i,j,k,l;return b.preventDefault(),l=b.currentTarget,h="vertical"===a.$(l).attr("data-orientation"),g="reversed"===a.$(l).attr("data-reversed"),j=h?"clientY":"clientX",k=h?"bottom":"left",i=h?"offsetHeight":"offsetWidth",f=h?-1:1,e=function(a){return function(b){var c,d,e;return c=(b-l.getBoundingClientRect()[k])*f,e=Math.min(Math.max(c,0),l[i]),d=e/l[i],g&&(d=1-d),a.dispatch("overlay_volume_click",d)}}(this),e(b[j]),c=function(a){return e(a[j])},d=function(b){return a.$(window).off("mousemove",c).off("mouseup",d)},a.$(window).mousemove(c).mouseup(d)},d.prototype.refresh=function(){var b,c,d,e,f,g,h,i,j,k;if(!this.initialized&&null!=this.section&&null!=this.target)return h=this.section.link,k=this.section.items.filter(function(a){return"text"===a.type})[0],j=null!=k?k.text:void 0,d=this.section.items.filter(function(a){return"audio"===a.type})[0],c=null!=(i=null!=d?d.allowSkip:void 0)&&i,a.$(this.target).find(".unisound-close, .instreamatic-close").click(function(b){return function(c){var d,e;if(d=a.$(c.currentTarget),!d.attr("disabled"))return e=d.attr("data-close"),null!=e?(b.hidden.push(a.$(b.target).find(e).hide()),b.hidden.push(d.hide()),b.dispatch("overlay_banner_close",b)):b.close()}}(this)),a.$(this.target).find(".unisound-skip, .instreamatic-skip").click(function(b){return function(c){var d;if(d=a.$(c.currentTarget),!d.attr("disabled"))return b.dispatch("overlay_skip_click",b)}}(this)),a.$(this.target).find(".unisound-play, .instreamatic-play").click(function(a){return function(){return a.dispatch("overlay_play_click")}}(this)),a.$(this.target).find(".unisound-pause, .instreamatic-pause").click(function(a){return function(){return a.dispatch("overlay_pause_click")}}(this)),a.$(this.target).find(".unisound-restart, .instreamatic-restart").click(function(a){return function(){return a.dispatch("overlay_restart_click")}}(this)),a.$(this.target).find(".unisound-mute, .instreamatic-mute").click(function(a){return function(){return a.dispatch("overlay_mute_click")}}(this)),a.$(this.target).find(".unisound-volume-min, .instreamatic-volume-min").click(function(a){return function(){return a.dispatch("overlay_volume_click",0)}}(this)),a.$(this.target).find(".unisound-volume-max, .instreamatic-volume-max").click(function(a){return function(){return a.dispatch("overlay_volume_click",1)}}(this)),a.$(this.target).find(".unisound-volume-step-up, .instreamatic-volume-step-up").click(function(a){return function(){return a.dispatch("overlay_volume_step_up")}}(this)),a.$(this.target).find(".unisound-volume-step-down, .instreamatic-volume-step-down").click(function(a){return function(){return a.dispatch("overlay_volume_step_down")}}(this)),a.$(this.target).find(".unisound-volume-back, .instreamatic-volume-back").mousedown(function(a){return function(b){return a._onVolumeDown(b)}}(this)),isMobile.any&&a.$(this.target).find(".unisound-volume-back, .instreamatic-volume-back").hide(),a.$(this.target).find(".unisound-text, .instreamatic-text").html(j)[null!=j?"show":"hide"](),a.$(this.target).find(".unisound-site, .instreamatic-site").append(a.$("<a></a>").text("   Unisound").attr({target:"_blank",href:"http://www.unisound.net"})),this.setLeft(this.left,this.total),this.setPaused(!1),this.setVolume(this.volume),this.banners=[],a.$(this.target).find(".unisound-banner, .instreamatic-banner").each(function(b){return function(c,d){var e;if(e=new a.Banner(d,b.bannerClass,b.log),e.setSection(b.section),e.item)return b.banners.push(e),e.a.click(function(){return b.dispatch("overlay_goto",b)}),b.dispatch("companion_stats",{width:e.item.width,height:e.item.height})}}(this)),a.$(this.target).find(".unisound-social-button, .instreamatic-social-button").hide(),h&&a.$(this.target).find(".unisound-link, .instreamatic-link").each(function(b){return function(c,d){return a.$(d).click(function(){return b.dispatch("overlay_goto",b)}).wrap(a.$("<a></a>",{href:h,target:"_blank"})),b.wrapped.push(d)}}(this)),this.voice||(a.$(this.target).find(".unisound-voice, .instreamatic-voice").hide(),a.$(this.target).find(".unisound-signature, .instreamatic-signature").hide()),f=a.Condition.banner().check(this.section),g=a.Condition.video().check(this.section),a.$(this.target).find(".unisound-video, .instreamatic-video")[null!=g?"show":"hide"](),a.$(this.target).find(".unisound-has-banner, .instreamatic-has-banner")[null!=f?"show":"hide"](),a.$(this.target).find(".unisound-not-banner, .instreamatic-not-banner")[null!=f?"hide":"show"](),null!=d.skipTime&&d.allowSkip&&(b=this,setTimeout(function(c){return function(){return b._applyAnimate(a.$(c.target).find(".unisound-skip, .instreamatic-skip"),!1)}}(this),1e3*d.skipTime)),g&&a.$(this.target).hasClass("unisound-video instreamatic-video")&&(e=a.$(this.target),this.dispatch("show_video",e)),this.initialized=!0},d.prototype._applyAnimate=function(b,c,d){var e;switch(d=null!=d?d:function(){if(c)return a.$(b).hide()},e=a.$(b),this.animate){case a.Overlay.Animate.OPACITY:return c||e.hide(),e.fadeTo(1e3,c?0:1,d);case a.Overlay.Animate.SLIDE:return c||e.hide(),e[c?"slideUp":"slideDown"]({duration:1e3,easing:"linear",complete:d});case a.Overlay.Animate.BLUR:return c||e.hide(),c?(e.css({opacity:1,"-webkit-transition":"1s ease","-webkit-filter":"blur(0px)","-moz-transition":"1s ease",transition:"1s ease",filter:"blur(0px)"}),setTimeout(function(){return e.css({opacity:0,"-webkit-transition":"1s ease","-moz-transition":"1s ease",transition:"1s ease","-webkit-filter":"blur(10px)",filter:"blur(10px)"})},10),setTimeout(function(){return d()},1e3)):(e.css({opacity:0,"-webkit-filter":"blur(10px)",filter:"blur(10px)",display:""}),setTimeout(function(){return e.css({opacity:1,"-webkit-transition":"1s ease","-moz-transition":"1s ease",transition:"1s ease","-webkit-filter":"blur(0px)",filter:"blur(0px)"})},10),setTimeout(function(){return e.css({opacity:"","-webkit-transition":"","-moz-transition":"",transition:"","-webkit-filter":"",filter:""})},1e3));default:return e[c?"hide":"show"](),d()}},d.prototype.show=function(b){var c,d;if(this.displayed&&(a.$(this.target).remove(),this.displayed=!1),d=!1,b||a.$.each(this.showIf,function(a){return function(b,c){if(!c.check(a.section))return d=!0}}(this)),!d){if(c=this.getContainer(),null!=this.data)switch(this.initialized=!1,this.target=a.$(this.fillValues(this.data)),this.mode){case a.Overlay.Mode.APPEND:a.$(c).append(this.target);break;case a.Overlay.Mode.PREPEND:a.$(c).prepend(this.target);break;case a.Overlay.Mode.BEFORE:a.$(c).before(this.target);break;case a.Overlay.Mode.AFTER:a.$(c).after(this.target);break;case a.Overlay.Mode.REPLACE:a.$(c).hide().after(this.target);break;case a.Overlay.Mode.OVERLAY:a.Overlay.initStyle(),a.$(c).addClass("unisound-replaced instreamatic-replaced").after(this.target)}else{if(null!=this.src)return void(this.showAfterLoad=!0);this.target=c}return this.refresh(),null!=a.$.fn.liMarquee2&&(a.$(this.target).find(".unisound-marquee, .instreamatic-marquee").hide(),setTimeout(function(b){return function(){return a.$(b.target).find(".unisound-marquee, .instreamatic-marquee").show().liMarquee2(),b.liMarquee=!0}}(this),100)),this._applyAnimate(this.target),a.$(this.target).find(".unisound-close, .instreamatic-close").each(function(b){return function(c,d){var e;if(e=a.$(d).attr("data-delay"),null!=e)return b._setDisableTime(d,e)}}(this)),a.$(this.target).find(".unisound-skip, .instreamatic-skip").hide(),this.displayed=!0,this.dispatch("overlay_show",this)}},d.prototype._setDisableTime=function(b,c){var d,e,f;return a.$(b).attr("disabled",!0).show(),e=a.$(b).attr("data-counter"),d=parseInt(c,10),null!=e&&(a.$(this.target).find(e).show(),a.$(this.target).find(e).text(a.Util.toMMSS(d)),f=setInterval(function(){return a.$(this.target).find(e).text(a.Util.toMMSS(--d))},1e3)),setTimeout(function(c){return function(){return null!=f&&(clearInterval(f),a.$(c.target).find(e).hide()),a.$(b).attr("disabled",!1)}}(this),1e3*c)},d.prototype.close=function(){if(this.displayed)return null!=this.data?(this._applyAnimate(this.target,!0,function(b){return function(){switch(a.$(b.target).remove(),b.mode){case a.Overlay.Mode.REPLACE:return b._applyAnimate(b.getContainer());case a.Overlay.Mode.APPEND:case a.Overlay.Mode.PREPEND:case a.Overlay.Mode.BEFORE:case a.Overlay.Mode.AFTER:return null;case a.Overlay.Mode.OVERLAY:return a.$(b.getContainer()).removeClass("unisound-replaced instreamatic-replaced")}}}(this)),this.displayed=!1,void this.dispatch("overlay_close",this)):(this._applyAnimate(this.target,!0),this.displayed=!1,this.dispatch("overlay_close",this))},d.prototype.setSection=function(a,b){return this.initialized=!1,this.section=a,this.stat=b,this.refresh()},d.prototype.setVolume=function(b){var c;if(this.volume=b,null!=this.target)return c=Math.round(100*b),a.$(this.target).find(".unisound-volume-thumb, .instreamatic-volume-thumb").css("left",c+"%"),a.$(this.target).find(".unisound-volume-fore, .instreamatic-volume-fore").each(function(b,d){var e,f;return e=a.$(d),f="vertical"===e.attr("data-orientation"),e.css(f?"height":"width",c+"%")}),a.$(this.target).find(".unisound-volume-value , .instreamatic-volume-value").text(c)},d.prototype.setPaused=function(b){var c;if(this.paused=b,null!=this.target&&(a.$(this.target).find(".unisound-play, .instreamatic-play")[b?"show":"hide"](),a.$(this.target).find(".unisound-pause, .instreamatic-pause")[b?"hide":"show"](),this.liMarquee&&(c=a.$(this.target).find(".unisound-marquee, .instreamatic-marquee"),c.length>0&&c.liMarquee2(b?"pause":"play"))),!b&&this.closeOn.indexOf("adResumed")>-1)return this.close()},d.prototype.setLeft=function(b,c){var d,e,f;if(Math.sign(b)!==-1&&(this.left=b,this.total=c,null!=this.target))return d=a.Util.toMMSS(b),f=a.Util.toMMSS(c),"radio"===this.type&&(d=~~b),e=(c-b)/c*100,a.$(this.target).find(".unisound-left, .instreamatic-left").text(d),a.$(this.target).find(".unisound-total, .instreamatic-total").text(f),a.$(this.target).find(".unisound-progress-thumb, .instreamatic-progress-thumb").css("left",e+"%"),a.$(this.target).find(".unisound-progress-bar, .instreamatic-progress-bar").css("width",e+"%")},d.prototype.setMuted=function(a){},d.prototype.on_adStarted=function(){return this.eventProcess("adStarted")},d.prototype.on_adCompleted=function(){return this.eventProcess("adCompleted")},d.prototype.on_overlayClose=function(a){return this.eventProcess("overlayClose:"+a.id)},d.prototype.on_adClicked=function(){return this.eventProcess("adClicked")},d.prototype.on_advoiceRecording=function(){return this.eventProcess("advoiceRecording")},d.prototype.on_adend_recording=function(){return this.eventProcess("adend_recording")},d.prototype.eventProcess=function(b){var c;if(this.showOn.indexOf(b)>-1&&this.show(),this.closeOn.indexOf(b)>-1&&this.close(),c=a.$(this.target).find("[data-hide='"+b+"']"),c.length>0)return c.hide(),this.hidden.push(c)},d.prototype.reset=function(){return this.initialized=!1,a.$(this.target).find(".unisound-site, .instreamatic-site").empty(),a.$.each(this.banners,function(a,b){return b.destroy()}),a.$.each(this.hidden,function(b,c){return a.$(c).show()}),a.$.each(this.wrapped,function(b,c){return a.$(c).unwrap()}),this.banners=[],this.hidden=[],this.wrapped=[]},d}(a.Dispatcher),a.Overlay.Animate={OPACITY:"opacity",SLIDE:"slide",BLUR:"blur"},a.Overlay.Mode={BEFORE:"before",PREPEND:"prepend",APPEND:"append",AFTER:"after",REPLACE:"replace",OVERLAY:"overlay"},a.Condition=function(){function b(a){this.params=a}return b.prototype.check=function(b){var c,d,e;switch(d=!1,this.params.type){case a.Condition.Type.SELECTOR:d=a.$(this.params.selector).length>0;break;case a.Condition.Type.VALUE:
d=!!this.params.value;break;case a.Condition.Type.BANNER:d=b.items.filter(function(a){return"image"===a.type}).length>0;break;case a.Condition.Type.VIDEO:c=b.items.filter(function(a){return"audio/mp3"===a.mime}).length>0,e=b.items.filter(function(a){return"video/mp4"===a.mime}).length>0,!c&&e&&(d=!0)}return this.params.contra?!d:d},b.selector=function(b,c){return new a.Condition({type:a.Condition.Type.SELECTOR,selector:b,contra:c})},b.value=function(b,c){return new a.Condition({type:a.Condition.Type.VALUE,value:b,contra:c})},b.banner=function(b){return new a.Condition({type:a.Condition.Type.BANNER,contra:b})},b.video=function(b){return new a.Condition({type:a.Condition.Type.VIDEO,contra:b})},b}(),a.Condition.Type={SELECTOR:"selector",VALUE:"value",BANNER:"banner",VIDEO:"video"},a.Overlay.initStyle=function(){var a;if(null==document.getElementById("instreamatic-style"))return a=document.createElement("style"),a.id="instreamatic-style",a.type="text/css",a.innerHTML=".unisound-replaced, .instreamatic-replaced { position: absolute !important; z-index: -1 !important; }",document.getElementsByTagName("head")[0].appendChild(a)}}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=window.AdMan,a.Dtmf={},a.Dtmf.Http=function(c){function d(b,c,d){this.key=b,this.log=null!=d?d:a.log,this.addListener(c),this.run=!1,this._connection=null}return b(d,c),d.prototype.TAG="Dtmf",d.prototype._request=function(){return this._connection=a.$.get("//"+a.domain.dtmf+":8080/dtmf/sub/"+this.key).done(function(a){return function(b){if(a.run&&null!=b&&"IN"===b.label)return a.log.d(a.TAG,"found"),a.dispatch("dtmf")}}(this)).always(function(a){return function(){if(a.run)return a._timeout=setTimeout(function(){return a._request()},1e3)}}(this))},d.prototype.on=function(){if(this.log.d(this.TAG,"on"),!this.run)return this.run=!0,this._request()},d.prototype.off=function(){var a;return this.log.d(this.TAG,"off"),this.run=!1,null!=(a=this._connection)&&a.abort(),this._connection=null,null!=this._timeout&&clearTimeout(this._timeout),this._timeout=null},d}(a.Dispatcher),a.Dtmf.Socket=function(c){function d(b,c,d){this.key=b,this.log=null!=d?d:a.log,this.addListener(c),this.run=!1,this.timeout=1e3,this._timeout=null,this.socket=null,this.proto="https:"===window.location.protocol?"wss":"ws",this.port="https:"===window.location.protocol?8081:8080}return b(d,c),d.prototype.TAG="Dtmf",d.prototype._connect=function(){return this.socket=new WebSocket(this.proto+"://"+a.domain.dtmf+":"+this.port+"/dtmfws/sub/"+this.key),this.socket.onopen=function(a){return function(){return a.timeout=1e3,a.log.d(a.TAG,"socket connected")}}(this),this.socket.onclose=function(a){return function(b){return a.log.d("dtmf socket closed"),a.run&&(a._timeout=setTimeout(function(){return a._connect()},a.timeout)),a.timeout=2*a.timeout}}(this),this.socket.onmessage=function(a){return function(b){var c;if(a.log.d(a.TAG,"message received "+b.data),a.run&&(c=JSON.parse(b.data),"IN"===(null!=c?c.label:void 0)))return a.log.d(a.TAG,"found"),a.dispatch("dtmf_in",c.ts)}}(this),this.socket.onerror=function(a){return function(b){return a.log.d(a.TAG,"socket failed: "+b.message)}}(this)},d.prototype._get_ts=function(){return a.$.get("//"+a.domain.dtmf+":"+this.port+"/dtmf/ts").done(function(a){return function(b){return a.log.d(a.TAG,"ts: "+b.ts),a.dispatch("dtmf_ts",b.ts)}}(this)).fail(function(a){return function(){return a.log.d(a.TAG,"ts failed"),a.dispatch("dtmf_ts",null)}}(this))},d.prototype.on=function(){if(this.log.d(this.TAG,"on"),!this.run)return this.run=!0,this._connect(),this._get_ts()},d.prototype.off=function(){var a;return this.log.d(this.TAG,"off"),this.run=!1,null!=(a=this.socket)&&a.close(),this.socket=null,null!=this._timeout&&clearTimeout(this._timeout),this._timeout=null},d}(a.Dispatcher)}.call(this),function(){var a,b,c,d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;a=window.AdMan,e=a.VoiceOption.languageOptions,g=a.VoiceOption.sourceOptions,d=a.VoiceOption.SDK,f=a.VoiceOption.recognizer,c=function(){return a.log.i("Complete voice listener")},b=function(a){return require(["Speech.Browser.Sdk"],function(b){return a(b)})},a.Voice=function(g){function i(c,e){this.addListener(e),this.phrase=null,this.action=null,this.status=null,this.language=null,this.microphoneState={},this.timeout=[],this.params={},e.voiceTitle?this.title=e.voiceTitle:this.title=a.VoiceOption.defaultTitle,this.log=c||a.Log,b(function(a){return d=a})}return h(i,g),i.prototype.UpdateStatus=function(a){switch(this.status=a,a){case"end_recording":this.hideMicro(),this.alarms(this.params.soundOff),this.dispatch("end_recording");break;case"Listening":this.showMicro()}return this.log.i(a)},i.prototype.UpdateRecognizedHypothesis=function(a){return this.phrase=a},i.prototype.OnSpeechEndDetected=function(){},i.prototype.UpdateRecognizedPhrase=function(a){return this.action=a},i.prototype.RecognizerSetup=function(a,b){var c,d;return a.Storage.Local.Set("Host",this.params.responseUrl),a.Storage.Local.Set("InteractiveRelativeUri",""),d=new a.RecognizerConfig(new a.SpeechConfig(new a.Context(new a.OS(navigator.userAgent,"Browser",null),new a.Device("SpeechSample","SpeechSample","1.0.00000")))),c=new a.CognitiveSubscriptionKeyAuthentication(b),a.CreateRecognizer(d,c)},i.prototype.RecognizerStart=function(a,b){return b.Recognize(function(a){return function(b){switch(b.Name){case"RecognitionTriggeredEvent":return a.UpdateStatus("Initializing");case"ListeningStartedEvent":return a.UpdateStatus("Listening");case"RecognitionStartedEvent":return a.UpdateStatus("Listening_Recognizing");case"SpeechStartDetectedEvent":return a.UpdateStatus("Listening_DetectedSpeech_Recognizing");case"SpeechHypothesisEvent":return a.UpdateRecognizedHypothesis(b.Result.Text);case"SpeechEndDetectedEvent":return a.OnSpeechEndDetected(),a.UpdateStatus("Processing_Adding_Final_Touches");case"SpeechSimplePhraseEvent":return a.UpdateRecognizedPhrase(JSON.stringify(b.Result,null,3));case"SpeechDetailedPhraseEvent":return a.UpdateRecognizedPhrase(JSON.stringify(b.Result,null,3));case"RecognitionEndedEvent":return c(),a.UpdateStatus("Idle")}}}(this)).On(function(a){return function(a){}}(this),function(a){return function(a){}}(this))},i.prototype.RecognizerStop=function(a,b){return b.AudioSource.TurnOff()},i.prototype.endTimeout=function(){return $(".unisound-banner, .instreamatic-banner").find(".unisound-wait, .instreamatic-wait").remove(),this.timeout.forEach(function(a){return function(a){return clearTimeout(a)}}(this)),this.timeout=[]},i.prototype.runTimeout=function(){var a;return a=this,a.timeout.push(setTimeout(function(b){return function(){return $(".unisound-banner, .instreamatic-banner").prepend('<div class="unisound-wait instreamatic-wait">'+a.title+"</div>"),a.hideMicro(),a.timeout.push(setTimeout(function(){return a.action="error",a.Stop(),a.UpdateStatus("end_recording"),$(".unisound-banner, .instreamatic-banner").find(".unisound-wait, .instreamatic-wait").remove()},5e3))}}(this),4e3))},i.prototype.Start=function(){var a;return a=this,this.alarms(this.params.soundOn),setTimeout(function(b){return function(){return a.Setup(),a.RecognizerStart(d,f),a.runTimeout()}}(this),500)},i.prototype.Stop=function(){return this.RecognizerStop(d,f)},i.prototype.setParams=function(a){return this.params.site_id=a.site_id,this.params.ad_id=a.ad_id[0].value,this.params.responseUrl=a.responseUrl[0].value,this.params.device_info=a.device_info,this.params.soundOn=a.soundOn[0].value,this.params.soundOff=a.soundOff[0].value},i.prototype.Setup=function(){var a;return this.language&&(e=this.language),a=this,f=this.RecognizerSetup(d," "),f.SendSpeechConfig=function(b,c,e){return e&&this.connectionId!==this.speechConfigConnectionId?(this.speechConfigConnectionId=this.connectionId,c.Send(new d.ConnectionMessage(d.MessageType.Text,JSON.stringify({device:"web",vad:!0,site_id:a.params.site_id,ad_id:a.params.ad_id,device_info:a.params.device_info}),{path:"request","content-type":"application/json"},b))):PromiseHelper.FromResult(!0)},f.ReceiveMessage=function(b,c){return b.Read().OnSuccessContinueWithPromise(function(e){return function(e){var g,h;switch(h=e.Headers.path,g=JSON.parse(e.TextBody),h){case"voice.transcript":a.UpdateRecognizedHypothesis(g.transcript);break;case"voice.result":return"error"!==a.action&&(a.UpdateRecognizedHypothesis(g.transcript),a.UpdateRecognizedPhrase(g.action),a.UpdateStatus("end_recording")),d.PromiseHelper.FromResult(!0);case"error":return"error"!==a.action&&(a.UpdateRecognizedHypothesis("error"),a.UpdateRecognizedPhrase("error"),a.UpdateStatus("end_recording")),d.PromiseHelper.FromResult(!0)}return f.ReceiveMessage(b,c)}}(this))}},i.prototype.showMicro=function(){return $(document).find(".unisound-banner, .instreamatic-banner").prepend('<div class="unisound-voice instreamatic-voice"></div>')},i.prototype.hideMicro=function(){return $(document).find(".unisound-voice, .instreamatic-voice").remove()},i.prototype.disabledMicro=function(){if(this.microphoneState)return this.microphoneState.getTracks().forEach(function(a){return function(a){return a.stop()}}(this))},i.prototype.alarms=function(a){var b;return b=new Audio,b.src=a,b.volume=.5,b.addEventListener("ended",function(a){return function(){return b=null}}(this)),b.play()},i}(a.Dispatcher)}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=window.AdMan,a.PlayerType={},a.Wrappers={},a.managersById={},a.managers=[],a.Manager=function(c){function d(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;switch(null!=b.protocol?b.protocol=b.protocol.split(":")[0]+"://":b.protocol="//",null!=b.voice&&(b.protocol="https://"),null!=b.country&&a.setDomain(b.country),this.playerId=null!=(c=b.playerId)?c:"adman"+a.Manager.i++,this.log=new a.Log(a.managers.length.toString(),b.log),this.log.i("Manager","Manager("+(b.playerType||"_")+":"+this.playerId+")"),a.managersById[this.playerId]=this,a.managers.push(this),a.manager=this,null!=b.jq&&(a.$=b.jq),this.params=b,void 0===this.params.pauseOnClick&&(this.params.pauseOnClick=!1),this.events=b.events,a.requestTimeout=null!=(d=b.requestTimeout)?d:a.requestTimeout,this.tween=b.tween!==!1,this.isMidroll=!1,this.mobile=b.mobile,this.voiceEnabled=this.params.voice,this.voiceEnabled===!0?a.SetupVoiceScript(function(b){return function(){return b.voice=new a.Voice(b.log,b)}}(this)):"object"==typeof this.voiceEnabled&&(this.voiceEnabled.mobile===!0&&isMobile.android.phone&&isMobile.other.chrome||this.voiceEnabled.desktop===!0&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(this.voiceEnabled=!0,a.SetupVoiceScript(function(b){return function(){return b.voice=new a.Voice(b.log,b)}}(this))):this.voiceEnabled=!1),this.midrollDelay=null!=(f=b.midrollDelay)?f:0,this.midrollDelay<50&&(this.midrollDelay*=1e3),this.fadeTime=null!=(g=b.fadeTime)?g:a.FADE_TIME,this.fadeIn=null!=(h=b.fadeIn)?h:b.fadeTime,this.fadeOut=null!=(i=b.fadeOut)?i:b.fadeTime,this.admanPeriod=null!=(j=b.admanPeriod)?j:0,this.player=new a.Wrappers[null!=(k=b.playerType)?k:a.PlayerType.NULL](this.playerId,this),this.data=new a.Data(b.admanId,this.log,b.protocol,{type:this.voiceEnabled===!0?a.Type.VOICE:a.Type.AUDIO}),this.stat=a.Stat.buildSite({admanId:this.data.admanId,log:this.log,protocol:b.protocol,type:this.voiceEnabled===!0?a.Type.VOICE:a.Type.AUDIO}),this.data.stat=this.stat,this.provider=new a.Provider(this.data),this.overlay=[],a.$.type(b.overlay)){case"array":a.$.each(b.overlay,function(b){return function(c,d){return b.overlay.push(new a.Overlay(d,b,b.log))}}(this));break;case"object":this.overlay.push(new a.Overlay(b.overlay,this,this.log));break;case"string":this.overlay.push(new a.Overlay(a.Manager.overlayOverlay(b.overlay,this.playerId),this,this.log))}if(null!=b.banner&&this.overlay.push(new a.Overlay(a.Manager.bannerOverlay(b.banner),this,this.log)),this.engine=new a.Engine(b.solution,b.admanSwf,b.jingle,this,this.log),this.prerollUsed=!!this.params.disablePreroll,this.onEnded=!!this.params.onEnded,this.playerDisabled=!1,this.disableMode=null!=(l=this.params.disableMode)?l:a.PlayerDisableMode.ALL,this.params.onEnded&&(this.prerollUsed=!0),this.postrollUsed=!1,this.video=!!this.params.video,this.voiceTitle=null!=(m=b.voiceTitle)&&m,a.$(window).on("beforeunload",function(a){return function(){a.engine.playing&&a.player.setMuted(!1)}}(this)),null!=b.popup&&null!=this.data.admanId.siteId&&(this.popup=new a.PopupManager({admanId:b.admanId})),this.dtmf=b.dtmf,this.stat.send(a.StatType.LOAD),this.player.isPlaying()&&this.on_playerplay(),this.data.mark(),a.Dj.start(this.data.admanId.siteId),!this.prerollUsed&&isMobile.any&&this.mobile){if(n=a.Slot.PREROLL,p=Date.now()/1e3,o=null!=(e=window.localStorage.getItem("AdTimeStart"))?e:0,this.admanPeriod>0&&p>0&&p-o<this.admanPeriod)return this.log.d("Manager","Period",Math.round(p-o)+"/"+this.admanPeriod),void this.on_adNone();this.provider[n].get().then(function(b){return function(c){var d;return b.section=c.section,b.section_stat=c.stat,b.dispatch("Ready",b.section),b.tweenVolume=b.player.getVolume(),null!=b.tween&&b.isMidroll&&null!=b.fadeOut?a.tween(b.player,"setVolume",b.tweenVolume,0,b.fadeOut,function(){var a;return b.disablePlayer(),b.engine.mobileStart(b.section,b.section_stat,null!=(a=b.params.volume)?a:b.tweenVolume,b.video)}):(b.disablePlayer(),b.engine.mobileStart(b.section,b.section_stat,null!=(d=b.params.volume)?d:b.tweenVolume,b.video),a.$.each(b.overlay,function(a,c){return c.reset(),c.setSection(b.section,b.section_stat)}),a.$(b.mobile).one("touchstart click",a.initMobile))}}(this),function(a){return function(b){return a.on_adNone()}}(this)),this.stat.send(a.StatType.CAN_SHOW),this.stat.sendValues(a.StatType.CAN_SHOW,{siteId:this.data.admanId.siteId,playerId:this.data.admanId.playerId,slotId:this.data.type,formatId:n})}null!=b.mobileInit&&a.$(b.mobileInit).one("touchstart",function(){return a.initMobileAudio()})}return b(d,c),d.i=0,d.dispose=function(){var b,c,d,e;for(e=a.managers,b=0,c=e.length;b<c;b++)d=e[b],d.dispose();return a.managers=[],a.managersById={}},d.skip=function(){var b,c,d,e,f;for(e=a.managers,f=[],b=0,c=e.length;b<c;b++)d=e[b],f.push(d.skip());return f},d.prototype.setUserId=function(a){return this.data.setUserId(a)},d.prototype.dispatch=function(a){var b;if(null!=this.events&&null!=this.events["ad"+a])return b=[].slice.call(arguments,1),this.events["ad"+a].apply(this,b)},d.prototype.rebuildData=function(b){switch(this.data=new a.Data(this.params.admanId,this.log,this.params.protocol,{type:b.type}),this.stat=a.Stat.buildSite({type:b.type,admanId:this.data.admanId,log:this.log,protocol:this.params.protocol}),this.data.stat=this.stat,this.provider=new a.Provider(this.data),this.overlay=[],a.$.type(this.params.overlay)){case"array":return a.$.each(this.params.overlay,function(c){return function(d,e){return e.voice&&!b.micro&&(e.voice=!1),c.overlay.push(new a.Overlay(e,c,c.log))}}(this));case"object":return overlay.voice&&!b.micro&&(overlay.voice=!1),this.overlay.push(new a.Overlay(params.overlay,this,this.log));case"string":return overlay.voice&&!b.micro&&(overlay.voice=!1),this.overlay.push(new a.Overlay(a.Manager.overlayOverlay(params.overlay,this.playerId),this,this.log))}},d.prototype.start=function(b){var c,d,e,f;if(null==b&&(b=a.Slot.DEFAULT),!this.data.busy&&!this.engine.playing)return f=Date.now()/1e3,e=null!=(d=window.localStorage.getItem("AdTimeStart"))?d:0,this.admanPeriod>0&&f>0&&f-e<this.admanPeriod?(this.log.d("Manager","Period",Math.round(f-e)+"/"+this.admanPeriod),void this.on_adNone()):(c=this,this.voiceEnabled===!0?a.activatedMicro().then(function(d){return function(d){return c.voice.microphoneState=d,c.rebuildData({type:a.Type.VOICE}),c.request(b),c.sendStat(b,!0)}}(this))["catch"](function(d){return function(d){return c.rebuildData({type:a.Type.AUDIO}),c.request(b),c.sendStat(b)}}(this)):(this.request(b),this.sendStat(b)))},d.prototype.request=function(a){return this.provider[a].get().then(function(a){return function(b){if(a.section=b.section,a.section_stat=b.stat,a.dispatch("Ready",a.section),a.play(),a.isVoiceAd(a.section))return a.engine.setVoiceFlag()}}(this),function(a){return function(b){return a.on_adNone()}}(this))},d.prototype.sendStat=function(b,c){return this.stat.send(a.StatType.CAN_SHOW),this.stat.sendValues(a.StatType.CAN_SHOW,{siteId:this.data.admanId.siteId,playerId:this.data.admanId.playerId,slotId:this.data.type,formatId:b,microphone:c})},d.prototype.play=function(){var b;if(null==this.section)throw Error("Ad data is not resolved.");return this.log.i("Manager","play"),this.tweenVolume=this.player.getVolume(),null!=this.tween&&this.isMidroll&&null!=this.fadeOut?a.tween(this.player,"setVolume",this.tweenVolume,0,this.fadeOut,function(a){return function(){var b;return a.disablePlayer(),a.engine.start(a.section,a.section_stat,null!=(b=a.params.volume)?b:a.tweenVolume,a.video)}}(this)):(this.disablePlayer(),this.engine.start(this.section,this.section_stat,null!=(b=this.params.volume)?b:this.tweenVolume,this.video)),a.$.each(this.overlay,function(a){return function(b,c){return c.reset(),c.setSection(a.section,a.section_stat)}}(this))},d.prototype.reproduce=function(b){var c;if(c=this,null==b)throw this.on_adCompleted(),Error("Ad data is not resolved.");return this.section=b.section,this.section_stat=b.stat,this.dispatch("Ready",this.section),this.play(),this.isVoiceAd(this.section)&&(this.engine.setVoiceFlag(),a.activatedMicro().then(function(a){return function(a){return c.voice.microphoneState=a}}(this))["catch"](function(a){return function(a){return c.voice.microphoneState=a}}(this))),this.sendStat(a.Slot.MIDROLL)},d.prototype.disablePlayer=function(){if(this.playerDisabled=!0,this.disableMode&a.PlayerDisableMode.PAUSE&&this.player.pause(),this.disableMode&a.PlayerDisableMode.MUTE)return this.player.setMuted(!0)},d.prototype.enablePlayer=function(){if(this.playerDisabled=!1,this.disableMode&a.PlayerDisableMode.MUTE&&this.player.setMuted(!1),this.disableMode&a.PlayerDisableMode.PAUSE)return this.player.play()},d.prototype.skip=function(){return this.engine.skip()},d.prototype.dispose=function(){return this.dtmfOff(),"function"==typeof this.player&&this.player(this.dispose()),this.engine.dispose(),a.$.each(this.overlay,function(a){return function(a,b){return b.close()}}(this))},d.prototype.dtmfOn=function(b){if(null!=b&&(this.dtmf=b),null!=this.dtmf&&null==this.dtmfSocket)return this.dtmfSocket=new a.Dtmf.Socket(this.dtmf,this,this.log),this.ad_position=null,this.dtmfSocket.on(),this.provider[a.Slot.MIDROLL].preload(1,60)},d.prototype.dtmfOff=function(){var b;return null!=(b=this.dtmfSocket)&&b.off(),this.dtmfSocket=null,this.provider[a.Slot.MIDROLL].cancel()},d.prototype.isVoiceAd=function(a){return a.extensions.filter(function(a){return"response"===a.attributes.type}).length},d.prototype.voiceAdStart=function(){var b,c,d,e;if(d=null,e=[],b=this,"skip"===this.voice.action)c="negative";else if("positive"===this.voice.action||"negative"===this.voice.action||"unknown"===this.voice.action||"silence"===this.voice.action||"swearing"===this.voice.action||"egg"===this.voice.action)c=this.voice.action;else{if("error"===this.voice.action)return c=this.voice.action,this.section_stat.send(a.StatType[c.toUpperCase()]),this.on_adCompleted(),!1;c="unknown"}return d=this.voice.section.filter(function(a){return a.type===c})[0],this.voice.section.forEach(function(a){if(a.type!==c||a.attributes.priority!==d.attributes.priority)return e.push(a)}),this.voice.section=e,this.section_stat.send("response_"+d.attributes.action),setTimeout(function(a){return function(){var a,c;if(c=d.value.filter(function(a){return"audio"===a.type})[0],a=d.value.filter(function(a){return"link"===a.type})[0],b.engine.startVoice(c.data),a)return b.openLink(a.data)}}(this),500)},d.prototype.setVoiceLanguage=function(a){return a.extensions.filter(function(a){return"ResponseLanguage"===a.attributes.type})[0].children},d.prototype.openLink=function(a){return window.open(a,"_blank")},d.prototype.on_preCheck=function(){var a;return a=this,this.voice.section.filter(function(b){return b.type===a.voice.action}).length?(this.dispatch("voiceRecording"),this.voice.Start()):this.on_adCompleted()},d.prototype.on_voiceRecording=function(){var b;if(this.voiceEnabled===!0&&this.section)return this.dispatch("voiceRecording"),this.voice.setParams({ad_id:this.section.extensions.filter(function(a){return"AdId"===a.attributes.type})[0].children,site_id:this.data.admanId.siteId,device_info:"Adman SDK "+a.version+"; WEB",responseUrl:this.section.extensions.filter(function(a){return"ResponseUrl"===a.attributes.type})[0].children,soundOn:this.section.extensions.filter(function(a){return"ResponseMicOnSound"===a.attributes.type})[0].children,soundOff:this.section.extensions.filter(function(a){return"ResponseMicOffSound"===a.attributes.type})[0].children}),this.voice.section=this.section.extensions.filter(function(a){return"response"===a.attributes.type})[0].children,b=this.setVoiceLanguage(this.section),this.voice.language=b[0].value,this.voice.Start(),a.$.each(this.overlay,function(a){return function(a,b){return b.on_advoiceRecording()}}(this))},d.prototype.on_adStarted=function(){return this.log.i("Ad","started"),window.localStorage.setItem("AdTimeStart",Date.now()/1e3),this.dispatch("Started"),a.$.each(this.overlay,function(a){return function(b,c){return c.setVolume(a.engine.getVolume()),c.on_adStarted()}}(this))},d.prototype.on_adNone=function(){if(this.log.i("Ad","none"),this.prerollUsed=!0,this.postrollUsed=!0,this.playerDisabled&&this.enablePlayer(),this.dispatch("None"),null!=this.dtmf&&this.provider[a.Slot.MIDROLL].preload(1,600),this.voice&&this.voice.microphoneState.active)return this.voice.disabledMicro()},d.prototype.on_adPaused=function(){return this.log.i("Ad","paused"),a.$.each(this.overlay,function(a,b){return b.setPaused(!0)}),this.dispatch("Paused")},d.prototype.on_adResumed=function(){return this.log.i("Ad","resumed"),a.$.each(this.overlay,function(a,b){return b.setPaused(!1)}),this.dispatch("Resumed")},d.prototype.on_adTimeLeft=function(b,c){return a.$.each(this.overlay,function(a,d){return d.setLeft(b,c)}),this.dispatch("TimeLeft",b,c)},d.prototype.on_adCompleted=function(){if(this.log.i("Ad","completed"),a.$.each(this.overlay,function(a,b){return b.setLeft(null),b.on_adCompleted()}),!this.prerollUsed&&isMobile.any&&this.mobile&&a.$(this.mobile).off("touchstart click",a.initMobile),this.prerollUsed=!0,this.postrollUsed=!0,a.$.isFunction(this.player.setVolume)&&(this.params.playerMuted?this.player.setVolume(0):this.tween&&this.isMidroll&&this.fadeIn?(this.player.setVolume(0),a.tween(this.player,"setVolume",0,this.tweenVolume,this.fadeIn)):(this.tweenVolume<1e-6&&(this.tweenVolume=.7),this.player.setVolume(this.tweenVolume))),this.playerDisabled&&this.enablePlayer(),this.engine.playing=!1,this.dispatch("Completed"),null!=this.dtmf&&this.provider[a.Slot.MIDROLL].preload(1,600),this.section=null,this.voice&&this.voice.microphoneState.active)return this.voice.disabledMicro()},d.prototype.on_adError=function(b){var c;return c=this.section,this.section=null,this.log.i("Ad","error",b),this.stat.send(a.StatType.ERROR),this.on_adCompleted(),this.dispose(),null!=a?a.Error(b,this.data.admanId,c):void 0},d.prototype.on_adMuted=function(){return a.$.each(this.overlay,function(a,b){return b.setMuted(!0)})},d.prototype.on_adUnMuted=function(){return a.$.each(this.overlay,function(a,b){return b.setMuted(!1)})},d.prototype.on_adVolumeChange=function(b){return a.$.each(this.overlay,function(a,c){return c.setVolume(b)})},d.prototype.on_playerready=function(){return this.log.i("Player","ready")},d.prototype.on_playerend=function(){if(this.log.i("Player","ended"),this.onEnded&&!this.postrollUsed)return this.start()},d.prototype.on_playerpause=function(){return this.log.i("Player","pause"),this.dtmfOff()},d.prototype.on_playerplay=function(){return this.log.i("Player","play"),this.playerDisabled?this.disablePlayer():this.playing||this.prerollUsed||this.start(a.Slot.PREROLL),this.dtmfOn(this.dtmf)},d.prototype.on_playerstop=function(){return this.log.i("Player","stop"),this.dtmfOff()},d.prototype.on_playerchange=function(){if(this.log.i("Player","change"),!this.playing)return this.prerollUsed=!1},d.prototype.on_playerprogress=function(b){if(null!=this.ad_position&&b>=this.ad_position&&b<=this.ad_position+5)return this.ad_position=null,this.isMidroll=!0,this.start(a.Slot.MIDROLL)},d.prototype.on_overlay_play_click=function(){return this.engine.play()},d.prototype.on_overlay_pause_click=function(){return this.engine.pause()},d.prototype.on_overlay_mute_click=function(){return this.engine.setVolume(0)},d.prototype.on_overlay_unmute_click=function(){return this.engine.unmute()},d.prototype.on_overlay_volume_click=function(a){return this.engine.setVolume(a)},d.prototype.on_end_recording=function(){return this.voice.endTimeout(),this.voiceAdStart(),this.dispatch("end_recording"),a.$.each(this.overlay,function(a){return function(a,b){return b.on_adend_recording()}}(this))},d.prototype.on_overlay_volume_step_up=function(){if(this.engine.volume<.9)return this.engine.setVolume(this.engine.volume+.1)},d.prototype.on_overlay_volume_step_down=function(){if(this.engine.volume>a.MIN_VOLUME+.1)return this.engine.setVolume(this.engine.volume-.1)},d.prototype.on_overlay_restart_click=function(){return this.engine.restart()},d.prototype.on_overlay_skip_click=function(){return this.engine.skip()},d.prototype.on_overlay_show=function(a){return this.dispatch("OverlayShowed",a)},d.prototype.on_overlay_close=function(b){if(a.$.each(this.overlay,function(a,c){return c.on_overlayClose(b)}),this.dispatch("OverlayClosed",b),this.engine.audio)return this.engine.play()},d.prototype.on_overlay_banner_close=function(a){return this.dispatch("OverlayBannerClosed",a)},d.prototype.on_show_video=function(a){if(this.video&&a)return this.engine.audio.show_video(a)},d.prototype.on_overlay_goto=function(){var b,c;return!this.isVoiceAd(this.section)&&(this.section_stat.send(a.StatType.CLICK),this.dispatch("Clicked"),this.params.muteOnClick?(c=this.engine.getVolume(),a.$.isNumeric(this.params.muteOnClick)?this.engine.setVolume(this.params.muteOnClick):(this.engine.muted=!0,this.engine.setVolume(0)),b=function(a){return function(){return $(window).one("focus",function(){return a.engine.setVolume(c)})}}(this),setTimeout(b,1)):this.params.pauseOnClick&&this.engine.pause(),a.$.each(this.overlay,function(a,b){return b.on_adClicked()}))},d.prototype.on_dtmf_ts=function(a){return this.dtmfSocket.ts=a,this.dtmfSocket.position=this.player.getPosition()},d.prototype.on_dtmf_in=function(b){if(this.ad_position=this.dtmfSocket.position+(b-this.dtmfSocket.ts)+this.midrollDelay/1e3,this.log.d("Dtmf",this.ad_position),isNaN(this.ad_position))return this.ad_position=null,null!=this.midrollDelay?setTimeout(function(b){return function(){return b.isMidroll=!0,b.start(a.Slot.MIDROLL)}}(this),this.midrollDelay):(this.isMidroll=!0,this.start(a.Slot.MIDROLL))},d.prototype.on_companion_stats=function(b){var c;if(c=this.section.items.filter(function(a){return a.width===b.width&&a.height===b.height})[0],!a.$.isEmptyObject(c.trackingEvent))return c.trackingEvent.creativeView.forEach(function(a){return function(b){return a.log.i("Stat","creativeView",b),a.stat.get(a.stat.randomize(b))}}(this))},d.bannerOverlay=function(b){var c,d,e;return c="b"+b.width+"x"+b.height,e="width: "+b.width+"px; height: "+b.height+"px;",{target:null!=(d=b.target)?d:"#"+b.id,mode:a.Overlay.Mode.APPEND,content:"<div><div style='"+e+"' class='unisound-banner instreamatic-banner "+c+"'></div></div>",animate:a.Overlay.Animate.SLIDE,showOn:["adStarted"],closeOn:[]}},d.overlayOverlay=function(b,c){var d;return b.indexOf("/")>-1||b.indexOf("?")>-1||/.html$/.test(b)?(d="#"+c,{target:d,mode:a.Overlay.Mode.REPLACE,src:b,showOn:["adStarted"],closeOn:["adCompleted"]}):{target:"#"+b,animate:a.Overlay.Animate.SLIDE,showOn:["adStarted"],closeOn:["adCompleted"]}},d.prototype.useAdFox=function(a){return{}},d}(a.Dispatcher),a.Mode={},a.Section={}}.call(this),function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;a=window.AdMan,a.PlayerType.TAG_AUDIO="tag_audio",b=function(b){function e(b,d){this.handler=c(this.handler,this);var e;this.id=b,this.listener=d,this.addListener(d),"string"==typeof b?this.element=null!=(e=a.$(this.id)[0])?e:a.$("#"+this.id)[0]:this.element=b,this.player=this.element,this.volume=90,a.$(this.element).on("canplay play pause ended timeupdate",this.handler)}return d(e,b),e.prototype.handler=function(a){switch(a.type){case"canplay":return this.dispatch("playerready");case"play":return this.dispatch("playerplay");case"pause":return this.dispatch("playerpause");case"ended":return this.dispatch("playerstop"),this.dispatch("playerend");case"timeupdate":return this.dispatch("playerprogress",this.getPosition())}},e.prototype.dispose=function(){return a.$(this.element).off("canplay play pause ended timeupdate",this.handler)},e.prototype.setMuted=function(a){return a?(this.volume=this.player.volume,this.player.muted=!0):(this.player.muted=!1,this.player.volume=this.volume)},e.prototype.pause=function(){return setTimeout(function(a){return function(){return a.player.pause()}}(this),10)},e.prototype.play=function(){if(!this.listener.onEnded)return this.player.play()},e.prototype.stop=function(){return this.player.pause()},e.prototype.isPlaying=function(){return!this.player.paused},e.prototype.getVolume=function(){return this.player.volume},e.prototype.setVolume=function(a){return this.player.volume=a},e.prototype.getPosition=function(){return this.player.currentTime},e}(a.Dispatcher),a.Wrappers[a.PlayerType.TAG_AUDIO]=b}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=window.AdMan,a.PlayerType.NULL="null",b=function(a){function b(a,b){this.id=a,this.addListener(b)}return c(b,a),b.prototype.setMuted=function(){},b.prototype.pause=function(){},b.prototype.play=function(){},b.prototype.stop=function(){},b.prototype.isPlaying=function(){return!1},b.prototype.getVolume=function(){return 1},b.prototype.setVolume=function(a){},b.prototype.dispose=function(){},b}(a.Dispatcher),a.Wrappers[a.PlayerType.NULL]=b}.call(this),function(a){var b=a.AdMan;b.PlayerType.AUDIO_FLOWPLAYER="aflowplayer";var c=function(a,b){this.id=a,this.addListener(b);var c=this,a=document.getElementById(this.id);flowplayer(a).onLoad(function(){c.dispatch("playerready")}).onStart(function(){c.dispatch("playerplay")}).onResume(function(){c.dispatch("playerplay")}).onPause(function(){c.dispatch("playerpause")}).onFinish(function(){c.dispatch("playerend")})};c.prototype={setMuted:function(a){a?flowplayer().mute(a):flowplayer().unmute()},pause:function(){flowplayer().pause()},play:function(){flowplayer().play()},stop:function(){flowplayer().stop()},isPlaying:function(){return!1},getVolume:function(){return flowplayer().getVolume()/100},setVolume:function(a){flowplayer().setVolume(100*a)}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.AUDIO_FLOWPLAYER]=c}(window),function(a){var b=a.AdMan;b.PlayerType.JPLAYER="jplayer";var c=function(a,c){var d=this;if(this.src=null,this.player=a instanceof b.$?a:b.$("#"+a),b.$.isFunction(this.player.jPlayer)){
var e=this.player.jPlayer("option","cssSelectorAncestor");this.controls=b.$(e)[0],this.player.on(b.$.jPlayer.event.ready,function(a){d.dispatch("playerready")}),this.player.on(b.$.jPlayer.event.play,function(a){d.dispatch("playerplay")}),this.player.on(b.$.jPlayer.event.ended,function(a){d.dispatch("playerend")}),this.player.on(b.$.jPlayer.event.pause,function(a){d.dispatch("playerpause")}),this.player.on(b.$.jPlayer.event.stop,function(a){d.dispatch("playerstop")}),this.player.on(b.$.jPlayer.event.dtmf_in,function(a,b){var c=b-a.jPlayer.status.currentTime;c>0?setTimeout(function(){d.dispatch("playerdtmf_in")},1e3*c):d.dispatch("playerdtmf_in")}),this.player.on(b.$.jPlayer.event.dtmf_out,function(a,b){var c=b-a.jPlayer.status.currentTime;c>0?setTimeout(function(){d.dispatch("playerdtmf_out")},1e3*c):d.dispatch("playerdtmf_out")}),this.player.on(b.$.jPlayer.event.setmedia,function(a){var b=a.jPlayer.status.src;b!=d.src&&(null!==d.src&&d.dispatch("playerchange"),d.src=b)}),this.player.on(b.$.jPlayer.event.timeupdate,function(a){d.dispatch("playerprogress",a.jPlayer.status.currentTime)}),this.addListener(c),this.element=this.player[0]}};c.prototype={setMuted:function(a){this.player.jPlayer("mute",a)},pause:function(){this.player.jPlayer("pause")},play:function(){this.player.jPlayer("play")},stop:function(){this.player.jPlayer("stop")},getVolume:function(){return this.player.jPlayer("option","volume")},setVolume:function(a){this.player.jPlayer("volume",a)},isPlaying:function(){return!this.player.data("jPlayer").status.paused},getPosition:function(){return this.player.data("jPlayer").status.currentTime}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.JPLAYER]=c}(window),function(a){var b=a.AdMan;b.PlayerType.JWPLAYER_5="jwplayer_5";var c=function(b,c){var d=this;this.id=b,this.addListener(c),this.volume=90,a.adman_playerListener||(a.adman_playerListener=function(a){"PLAYING"==a.newstate?d.dispatch("playerplay"):"PAUSED"==a.newstate?d.dispatch("playerpause"):"PLAYING"==a.oldstate&&"IDLE"==a.newstate?d.dispatch("playerstop"):"COMPLETED"==a.newstate&&d.dispatch("playerend")}),a.adman_oldPlayerReady=a.playerReady,a.playerReady=function(b){a.adman_oldPlayerReady&&a.adman_oldPlayerReady(b);var c=document.getElementById(d.id);c&&c.addModelListener("STATE","adman_playerListener"),d.dispatch("playerready")}};c.prototype={call:function(a,b,c){var d=document.getElementById(this.id);return d&&d[a]?void 0===b?d[a]():d[a](b):c},setMuted:function(a){a?(this.volume=this.call("jwGetVolume",void 0,this.volume),this.call("jwSetMute",!0)):(this.call("jwSetMute",!1),this.call("jwSetVolume",this.volume))},pause:function(){var a=this;setTimeout(function(){a.call("jwPause")},10)},play:function(){this.call("jwPlay")},stop:function(){this.call("jwStop")},isPlaying:function(){return"PLAYING"==this.call("jwGetState")},getVolume:function(){return this.call("jwGetVolume",void 0,this.volume)/100},setVolume:function(a){this.call("jwSetVolume",100*a)},getPosition:function(){return NaN}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.JWPLAYER_5]=c}(window),function(a){var b=a.AdMan;b.PlayerType.JWPLAYER_6="jwplayer_6",b.PlayerType.JWPLAYER=b.PlayerType.JWPLAYER_6;var c=function(a,b){this.id=a,this.addListener(b);var c=this;jwplayer(this.id).onReady(function(){c.element=jwplayer(c.id).getContainer(),c.controls=c.element,c.dispatch("playerready")}).onPlay(function(){c.dispatch("playerplay")}).onPause(function(){c.dispatch("playerpause")}).onComplete(function(){c.dispatch("playerend")})};c.prototype={setMuted:function(a){jwplayer(this.id).setMute(a)},pause:function(){jwplayer(this.id).pause()},play:function(){jwplayer(this.id).play()},stop:function(){jwplayer(this.id).stop()},isPlaying:function(){return"PLAYING"==jwplayer(this.id).getState()},getVolume:function(){return jwplayer(this.id).getVolume()/100},setVolume:function(a){jwplayer(this.id).setVolume(100*a)},getPosition:function(){return jwplayer(this.id).getPosition()}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.JWPLAYER_6]=c}(window),function(a){var b=a.AdMan;b.PlayerType.SOUNDMANAGER="soundmanager";var c=function(a,b){this.getPlayer=function(a){return soundManager.getSoundById(a)},this.player=this.getPlayer(a),this._unload=this.player.unload?this.player.unload:function(){},this._onload=this.player._iO.onload?this.player._iO.onload:function(){},this._onplay=this.player._iO.onplay?this.player._iO.onplay:function(){},this._onpause=this.player._iO.onpause?this.player._iO.onpause:function(){},this._onfinish=this.player._iO.onfinish?this.player._iO.onfinish:function(){},this._onstop=this.player._iO.onstop?this.player._iO.onstop:function(){};var c=this;this.setListeners=function(a){a._iO.onload=function(){c._onload(),c.dispatch("playerready")},a._iO.onplay=function(){c._onplay(),c.dispatch("playerplay")},a._iO.onstop=function(){c._onstop(),c._stopProgress(),c.dispatch("playerstop")},a._iO.onfinish=function(){c._onfinish(),c.dispatch("playerend")},a._iO.onpause=function(){c._onpause(),c._stopProgress(),c.dispatch("playerpause")},a.unload=function(){c._unload(),c.dispatch("playerpause")}},this.isPlaying()&&this._startProgress(),this.setListeners(this.player),this.addListener(b)};c.prototype={dispose:function(){this.disposed=!0},_startProgress:function(){if(!this._progress){var a=this;this._progress=setInterval(function(){a.dispatch("playerprogress",a.getPosition())},500)}},_stopProgress:function(){this._progress&&(clearInterval(this._progress),this._progress=null)},setMuted:function(a){a?this.player.mute():this.player.unmute()},pause:function(){this.player.pause()},play:function(){this.player.play()},stop:function(){this.player.stop()},getVolume:function(){return Math.round(this.player.volume)/100},setVolume:function(a){this.player.setVolume(100*a)},isPlaying:function(){return this.player.playState},getPosition:function(){return this.player.position/1e3}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.SOUNDMANAGER]=c}(window),function(window){var AdMan=window.AdMan;AdMan.PlayerType.UPPOD_HTML5="uppod_html5";var UppodHtml5Wrapper=function(a,b){if("string"==AdMan.$.type(a))for(var c=0;c<uppod_players.length;c++){var d=uppod_players[c];if(d.uid==a){a=d;break}}this.player=a,this.element=document.getElementById(a.uid),this.controls=this.element,this.element.addEventListener("pause",this.onPlayerEvent(),!1),this.element.addEventListener("play",this.onPlayerEvent(),!1),this.element.addEventListener("stop",this.onPlayerEvent(),!1),this.element.addEventListener("end",this.onPlayerEvent(),!1),this.isPlaying()&&this._startProgress(),this.addListener(b)};UppodHtml5Wrapper.prototype={_startProgress:function(){if(!this._progress){var a=this;this._progress=setInterval(function(){a.dispatch("playerprogress",a.getPosition())},500)}},_stopProgress:function(){this._progress&&(clearInterval(this._progress),this._progress=null)},setMuted:function(a){this.muted!=a&&(this.muted=a,a&&(this.volume=this.getVolume()),this.player.Volume(a?0:this.volume))},pause:function(){this.player.Pause()},play:function(){this.player.Play()},stop:function(){this.player.Stop()},onPlayerEvent:function(){var a=this;return function(b){"play"==b.type?a._startProgress():"pause"==b.type?a._stopProgress():"stop"==b.type&&a._stopProgress(),a.dispatch("player"+b.type,b)}},getVolume:function(){return this.player.Volumed().toFixed(1)},setVolume:function(value){this.player.Volume(eval(value))},isPlaying:function(){return this.player.getStatus()},getPosition:function(){return parseFloat(this.player.CurrentTime())}},AdMan.Dispatcher.extend(UppodHtml5Wrapper),AdMan.Wrappers[AdMan.PlayerType.UPPOD_HTML5]=UppodHtml5Wrapper}(window),function(a){var b=a.AdMan;b.PlayerType.UPPOD_SWF="uppod_swf",b.PlayerType.UPPOD=b.PlayerType.UPPOD_SWF;var c=function(b,c){this.id=b,this.addListener(c),this.volume=100,this.muted=!1,this.playing=!1,this.disposed=!1;var d=this;this._uppodEvent=a.uppodEvent,a.uppodEvent=function(a,b){d.disposed||a==d.id&&("play"==b?(d.playing=!0,d._startProgress()):"pause"==b?(d.playing=!1,d._stopProgress()):"end"==b&&(b="ended"),d.dispatch("player"+b)),d._uppodEvent&&d._uppodEvent(a,b)},void 0===a.uppodSend&&(a.uppodSend=function(a,b,c){document.getElementById(a).sendToUppod(b)}),void 0===a.uppodGet&&(a.uppodGet=function(a,b,c){document.getElementById(a).sendToUppod(b)}),this.isPlaying()&&this._startProgress()};c.prototype={dispose:function(){this.disposed=!0},_startProgress:function(){if(!this._progress){var a=this;this._progress=setInterval(function(){a.dispatch("playerprogress",a.getPosition())},500)}},_stopProgress:function(){this._progress&&(clearInterval(this._progress),this._progress=null)},uppodGet:function(a,b){try{return document.getElementById(this.id).getUppod(a)}catch(c){}return b},uppodSend:function(a,b){try{return document.getElementById(this.id).sendToUppod(a,b?b:"")}catch(c){}},setMuted:function(a){this.muted!=a&&(this.muted=a,a&&(this.volume=this.uppodGet("getv",70)),this.uppodSend(a?"v0":"v"+this.volume))},pause:function(){var a=this;setTimeout(function(){a.uppodSend("pause")},10)},play:function(){this.uppodSend("play");var a=this;setTimeout(function(){a.playing||a.uppodSend("play")},1500)},stop:function(){this.uppodSend("stop")},isPlaying:function(){return 1==this.uppodGet("getstatus")},getVolume:function(){return this.muted?this.volume/100:this.uppodGet("getv",70)/100},setVolume:function(a){this.uppodSend("v"+Math.round(100*a))},getPosition:function(){return parseFloat(this.uppodGet("getposition"))||parseFloat(this.uppodGet("getime"))}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.UPPOD_SWF]=c}(window),function(a){var b=a.AdMan;b.PlayerType.VIDEO_FLOWPLAYER="vflowplayer";var c=function(a,b){this.id=a,this.addListener(b);var c=this,d=document.getElementById(this.id);this.player=flowplayer(d),this.player.on("ready",function(){c.dispatch("playerready")}).on("play",function(){c.dispatch("playerplay")}).on("resume",function(){c.dispatch("playerplay")}).on("pause",function(){c.dispatch("playerpause")})};c.prototype={setMuted:function(a){this.player.mute(a)},pause:function(){this.player.pause()},play:function(){this.player.play()},stop:function(){this.player.play()},isPlaying:function(){return this.player.playing},getVolume:function(){return this.player.volumeLevel},setVolume:function(a){this.player.volume(a)}},b.Dispatcher.extend(c),b.Wrappers[b.PlayerType.VIDEO_FLOWPLAYER]=c}(window),function(a){var b=a.AdMan;b.PopupWaitCondition=function(a,b){this.delay=a,this.addListener(b),this.tId=-1,this.needStart=!1},b.PopupWaitCondition.prototype={start:function(){if(this.delay){var c=this;this._on_focus=function(){c._cancel(),c.needStart?(c.needStart=!1,c.dispatch("start")):c.dispatch("cancelled")},this._on_blur=function(){c._run()},b.$(a).on("focus",this._on_focus).on("blur",this._on_blur)}},_run:function(){this._cancel(),this.dispatch("run");var a=this;this.tId=setTimeout(function(){a.needStart=!0,a.dispatch("cocked")},1e3*this.delay)},_cancel:function(){this.tId>-1&&(clearTimeout(this.tId),this.tId=-1)},stop:function(){b.$(a).off("focus",this._on_focus).off("blur",this._on_blur)}},b.Dispatcher.extend(b.PopupWaitCondition),b.PopupCursorCondition=function(a,b){this.addListener(b),this.tId=-1,this.state=0,this.delay=a;var c=this;this._on_mouseout=function(a){null==a.relatedTarget&&(2==c.state&&c._cancel(),3==c.state&&(c.state=1,c.dispatch("start")))},this._on_mouseover=function(a){null==a.relatedTarget&&1==c.state&&c._run()}},b.PopupCursorCondition.prototype={start:function(){this.state=1;var c=b.$(a.document);c.on("mouseover",this._on_mouseover),c.on("mouseout",this._on_mouseout),b.$(":hover").filter("body").length>0&&this._on_mouseover({relatedTarget:null})},_run:function(){this._cancel(),this.state=2,this.dispatch("run");var a=this;this.tId=setTimeout(function(){a.dispatch("cocked"),a.state=3},1e3*this.delay)},_cancel:function(){this.state=1,this.tId>-1&&(this.dispatch("cancelled"),clearTimeout(this.tId),this.tId=-1)},stop:function(){this.state=0,b.$(a.document).off("mouseover",this._on_mouseout),b.$(a.document).off("mouseout",this._on_mouseout)}},b.Dispatcher.extend(b.PopupCursorCondition),b.PopupManager=function(a){null!=a.country&&b.setDomain(a.country),a.jq&&(b.$=a.jq),this.id=a.id||"adman"+b.Manager.i++,this.log=new b.Log(b.managers.length.toString(),a.log),this.events=a.events,b.managersById[this.id]=this,b.managers.push(this),this.tId=-1,this.data=new b.Data(a.admanId,this.log),this.needStart=!1,this.stat=b.Stat.buildSite(b.Type.FULLSCREEN,this.data.admanId,this.log),this.data.stat=this.stat,isMobile.any?this.condition=new b.PopupWaitCondition(60,this):this.condition=new b.PopupCursorCondition(10,this),this.stat.send(b.StatType.LOAD),this.condition.start()},b.PopupManager.prototype={on_run:function(){this.dispatch("Run")},on_cancelled:function(){this.dispatch("Cancelled")},on_cocked:function(){this.dispatch("Cocked")},on_start:function(){this.start()},dispatch:function(a){if(this.log.d("Event("+a+")"),this.events&&this.events["ad"+a]){var b=[].slice.call(arguments,1);this.events["ad"+a].apply(this,b)}},_show:function(){this.popup=new b.Overlay({target:"body",content:Base64.decode(b.PopupManager.TEMPLATE),animate:b.Overlay.Animate.OPACITY},this),this.popup.setSection(this.section,this.section_stat),this.popup.show()},start:function(a){if(!this.popup||!this.popup.displayed){this.stat.send(b.StatType.REQUEST);var c=this;this.dispatch("Load"),this.data.load(b.Type.FULLSCREEN,a,!0).then(function(a){c.stat.send(b.StatType.FETCHED),c.section=a.section,c.section_stat=a.stat,c.dispatch("Ready",a),c._show()},function(a){c.dispatch("None")})}},skip:function(){},dispose:function(){this.condition.stop(),this.popup&&(this.popup.close(),this.popup=null)},on_overlay_show:function(){this.dispatch("Showed"),this.section_stat.send(b.StatType.PLAYBACK_STARTED),this.condition.stop()},on_overlay_close:function(){this.dispatch("Closed"),this.condition.start()},on_overlay_goto:function(){this.section_stat.send(b.StatType.CLICK)}},b.PopupManager.TEMPLATE="PHN0eWxlIHR5cGU9InRleHQvY3NzIj4udW5pc291bmQtcG9wdXB7cG9zaXRpb246Zml4ZWQ7bGVmdDowO3RvcDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7bWF4LXdpZHRoOjEwMHZ3O21heC1oZWlnaHQ6MTAwdmg7ei1pbmRleDoxOTAwMDA7Zm9udC1zaXplOjE0cHh9LnVuaXNvdW5kLXBvcHVwICp7Zm9udC1zaXplOjE0cHh9LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1iYWNrZ3JvdW5ke3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuOCl9LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC13cmFwcGVye3dpZHRoOjQ1LjcxZW07aGVpZ2h0OjQ5Ljc5ZW07bWluLXdpZHRoOjE3LjE0ZW07bWluLWhlaWdodDoxNy4xNGVtO3Bvc2l0aW9uOmFic29sdXRlO3RvcDotNWVtO2JvdHRvbTowO2xlZnQ6MDtyaWdodDowO21hcmdpbjphdXRvfS51bmlzb3VuZC1wb3B1cCAudW5pc291bmQtYmFubmVye3dpZHRoOjQ1LjcxZW07aGVpZ2h0OjQ1LjcxZW07bWF4LXdpZHRoOjEwMCU7bWF4LWhlaWdodDoxMDAlfS51bmlzb3VuZC1wb3B1cCAudW5pc291bmQtYmFubmVyIGRpdntiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlciB0b3AhaW1wb3J0YW50fS51bmlzb3VuZC1wb3B1cCAudW5pc291bmQtcGFuZWx7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDoxMDAlO21hcmdpbi1sZWZ0Oi43MTQzZW19LnVuaXNvdW5kLXBvcHVwIGJ1dHRvbi51bmlzb3VuZC1jbG9zZXt3aWR0aDozZW07aGVpZ2h0OjNlbTttYXJnaW46MCAuNzE0M2VtIDIuMDcxZW07Y3Vyc29yOnBvaW50ZXI7cG9zaXRpb246cmVsYXRpdmU7YmFja2dyb3VuZDp1cmwoaWNvbnMvY2xvc2UucG5nKSBjZW50ZXIgbm8tcmVwZWF0O2JvcmRlcjpub25lO291dGxpbmU6bm9uZX0udW5pc291bmQtcG9wdXAgLnVuaXNvdW5kLWxpbmt7d2lkdGg6MTIuODZlbTtoZWlnaHQ6M2VtO2xpbmUtaGVpZ2h0OjNlbTtib3JkZXItcmFkaXVzOjEuNWVtO3RleHQtYWxpZ246Y2VudGVyO21hcmdpbjouMzU3MWVtIGF1dG8gMDtmb250LXNpemU6MTZweDtmb250LWZhbWlseTonSGVsdmV0aWNhIE5ldWUnLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OjQwMDtjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzAwYTY1MTtjdXJzb3I6cG9pbnRlcn0udW5pc291bmQtcG9wdXAgYSwudW5pc291bmQtcG9wdXAgYTpob3Zlcnt0ZXh0LWRlY29yYXRpb246bm9uZX0udW5pc291bmQtcG9wdXAgLnVuaXNvdW5kLXNpdGUsLnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1zaXRlIGF7Zm9udC1mYW1pbHk6J0hlbHZldGljYSBOZXVlJyxIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZjtmb250LXNpemU6MTJweDtmb250LXdlaWdodDo0MDB9LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1zaXRle21hcmdpbi10b3A6LjIxNDNlbTt0ZXh0LWFsaWduOnJpZ2h0O3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7Y29sb3I6IzlmOWY5Zn0udW5pc291bmQtcG9wdXAgLnVuaXNvdW5kLXNpdGUgYXtjb2xvcjppbmhlcml0fUBtZWRpYSAob3JpZW50YXRpb246cG9ydHJhaXQpey51bmlzb3VuZC1wb3B1cCAudW5pc291bmQtd3JhcHBlcnttYXgtd2lkdGg6ODB2dzttYXgtaGVpZ2h0Ojgwdnc7dG9wOjB9LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1zb2NpYWwtYnV0dG9ue2Rpc3BsYXk6aW5saW5lLWJsb2NrfS51bmlzb3VuZC1wb3B1cCAudW5pc291bmQtcGFuZWx7cG9zaXRpb246YWJzb2x1dGU7dG9wOmF1dG87bGVmdDowO2JvdHRvbToxMDAlO3dpZHRoOjEwMCU7bWFyZ2luLWxlZnQ6MDttYXJnaW4tYm90dG9tOi43MTQzZW19LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1zb2NpYWx7b3ZlcmZsb3c6aGlkZGVufS51bmlzb3VuZC1wb3B1cCBidXR0b24udW5pc291bmQtY2xvc2V7ZmxvYXQ6cmlnaHQ7bWFyZ2luOjB9LnVuaXNvdW5kLXBvcHVwIC51bmlzb3VuZC1zb2NpYWwtYnV0dG9ue21hcmdpbjowIC41ZW19fUBtZWRpYSAob3JpZW50YXRpb246bGFuZHNjYXBlKXsudW5pc291bmQtcG9wdXAgLnVuaXNvdW5kLXdyYXBwZXJ7bWF4LXdpZHRoOjc1dmg7bWF4LWhlaWdodDo3NXZofX08L3N0eWxlPjxkaXYgY2xhc3M9InVuaXNvdW5kLXBvcHVwIj4KICA8ZGl2IGNsYXNzPSJ1bmlzb3VuZC1iYWNrZ3JvdW5kIHVuaXNvdW5kLWNsb3NlIj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJ1bmlzb3VuZC13cmFwcGVyIj4KICAgIDxkaXYgY2xhc3M9InVuaXNvdW5kLWJhbm5lciBiNjQweDY0MCI+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJ1bmlzb3VuZC1wYW5lbCI+CiAgICAgIDxidXR0b24gY2xhc3M9InVuaXNvdW5kLWNsb3NlIj48L2J1dHRvbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0idW5pc291bmQtc2l0ZSI+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJ1bmlzb3VuZC1saW5rIj7Qn9C10YDQtdC50YLQuCDQvdCwINGB0LDQudGCPC9kaXY+CiAgPC9kaXY+CjwvZGl2Pg==",b.PopupManager.getTemplate=function(){return Base64.decode(b.PopupManager.TEMPLATE)}}(window),function(){!function(){"use strict";var a,b,c,d,e;return e='<style id="adman-style-element" type="text/css" rel="stylesheet">\n  .unisound-banner-overlay, .unisound-default-view {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 5000;\n  }\n  .unisound-opacity-wrapper {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    opacity: 0.8;\n    z-index: 5000;\n    background-color: #000;\n  }\n  .unisound-restart, .unisound-pause, .unisound-close, .unisound-play {\n      z-index: 8000;\n      background-repeat: no-repeat;\n      margin-left: 15px;\n      margin-right: 15px;\n      height: 32px;\n      max-width: 100%;\n      max-height: 100%;\n  }\n  .unisound-restart {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAWCAYAAACsR+4DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3BpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMGZkNzlmYi0zYjcxLTQxMTItOGY4MS1kMTY4Njg3NTkwZGYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUI1MThBREFCRjRCMTFFNThDQUM5NEY1RTJFRTg0RTQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUI1MThBRDlCRjRCMTFFNThDQUM5NEY1RTJFRTg0RTQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjNBMUU3MkIyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjNBMUU3M0IyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PreuvGEAAAEmSURBVHjazNYhT8NQFMXxt60hbEEhSCYwSAwWNzMBCQIDYpkAU9PMQDIUfAQMH2AGz2cgCMwEQSAQhGDJFApBLv8lW4DQ0vb0kfYkPzFxbm6avu45M3Oe1bCDmyJdnwsF6OPeviJ3fSzUwgDP9jtyt8hCyzjFqyVH7ioLreIcb5YeuZtnoXWM8G7ZI3ezLLSJK3xY/sjd6fF0MalhCyfouBISxPzexxAbrsTMF2viEMdYcxXIdLEIZ1hxFUodl7jApEqLfX/5l2ZP76gKTy/uVLYQzg5Au7TN/vh+LSLCi+mRu1k+sAsI8STMl7t5rzUHeBTm5+4qf+IN9PAgzM/cLXLtqWMPd8L81K6vq/QuxsL8xK7v+/42bsX5P7run3RxXaT7KcAAAh6jKxQOQ3EAAAAASUVORK5CYII=");\n    margin-top: 4px;\n    background-size: 36px 22px;\n    width: 36px;\n    height: 22px;\n  }\n  .unisound-pause {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAeCAYAAAAo5+5WAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3BpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMGZkNzlmYi0zYjcxLTQxMTItOGY4MS1kMTY4Njg3NTkwZGYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MkE2QjkzRTZCRjRCMTFFNUE0MUFDNjcwMzc5QzA3NzciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MkE2QjkzRTVCRjRCMTFFNUE0MUFDNjcwMzc5QzA3NzciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjNBMUU3MkIyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjNBMUU3M0IyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pk7FPsgAAAAxSURBVHjaYvwPBAz4ASMOcbz6mBhoBEYNHjV41OBRg0cNHjV41OBRg0cNHjoGAwQYAPzIBTjqZd7PAAAAAElFTkSuQmCC");\n    width: 32px;\n  }\n  .unisound-left, .unisound-label-text-ad {\n    color: #fff;\n    font-weight: bold;\n    font-size: 20px;\n    vertical-align: middle;\n    margin-top: 2px;\n    text-transform: none;\n  }\n  .unisound-label-text-ad {\n    margin-left: 15px;\n    margin-right: 15px;\n  }\n  .unisound-close {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAdCAYAAABWk2cPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3BpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMGZkNzlmYi0zYjcxLTQxMTItOGY4MS1kMTY4Njg3NTkwZGYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUI2NTMwOUJCRjRDMTFFNUE3QzRDRThCRUFDNDEzMDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUI2NTMwOUFCRjRDMTFFNUE3QzRDRThCRUFDNDEzMDAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjNBMUU3MkIyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjNBMUU3M0IyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsrQCTwAAAEsSURBVHjatNdLCsIwEAbgeD5dVPQCChbxHlWoCvVWXSgVX6Co13Cl44wkG2maSTId+DcxyWchSVMFAAozxJwwH8wdk+r22MwwDz3vAZNQO/0wgPrKI7AOpqiZk/BE6ScEQdgGmtorrYMQ7AKpXtTxCe7KhUCqC3WeAq9yAZBqZAatI2ACN8zxC7N6TVbMgctAcG7G/f9rHzgIrEN94F0IaEN9YG+wCZWA57a5XXtvJQ1yUKUXjU9lrjm5Rxt30ZSc41LqaLPtY280BGTBbYBOuC2wEY4By1A4FMwiXhIqBgx+O5mBReTG94LNNVHipOHCKfeOlAHvYsaBb9TxLQRy4d9t8CgIcuCKOvQtd99QsAkmp2s60DdGRY+OOWPGQt8yE8xVz7vF9Kj9K8AAtCSmDhYWPgMAAAAASUVORK5CYII=");\n  }\n  .unisound-play {\n      background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAeCAYAAABNChwpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3BpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMGZkNzlmYi0zYjcxLTQxMTItOGY4MS1kMTY4Njg3NTkwZGYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RjIyMENGOTRCRjRBMTFFNTg1Q0ZBQ0I1QzE0NTgxRTAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RjIyMENGOTNCRjRBMTFFNTg1Q0ZBQ0I1QzE0NTgxRTAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5RjNBMUU3MkIyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjNBMUU3M0IyMTQxMUU1QkY4RkZCODQxMjBEODgwRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpJWh1YAAAFRSURBVHjaxNc/S0JRGMfxa9wo8C00tja0NLc5NDm0NfcCegHNQREZBQ05BImrg5tThNAQuEQU1BA1lIREISSGp++J88BFJP/dc54ffBzUy/1dvTz3nMgYc4EcIg32RXKNPGa0CkhusIFYq4DkEZuY0yogecEWsj4KZMxfjZHyjgKO8BGllHEKSD5xjAM0p25gJk8bBSz4vgeGpYNTLGoVkPyghCWtApIeKljRKpBMDauaBSR1rCGjVUDSwHryeTPJHEgj99hBSauATRvbscKJm26S2pHeClngAXs4w7e8GaLAFXZRQa//Q18F7Imq7oov//ti2gU6OMc+bkc5IK0Cdn1w4tYLr+McOG2BZ3e1RXyFXA803MJ1NsSasP/hkhs0030W6KKMZR+L0njIqCy6//jJ15AYVOANh+6ubnkfU4mf+s5tROZDb83qGntC8SvAAKPfaYpJ/00VAAAAAElFTkSuQmCC");\n      width: 32px;\n  }\n  .unisound-player-buttons-box {\n    display: block;\n    position: absolute;\n    z-index: 8002;\n    padding: 0;\n    margin: 0;\n  }\n  .unisound-player-btn {\n    display: block;\n    float: left;\n  }\n  @media (orientation: landscape) {\n    .unisound-banner {\n      z-index: 8000;\n      display: inline-block;\n      position: relative;\n      top: 2.5vh;\n      left: 2.5vh;\n      width: 95vh;\n      height: 95vh;\n    }\n    .unisound-close {\n      float: right;\n      z-index: 8001;\n      display: block;\n      margin: 0px;\n      padding: 0px;\n      padding-right: 50px;\n      margin-top: 14px;\n      position: relative;\n    }\n    .unisound-buttons-box {\n      display: block;\n      position: relative;\n      z-index: 8002;\n      bottom: 35px;\n      left: 65vw;\n    }\n    .unisound-buttons-box-btn {\n      display: inline-block;\n      float: left;\n    }\n    .player-container {\n      position: relative;\n      z-index: 8001;\n      top: 87.5vh;\n      left: 36vw;\n    }\n  }\n  @media (orientation: portrait) {\n    .unisound-default-view {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      text-align: center;\n    }\n    .unisound-buttons-box {\n      z-index: 8000;\n      position: relative;\n      display: block;\n      bottom: 55px;\n      vertical-align: middle;\n    }\n    .unisound-buttons-box-btn {\n      display: inline-block;\n      vertical-align: top;\n    }\n    .unisound-close {\n      position: relative;\n      display: block;\n      float: right;\n      right: 1.5%;\n      top: 14px;\n      width: 32px;\n      margin-right: 0px;\n    }\n    .unisound-banner {\n      position: relative;\n      z-index: 8000;\n      width: 95%;\n      height: 95%;\n      display: inline-block;\n    }\n    .player-container {\n      position: relative;\n      z-index: 8001;\n      top: 90vh;\n      left: 28vw;\n    }\n  }\n</style>',b='<div class="unisound-not-banner unisound-overlay unisound-default-overlay player-container">\n  <div class="unisound-player-buttons-box unisound-not-banner">\n    <div class="unisound-play unisound-player-btn"></div>\n    <div class="unisound-pause unisound-player-btn"></div>\n    <div class="unisound-left unisound-player-btn"></div>\n    <div class="unisound-label-text-ad unisound-player-btn">Ad</div>\n  </div>\n</div>',d='<div class="unisound-overlay unisound-banner-overlay unisound-default-overlay unisound-hbox">\n  <div class="unisound-default-view">\n    <div class="unisound-opacity-wrapper"></div>\n    <div class="unisound-close" style="" data-delay="5"></div>\n    <div class="unisound-banner b640x640"></div>\n    <div class="unisound-buttons-box">\n      <div class="unisound-restart unisound-buttons-box-btn"></div>\n      <div class="unisound-play unisound-buttons-box-btn"></div>\n      <div class="unisound-pause unisound-buttons-box-btn"></div>\n      <div class="unisound-left unisound-buttons-box-btn"></div>\n    </div>\n  </div>\n</div>',c=function(c,f,g,h){var i,j,k;return j=$(document.head),0===j.find("#adman-style-element").length&&j.append(e),k={admanId:{siteId:c},events:{},playerId:f,playerType:a.PlayerType.TAG_AUDIO,protocol:"https",overlay:[{target:f,mode:a.Overlay.Mode.REPLACE,content:d,showOn:["adStarted"],closeOn:[]},{target:g,content:b,mode:a.Overlay.Mode.REPLACE,showOn:["adStarted"],closeOn:[],showIf:[a.Condition.banner()]}]},null!=h&&(k.admanId.preview=h),i=new a.Manager(k)},a=window.AdMan,a.Mobile={},a.Mobile.getDefaultView=c}()}.call(this),function(){var a,b,c,d,e,f,g;a=window.AdMan,a.Ad=function(){function a(){}return a}(),e=function(a){var b;return void 0===a||null===a?"":(b=a.split(".").pop(),b.indexOf("?")===-1?b:b.split("?").shift())},c=function(a){return!!a},f=function(a,c){if(c.items.push({src:a.staticResource,width:parseInt(a.width,10),height:parseInt(a.height,10),ext:e(a.staticResource),mime:a.type,type:"image",trackingEvent:a.trackingEvents}),null!=a.companionClickTrackingURLTemplate)return b("click",[a.companionClickTrackingURLTemplate],c)},g=function(a,b){return b.items.push({src:a.fileURL,type:"audio",allowSkip:c(b.skip),ext:e(a.fileURL),mime:a.mimeType,duration:parseInt(b.duration),bitrate:parseInt(a.bitrate,10),skipTime:b.skip})},b=function(a,b,c){if(null!=b&&null!=b.forEach)return b.forEach(function(b){if(!c.stats.some(function(c){return function(c){return c.type===a&&c.url===b}}(this)))return c.stats.push({url:b,type:a})})},d=function(a,c){return Object.keys(a).forEach(function(d,e,f){return b(d,a[d],c)})},a.Ad.newFromVAST=function(a){var c,e,h,i,j,k,l,m;if(e={stats:[],campaignId:null,items:[],system:"instreamatic",source:"instreamatic",version:"1.1",link:null,bannerId:null,extensions:[],skip:null},null==a)return null;if(0===a.ads.length)return null;for(h=null,c=a.ads.pop(),e.campaignId=parseInt(c.id,10),b("error",c.errorURLTemplates,e),null!=c.impressionURLTemplates&&b("impression",c.impressionURLTemplates,e);c.extensions.length>0;)i=c.extensions.pop(),e.extensions.push(i),"linkTxt"===i.attributes.type&&e.items.push({type:"text",text:i.children[0].value}),"skipTime"===i.attributes.type&&(m=i.children[0].value.split(":"),m=1===m.length?"00:00:"+i.children[0].value:2===m.length?"00:"+i.children[0].value:i.children[0].value,e.skip=DMVAST.parser.parseDuration(m));for(;c.creatives.length>0;)h=c.creatives.pop(),"companion"===h.type&&(j=null!=h.variations?h.variations[0].companionClickThroughURLTemplate:null),"linear"===h.type&&(null!==h.skipDelay&&(e.skip=h.skipDelay),e.duration=h.duration,null!=h.videoClickThroughURLTemplate?e.link=h.videoClickThroughURLTemplate:e.link=j,e.items.push({type:"link",link:e.link}),null!=h.videoCustomClickURLTemplates&&b("click",h.videoCustomClickURLTemplates,e),null!=h.videoClickTrackingURLTemplates&&b("click",h.videoClickTrackingURLTemplates,e),null!=h.trackingEvents&&d(h.trackingEvents,e),null!=(k=h.mediaFiles)&&k.forEach(function(a,b,c){return g(a,e)})),"companion"===h.type&&null!=(l=h.variations)&&l.forEach(function(a,b,c){return f(a,e)});return e}}.call(this),function(a){var b=a.AdMan;b.Dj={c:{},i:{},start:function(a){b.Dj.c[a]&&!b.Dj.i[a]&&(b.Dj.i[a]=new b.Dj.c[a](a).on())}};var c=function(a){this.site_id=a,this._t=null,this._title=null};c.prototype._isPlaying=function(){return $(".topPanelPause").length>0},c.prototype._send=function(a,c,d){var e={v:Base64.encode((a||"")+":"+(c||"")+":"+(d||"")),s:this.site_id};e=b.$.param(e);var f="//"+b.domain.stat+"/dj/track.gif?"+e,g=document.createElement("img");g.src=f},c.prototype._update=function(){var a=b.$(".topPanelTimeline-title:first").text();
if(this._isPlaying()&&this._title!=a){this._title=a;var c=a.split("  ");if(2==c.length){var d=b.$(".mediaPage-name:first").text();this._send(c[0],d,c[1])}}},c.prototype.on=function(){if(!this._t){var a=this;this._t=setInterval(function(){a._update()},1e3)}return this},c.prototype.off=function(){return this._t&&(clearTimeout(this._t),this._t=null),this},b.Dj.c[261]=c}(window),function(a){var b=a.AdMan;b.Error=function(a,c,d){var e=null,f=null;a.target&&a.target.error?(f=a.target.src,e="MediaError("+a.target.error.code+")"):e=String(a);({error:e,audio_src:f,site_id:c?c.siteId:null,campaign_id:d?d.campaignId:null,platform:navigator.platform,flash:b.Flash.version+"."+b.Flash.build})}}(window);
//# sourceMappingURL=xman.min.js.map